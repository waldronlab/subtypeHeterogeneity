<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title> â€¢ subtypeHeterogeneity</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="">
<meta property="og:description" content="subtypeHeterogeneity">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">subtypeHeterogeneity</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.4</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/subtypeHeterogeneity.html">Absolute SCNA analysis</a>
</li>
<li>
  <a href="../articles/singlecell.html">Single cell analysis</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/waldronlab/subtypeHeterogeneity">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="subtypeHeterogeneity_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip></h1>
            
      
      
      <div class="hidden name"><code>subtypeHeterogeneity.Rmd</code></div>

    </div>

    
    
<div id="absolute-somatic-copy-number-alteration-analysis" class="section level1">
<h1 class="hasAnchor">
<a href="#absolute-somatic-copy-number-alteration-analysis" class="anchor"></a>Absolute somatic copy number alteration analysis</h1>
</div>
<div id="setup" class="section level1">
<h1 class="hasAnchor">
<a href="#setup" class="anchor"></a>Setup</h1>
<div class="sourceCode" id="cb1"><pre class="downlit">
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://waldronlab.github.io/subtypeHeterogeneity">subtypeHeterogeneity</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://www.pmgenomics.ca/bhklab/software/consensusOV">consensusOV</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">RaggedExperiment</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">curatedTCGAData</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">DropletUtils</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jokergoo/ComplexHeatmap">ComplexHeatmap</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">EnrichmentBrowser</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">curatedTCGAData</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">DropletUtils</span><span class="op">)</span></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit">
<span class="va">cb.pink</span> <span class="op">&lt;-</span> <span class="st">"#CC79A7"</span>
<span class="va">cb.red</span> <span class="op">&lt;-</span> <span class="st">"#D55E00"</span>
<span class="va">cb.blue</span> <span class="op">&lt;-</span> <span class="st">"#0072B2"</span>
<span class="va">cb.yellow</span> <span class="op">&lt;-</span> <span class="st">"#F0E442"</span>
<span class="va">cb.green</span> <span class="op">&lt;-</span> <span class="st">"#009E73"</span>
<span class="va">cb.lightblue</span> <span class="op">&lt;-</span> <span class="st">"#56B4E9"</span>
<span class="va">cb.orange</span> <span class="op">&lt;-</span> <span class="st">"#E69F00"</span>

<span class="va">SUBTYPES</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"DIF"</span>, <span class="st">"IMR"</span>, <span class="st">"MES"</span>, <span class="st">"PRO"</span><span class="op">)</span>
<span class="va">stcols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">cb.lightblue</span>, <span class="va">cb.green</span>, <span class="va">cb.orange</span>, <span class="va">cb.pink</span><span class="op">)</span> 
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">stcols</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">SUBTYPES</span></pre></div>
</div>
<div id="data-sources" class="section level1">
<h1 class="hasAnchor">
<a href="#data-sources" class="anchor"></a>Data sources</h1>
<div id="cancer-types" class="section level2">
<h2 class="hasAnchor">
<a href="#cancer-types" class="anchor"></a>Cancer types</h2>
<div class="sourceCode" id="cb3"><pre class="downlit">
<span class="fu">TCGAutils</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/TCGAutils/man/diseaseCodes.html">diseaseCodes</a></span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Study.Abbreviation"</span>, <span class="st">"Study.Name"</span><span class="op">)</span><span class="op">]</span></pre></div>
<pre><code>##    Study.Abbreviation
## 1                 ACC
## 2                BLCA
## 3                BRCA
## 4                CESC
## 5                CHOL
## 6                CNTL
## 7                COAD
## 8                DLBC
## 9                ESCA
## 10               FPPP
## 11                GBM
## 12               HNSC
## 13               KICH
## 14               KIRC
## 15               KIRP
## 16               LAML
## 17               LCML
## 18                LGG
## 19               LIHC
## 20               LUAD
## 21               LUSC
## 22               MESO
## 23               MISC
## 24                 OV
## 25               PAAD
## 26               PCPG
## 27               PRAD
## 28               READ
## 29               SARC
## 30               SKCM
## 31               STAD
## 32               TGCT
## 33               THCA
## 34               THYM
## 35               UCEC
## 36                UCS
## 37                UVM
##                                                          Study.Name
## 1                                          Adrenocortical carcinoma
## 2                                      Bladder Urothelial Carcinoma
## 3                                         Breast invasive carcinoma
## 4  Cervical squamous cell carcinoma and endocervical adenocarcinoma
## 5                                                Cholangiocarcinoma
## 6                                                          Controls
## 7                                              Colon adenocarcinoma
## 8                   Lymphoid Neoplasm Diffuse Large B-cell Lymphoma
## 9                                              Esophageal carcinoma
## 10                                              FFPE Pilot Phase II
## 11                                          Glioblastoma multiforme
## 12                            Head and Neck squamous cell carcinoma
## 13                                               Kidney Chromophobe
## 14                                Kidney renal clear cell carcinoma
## 15                            Kidney renal papillary cell carcinoma
## 16                                           Acute Myeloid Leukemia
## 17                                     Chronic Myelogenous Leukemia
## 18                                         Brain Lower Grade Glioma
## 19                                   Liver hepatocellular carcinoma
## 20                                              Lung adenocarcinoma
## 21                                     Lung squamous cell carcinoma
## 22                                                     Mesothelioma
## 23                                                    Miscellaneous
## 24                                Ovarian serous cystadenocarcinoma
## 25                                        Pancreatic adenocarcinoma
## 26                               Pheochromocytoma and Paraganglioma
## 27                                          Prostate adenocarcinoma
## 28                                            Rectum adenocarcinoma
## 29                                                          Sarcoma
## 30                                          Skin Cutaneous Melanoma
## 31                                           Stomach adenocarcinoma
## 32                                      Testicular Germ Cell Tumors
## 33                                                Thyroid carcinoma
## 34                                                          Thymoma
## 35                             Uterine Corpus Endometrial Carcinoma
## 36                                           Uterine Carcinosarcoma
## 37                                                   Uveal Melanoma</code></pre>
</div>
<div id="absolute" class="section level2">
<h2 class="hasAnchor">
<a href="#absolute" class="anchor"></a>ABSOLUTE</h2>
<div class="sourceCode" id="cb5"><pre class="downlit">
<span class="va">data.dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, package<span class="op">=</span><span class="st">"subtypeHeterogeneity"</span><span class="op">)</span> 
<span class="va">absFile</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">data.dir</span>, <span class="st">"ABSOLUTE_grangeslist.rds"</span><span class="op">)</span>
<span class="va">absGRL</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="va">absFile</span><span class="op">)</span> 
<span class="va">absGRL</span></pre></div>
<pre><code>## GRangesList object of length 10803:
## $`TCGA-02-0001-01`
## GRanges object with 59 ranges and 3 metadata columns:
##        seqnames             ranges strand | Modal_HSCN_1 Modal_HSCN_2     score
##           &lt;Rle&gt;          &lt;IRanges&gt;  &lt;Rle&gt; |    &lt;numeric&gt;    &lt;numeric&gt; &lt;integer&gt;
##    [1]     chr1   3218923-74907316      * |            2            2         0
##    [2]     chr1  74918027-75377480      * |            0            2         0
##    [3]     chr1 75377891-247812431      * |            2            2         1
##    [4]     chr2    499482-57091538      * |            2            3         0
##    [5]     chr2  57097020-74690378      * |            0            2         0
##    ...      ...                ...    ... .          ...          ...       ...
##   [55]    chr19  10050184-58866434      * |            1            2         0
##   [56]    chr20    456452-53835558      * |            0            2         1
##   [57]    chr20  53845647-62219837      * |            2            2         1
##   [58]    chr21  15372509-47678774      * |            2            3         0
##   [59]    chr22  17423930-49331012      * |            1            2         0
##   -------
##   seqinfo: 22 sequences from an unspecified genome; no seqlengths
## 
## ...
## &lt;10802 more elements&gt;</code></pre>
</div>
<div id="gistic2" class="section level2">
<h2 class="hasAnchor">
<a href="#gistic2" class="anchor"></a>GISTIC2</h2>
<div class="sourceCode" id="cb7"><pre class="downlit">
<span class="va">gisticOV</span> <span class="op">&lt;-</span> <span class="fu">gistic2RSE</span><span class="op">(</span>ctype<span class="op">=</span><span class="st">"OV"</span>, peak<span class="op">=</span><span class="st">"wide"</span><span class="op">)</span>
<span class="va">gisticOV</span></pre></div>
<pre><code>## class: RangedSummarizedExperiment 
## dim: 70 579 
## metadata(0):
## assays(1): counts
## rownames: NULL
## rowData names(1): type
## colnames(579): TCGA-04-1331-01 TCGA-04-1332-01 ... TCGA-VG-A8LO-01
##   TCGA-WR-A838-01
## colData names(0):</code></pre>
<div class="sourceCode" id="cb9"><pre class="downlit">
<span class="fu">rowRanges</span><span class="op">(</span><span class="va">gisticOV</span><span class="op">)</span></pre></div>
<pre><code>## GRanges object with 70 ranges and 1 metadata column:
##        seqnames              ranges strand |          type
##           &lt;Rle&gt;           &lt;IRanges&gt;  &lt;Rle&gt; |   &lt;character&gt;
##    [1]     chr1   26963410-27570286      * |      Deletion
##    [2]     chr1   39887948-40168864      * | Amplification
##    [3]     chr1 150483517-150739128      * | Amplification
##    [4]     chr1 207316102-220705691      * |      Deletion
##    [5]     chr1 234417530-235727932      * | Amplification
##    ...      ...                 ...    ... .           ...
##   [66]    chr20   30061713-30332464      * | Amplification
##   [67]    chr20   62137482-63025520      * | Amplification
##   [68]    chr21   42519390-48129895      * |      Deletion
##   [69]    chr22   30113489-30692352      * | Amplification
##   [70]    chr22   48668761-51304566      * |      Deletion
##   -------
##   seqinfo: 23 sequences from an unspecified genome; no seqlengths</code></pre>
<div class="sourceCode" id="cb11"><pre class="downlit">
<span class="fu">assay</span><span class="op">(</span><span class="va">gisticOV</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></pre></div>
<pre><code>##      TCGA-04-1331-01 TCGA-04-1332-01 TCGA-04-1335-01 TCGA-04-1336-01
## [1,]               1               0               1               0
## [2,]               0               1               0               1
## [3,]               1               1               0               0
## [4,]               0               0               0               0
## [5,]               2               0               0               0
##      TCGA-04-1337-01
## [1,]               1
## [2,]               0
## [3,]               0
## [4,]               0
## [5,]               0</code></pre>
</div>
<div id="expression-based-subtypes" class="section level2">
<h2 class="hasAnchor">
<a href="#expression-based-subtypes" class="anchor"></a>Expression-based subtypes</h2>
<div id="broad-subtypes" class="section level3">
<h3 class="hasAnchor">
<a href="#broad-subtypes" class="anchor"></a>Broad subtypes</h3>
<div class="sourceCode" id="cb13"><pre class="downlit">
<span class="va">ovsubs</span> <span class="op">&lt;-</span> <span class="fu">getBroadSubtypes</span><span class="op">(</span>ctype<span class="op">=</span><span class="st">"OV"</span>, clust.alg<span class="op">=</span><span class="st">"CNMF"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">ovsubs</span><span class="op">)</span></pre></div>
<pre><code>## [1] 569   2</code></pre>
<div class="sourceCode" id="cb15"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">ovsubs</span><span class="op">)</span></pre></div>
<pre><code>##                 cluster silhouetteValue
## TCGA-04-1331-01       1      0.07993633
## TCGA-04-1341-01       1      0.04587895
## TCGA-04-1342-01       1      0.09203928
## TCGA-04-1347-01       1      0.02585325
## TCGA-04-1350-01       1      0.26985422
## TCGA-04-1351-01       1      0.26021068</code></pre>
<div class="sourceCode" id="cb17"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">ovsubs</span><span class="op">[</span>,<span class="st">"cluster"</span><span class="op">]</span><span class="op">)</span></pre></div>
<pre><code>## 
##   1   2   3   4 
## 183 114 120 152</code></pre>
</div>
<div id="ov-subtypes-from-different-studies" class="section level3">
<h3 class="hasAnchor">
<a href="#ov-subtypes-from-different-studies" class="anchor"></a>OV subtypes from different studies</h3>
<div class="sourceCode" id="cb19"><pre class="downlit">
<span class="va">pooled.file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">data.dir</span>, <span class="st">"pooled_subtypes.rds"</span><span class="op">)</span>
<span class="va">pooled.subs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="va">pooled.file</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">pooled.subs</span><span class="op">[</span>,<span class="st">"data.source"</span><span class="op">]</span><span class="op">)</span></pre></div>
<pre><code>## 
##   E.MTAB.386     GSE13876     GSE14764     GSE17260     GSE18520     GSE26193 
##          128           95           41           43           48           45 
##     GSE26712     GSE32062     GSE49997     GSE51088      GSE9891 PMID17290060 
##          174          128          122           78          139           56 
##         TCGA 
##          448</code></pre>
<div class="sourceCode" id="cb21"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">pooled.subs</span><span class="op">[</span>,<span class="st">"Verhaak"</span><span class="op">]</span><span class="op">)</span>  </pre></div>
<pre><code>## 
## IMR DIF PRO MES 
## 441 450 309 345</code></pre>
</div>
<div id="tcga-subtype-consistency" class="section level3">
<h3 class="hasAnchor">
<a href="#tcga-subtype-consistency" class="anchor"></a>TCGA subtype consistency</h3>
<div class="sourceCode" id="cb23"><pre class="downlit">
<span class="va">tab</span> <span class="op">&lt;-</span> <span class="fu">mapOVSubtypes</span><span class="op">(</span><span class="va">ovsubs</span>, <span class="va">pooled.subs</span><span class="op">)</span>
<span class="va">tab</span></pre></div>
<pre><code>##      1  2  3  4
## IMR 17 21 18 98
## DIF 26  5 66 16
## PRO 85  5  7  3
## MES 11 62  7  1</code></pre>
<div class="sourceCode" id="cb25"><pre class="downlit">
<span class="op">(</span><span class="va">ind</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">tab</span>, <span class="fl">1</span>, <span class="va">which.max</span><span class="op">)</span> <span class="op">)</span><span class="op">)</span></pre></div>
<pre><code>## PRO MES DIF IMR 
##   1   2   3   4</code></pre>
<div class="sourceCode" id="cb27"><pre class="downlit">
<span class="va">sts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">ind</span><span class="op">)</span><span class="op">[</span><span class="va">ovsubs</span><span class="op">[</span>,<span class="st">"cluster"</span><span class="op">]</span><span class="op">]</span>
<span class="va">ovsubs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">ovsubs</span>, subtype<span class="op">=</span><span class="va">sts</span>, stringsAsFactors<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></pre></div>
</div>
<div id="subtype-purity-ploidy" class="section level3">
<h3 class="hasAnchor">
<a href="#subtype-purity-ploidy" class="anchor"></a>Subtype purity &amp; ploidy</h3>
<div class="sourceCode" id="cb28"><pre class="downlit">
<span class="va">pp.file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">data.dir</span>, <span class="st">"ABSOLUTE_Purity_Ploidy.rds"</span><span class="op">)</span>
<span class="va">puri.ploi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="va">pp.file</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">puri.ploi</span><span class="op">)</span></pre></div>
<pre><code>##                 purity ploidy Genome.doublings Subclonal.genome.fraction
## TCGA-04-1331-01   0.88   1.85                0                      0.19
## TCGA-04-1341-01   0.82   2.79                1                      0.32
## TCGA-04-1342-01   0.79   2.35                0                      0.23
## TCGA-04-1347-01   0.94   4.29                2                      0.46
## TCGA-04-1350-01   0.99   3.04                1                        NA
## TCGA-04-1351-01   0.72   4.37                2                        NA</code></pre>
<div class="sourceCode" id="cb30"><pre class="downlit">
<span class="fu">plotSubtypePurityPloidy</span><span class="op">(</span><span class="va">ovsubs</span>, <span class="va">puri.ploi</span><span class="op">)</span></pre></div>
<p><img src="subtypeHeterogeneity_files/figure-html/plotPP-1.png" width="100%"></p>
<p>Assessing the significance of differences between subtypes:</p>
<div class="sourceCode" id="cb31"><pre class="downlit">
<span class="va">cids</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sets.html">intersect</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">ovsubs</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">puri.ploi</span><span class="op">)</span><span class="op">)</span>
<span class="va">subtys</span> <span class="op">&lt;-</span> <span class="va">ovsubs</span><span class="op">[</span><span class="va">cids</span>, <span class="st">"cluster"</span><span class="op">]</span>
<span class="va">subtys</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">stcols</span><span class="op">)</span><span class="op">[</span><span class="va">subtys</span><span class="op">]</span>
<span class="va">pp</span> <span class="op">&lt;-</span> <span class="va">puri.ploi</span><span class="op">[</span><span class="va">cids</span>, <span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/aov.html">aov</a></span><span class="op">(</span><span class="va">purity</span> <span class="op">~</span> <span class="va">subtype</span>, 
            <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>purity<span class="op">=</span><span class="va">pp</span><span class="op">[</span>,<span class="st">"purity"</span><span class="op">]</span>, subtype<span class="op">=</span><span class="va">subtys</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></pre></div>
<pre><code>##              Df Sum Sq Mean Sq F value Pr(&gt;F)    
## subtype       3  4.244   1.415   109.1 &lt;2e-16 ***
## Residuals   511  6.626   0.013                   
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 7 observations deleted due to missingness</code></pre>
<div class="sourceCode" id="cb33"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/aov.html">aov</a></span><span class="op">(</span><span class="va">ploidy</span> <span class="op">~</span> <span class="va">subtype</span>, 
            <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>ploidy<span class="op">=</span><span class="va">pp</span><span class="op">[</span>,<span class="st">"ploidy"</span><span class="op">]</span>, subtype<span class="op">=</span><span class="va">subtys</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></pre></div>
<pre><code>##              Df Sum Sq Mean Sq F value Pr(&gt;F)   
## subtype       3   14.4   4.792   4.807 0.0026 **
## Residuals   511  509.4   0.997                  
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 7 observations deleted due to missingness</code></pre>
<div class="sourceCode" id="cb35"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/aov.html">aov</a></span><span class="op">(</span><span class="va">subcl</span> <span class="op">~</span> <span class="va">subtype</span>, 
            <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>subcl<span class="op">=</span><span class="va">pp</span><span class="op">[</span>,<span class="st">"Subclonal.genome.fraction"</span><span class="op">]</span>, subtype<span class="op">=</span><span class="va">subtys</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></pre></div>
<pre><code>##              Df Sum Sq Mean Sq F value Pr(&gt;F)   
## subtype       3  0.322 0.10728   4.496 0.0041 **
## Residuals   365  8.708 0.02386                  
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 153 observations deleted due to missingness</code></pre>
<div class="sourceCode" id="cb37"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/stats/chisq.test.html">chisq.test</a></span><span class="op">(</span><span class="va">pp</span><span class="op">[</span>,<span class="st">"Genome.doublings"</span><span class="op">]</span>, <span class="va">subtys</span><span class="op">)</span></pre></div>
<pre><code>## 
##  Pearson's Chi-squared test
## 
## data:  pp[, "Genome.doublings"] and subtys
## X-squared = 28.319, df = 6, p-value = 8.182e-05</code></pre>
<p>Stratifying by purity:</p>
<div class="sourceCode" id="cb39"><pre class="downlit">
<span class="va">sebin</span> <span class="op">&lt;-</span> <span class="fu">stratifyByPurity</span><span class="op">(</span><span class="va">ovsubs</span>, <span class="va">puri.ploi</span>, method<span class="op">=</span><span class="st">"equal.bin"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/lengths.html">lengths</a></span><span class="op">(</span><span class="va">sebin</span><span class="op">)</span></pre></div>
<pre><code>## (0.209,0.368] (0.368,0.526] (0.526,0.684] (0.684,0.842]     (0.842,1] 
##             4            36            79           199           197</code></pre>
<div class="sourceCode" id="cb41"><pre class="downlit">
<span class="va">squint</span> <span class="op">&lt;-</span> <span class="fu">stratifyByPurity</span><span class="op">(</span><span class="va">ovsubs</span>, <span class="va">puri.ploi</span>, method<span class="op">=</span><span class="st">"quintile"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/lengths.html">lengths</a></span><span class="op">(</span><span class="va">squint</span><span class="op">)</span></pre></div>
<pre><code>## (0.21,0.658] (0.658,0.77]  (0.77,0.84]   (0.84,0.9]      (0.9,1] 
##          102          112          103           95          102</code></pre>
</div>
</div>
</div>
<div id="subtype-association" class="section level1">
<h1 class="hasAnchor">
<a href="#subtype-association" class="anchor"></a>Subtype association</h1>
<div class="sourceCode" id="cb43"><pre class="downlit">
<span class="va">pvals</span> <span class="op">&lt;-</span> <span class="fu">testSubtypes</span><span class="op">(</span><span class="va">gisticOV</span>, <span class="va">ovsubs</span>, padj.method<span class="op">=</span><span class="st">"none"</span><span class="op">)</span>
<span class="va">adj.pvals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/p.adjust.html">p.adjust</a></span><span class="op">(</span><span class="va">pvals</span>, method<span class="op">=</span><span class="st">"BH"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">adj.pvals</span><span class="op">)</span></pre></div>
<pre><code>## [1] 70</code></pre>
<div class="sourceCode" id="cb45"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">adj.pvals</span><span class="op">)</span></pre></div>
<pre><code>## [1] 0.80025111 0.14279265 0.11317350 0.90288094 0.03365597 0.45058975</code></pre>
<div class="sourceCode" id="cb47"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">adj.pvals</span> <span class="op">&lt;</span> <span class="fl">0.1</span><span class="op">)</span></pre></div>
<pre><code>## [1] 35</code></pre>
<div class="sourceCode" id="cb49"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="va">pvals</span>, breaks<span class="op">=</span><span class="fl">25</span>, col<span class="op">=</span><span class="st">"firebrick"</span>,
        xlab<span class="op">=</span><span class="st">"Subtype association p-value"</span>, main<span class="op">=</span><span class="st">""</span><span class="op">)</span></pre></div>
<p><img src="subtypeHeterogeneity_files/figure-html/plotAssoc-1.png" width="100%"></p>
<div id="genomic-distribution-of-subtype-associated-cnas" class="section level2">
<h2 class="hasAnchor">
<a href="#genomic-distribution-of-subtype-associated-cnas" class="anchor"></a>Genomic distribution of subtype-associated CNAs</h2>
<div class="sourceCode" id="cb50"><pre class="downlit">
<span class="va">cnv.genes</span> <span class="op">&lt;-</span> <span class="fu">getCnvGenesFromTCGA</span><span class="op">(</span><span class="op">)</span></pre></div>
<div class="sourceCode" id="cb51"><pre class="downlit">
<span class="va">sig.ind</span> <span class="op">&lt;-</span> <span class="va">adj.pvals</span> <span class="op">&lt;</span> <span class="fl">0.1</span>
<span class="fu">mcols</span><span class="op">(</span><span class="va">gisticOV</span><span class="op">)</span><span class="op">$</span><span class="va">subtype</span> <span class="op">&lt;-</span> <span class="fu">testSubtypes</span><span class="op">(</span><span class="va">gisticOV</span>, <span class="va">ovsubs</span>, what<span class="op">=</span><span class="st">"subtype"</span><span class="op">)</span>
<span class="fu">mcols</span><span class="op">(</span><span class="va">gisticOV</span><span class="op">)</span><span class="op">$</span><span class="va">significance</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">sig.ind</span>, <span class="st">"*"</span>, <span class="st">""</span><span class="op">)</span>
<span class="fu">circosSubtypeAssociation</span><span class="op">(</span><span class="va">gisticOV</span>, <span class="va">cnv.genes</span><span class="op">)</span></pre></div>
<p><img src="subtypeHeterogeneity_files/figure-html/circosSubAssoc-1.png" width="100%"></p>
<div class="sourceCode" id="cb52"><pre class="downlit">
<span class="fu">plotNrCNAsPerSubtype</span><span class="op">(</span><span class="fu">mcols</span><span class="op">(</span><span class="va">gisticOV</span><span class="op">)</span><span class="op">$</span><span class="va">type</span><span class="op">[</span><span class="va">sig.ind</span><span class="op">]</span>, <span class="fu">mcols</span><span class="op">(</span><span class="va">gisticOV</span><span class="op">)</span><span class="op">$</span><span class="va">subtype</span><span class="op">[</span><span class="va">sig.ind</span><span class="op">]</span><span class="op">)</span></pre></div>
<p><img src="subtypeHeterogeneity_files/figure-html/cnaPerSubtype-1.png" width="100%"></p>
<p>Annotate cytogenetic bands:</p>
<div class="sourceCode" id="cb53"><pre class="downlit">
<span class="va">bands.file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">data.dir</span>, <span class="st">"cytoBand_hg19.txt"</span><span class="op">)</span>
<span class="va">cbands</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.delim</a></span><span class="op">(</span><span class="va">bands.file</span>, header<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>
<span class="va">cbands</span> <span class="op">&lt;-</span> <span class="va">cbands</span><span class="op">[</span>,<span class="op">-</span><span class="fl">5</span><span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">cbands</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"seqnames"</span>, <span class="st">"start"</span>, <span class="st">"end"</span>, <span class="st">"band"</span><span class="op">)</span>
<span class="va">cbands</span><span class="op">[</span>,<span class="fl">4</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">sub</a></span><span class="op">(</span><span class="st">"^chr"</span>, <span class="st">""</span>, <span class="va">cbands</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span>, <span class="va">cbands</span><span class="op">[</span>,<span class="fl">4</span><span class="op">]</span><span class="op">)</span>
<span class="va">cbands</span> <span class="op">&lt;-</span> <span class="fu">makeGRangesFromDataFrame</span><span class="op">(</span><span class="va">cbands</span>, keep.extra.columns<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
<span class="fu">genome</span><span class="op">(</span><span class="va">cbands</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"hg19"</span>
<span class="va">cbands</span></pre></div>
<pre><code>## GRanges object with 862 ranges and 1 metadata column:
##         seqnames            ranges strand |        band
##            &lt;Rle&gt;         &lt;IRanges&gt;  &lt;Rle&gt; | &lt;character&gt;
##     [1]     chr1         0-2300000      * |     1p36.33
##     [2]     chr1   2300000-5400000      * |     1p36.32
##     [3]     chr1   5400000-7200000      * |     1p36.31
##     [4]     chr1   7200000-9200000      * |     1p36.23
##     [5]     chr1  9200000-12700000      * |     1p36.22
##     ...      ...               ...    ... .         ...
##   [858]     chrY 15100000-19800000      * |    Yq11.221
##   [859]     chrY 19800000-22100000      * |    Yq11.222
##   [860]     chrY 22100000-26200000      * |    Yq11.223
##   [861]     chrY 26200000-28800000      * |     Yq11.23
##   [862]     chrY 28800000-59373566      * |        Yq12
##   -------
##   seqinfo: 24 sequences from hg19 genome; no seqlengths</code></pre>
<div class="sourceCode" id="cb55"><pre class="downlit">
<span class="va">gisticOV</span> <span class="op">&lt;-</span> <span class="fu">annotateCytoBands</span><span class="op">(</span><span class="va">gisticOV</span>, <span class="va">cbands</span><span class="op">)</span>
<span class="fu">mcols</span><span class="op">(</span><span class="va">gisticOV</span><span class="op">)</span></pre></div>
<pre><code>## DataFrame with 70 rows and 4 columns
##              type   subtype significance        band
##       &lt;character&gt; &lt;integer&gt;  &lt;character&gt; &lt;character&gt;
## 1        Deletion         2                  1p36.11
## 2   Amplification         1                   1p34.3
## 3   Amplification         2                   1q21.3
## 4        Deletion         1                     1q41
## 5   Amplification         1            *      1q42.3
## ...           ...       ...          ...         ...
## 66  Amplification         1            *    20q11.21
## 67  Amplification         1            *    20q13.33
## 68       Deletion         1                  21q22.3
## 69  Amplification         4                  22q12.2
## 70       Deletion         1            *    22q13.33</code></pre>
<div class="sourceCode" id="cb57"><pre class="downlit">
<span class="va">coocc</span> <span class="op">&lt;-</span> <span class="fu">analyzeCooccurence</span><span class="op">(</span><span class="va">gisticOV</span><span class="op">)</span> 
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">coocc</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu">mcols</span><span class="op">(</span><span class="va">gisticOV</span><span class="op">)</span><span class="op">$</span><span class="va">band</span>
<span class="fu">ComplexHeatmap</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/Heatmap.html">Heatmap</a></span><span class="op">(</span><span class="va">coocc</span>, show_row_names<span class="op">=</span><span class="cn">TRUE</span>, show_column_names<span class="op">=</span><span class="cn">FALSE</span>, 
    column_title<span class="op">=</span><span class="st">"SCNAs"</span>, row_title<span class="op">=</span><span class="st">"SCNAs"</span>, name<span class="op">=</span><span class="st">"Co-occurrence"</span>, 
    row_names_gp <span class="op">=</span> <span class="fu">gpar</span><span class="op">(</span>fontsize <span class="op">=</span> <span class="fl">8</span><span class="op">)</span><span class="op">)</span></pre></div>
<p><img src="subtypeHeterogeneity_files/figure-html/coocc-1.png" width="100%"></p>
</div>
</div>
<div id="subclonality" class="section level1">
<h1 class="hasAnchor">
<a href="#subclonality" class="anchor"></a>Subclonality</h1>
<div id="match-subtyped-samples-and-absolute-samples" class="section level2">
<h2 class="hasAnchor">
<a href="#match-subtyped-samples-and-absolute-samples" class="anchor"></a>Match subtyped samples and ABSOLUTE samples</h2>
<div class="sourceCode" id="cb58"><pre class="downlit">
<span class="va">raOV</span> <span class="op">&lt;-</span> <span class="fu">getMatchedAbsoluteCalls</span><span class="op">(</span><span class="va">absGRL</span>, <span class="va">ovsubs</span><span class="op">)</span>
<span class="va">raOV</span></pre></div>
<pre><code>## class: RaggedExperiment 
## dim: 76062 516 
## assays(3): Modal_HSCN_1 Modal_HSCN_2 score
## rownames: NULL
## colnames(516): TCGA-04-1331-01 TCGA-04-1341-01 ... TCGA-61-2094-01
##   TCGA-61-2104-01
## colData names(3): cluster silhouetteValue subtype</code></pre>
<div class="sourceCode" id="cb60"><pre class="downlit">
<span class="fu">rowRanges</span><span class="op">(</span><span class="va">raOV</span><span class="op">)</span></pre></div>
<pre><code>## GRanges object with 76062 ranges and 0 metadata columns:
##           seqnames              ranges strand
##              &lt;Rle&gt;           &lt;IRanges&gt;  &lt;Rle&gt;
##       [1]     chr1    3218923-32621239      *
##       [2]     chr1   32661059-45934562      *
##       [3]     chr1   45935056-55443605      *
##       [4]     chr1 117773202-117884055      *
##       [5]     chr1 172450760-172879023      *
##       ...      ...                 ...    ...
##   [76058]    chr21   43587562-47678774      *
##   [76059]    chr22   17423930-28566725      *
##   [76060]    chr22   28586674-38703589      *
##   [76061]    chr22   38708404-47224129      *
##   [76062]    chr22   47227321-49331012      *
##   -------
##   seqinfo: 22 sequences from an unspecified genome; no seqlengths</code></pre>
</div>
<div id="summarize-subclonality-of-absolute-calls-in-gistic-regions" class="section level2">
<h2 class="hasAnchor">
<a href="#summarize-subclonality-of-absolute-calls-in-gistic-regions" class="anchor"></a>Summarize subclonality of ABSOLUTE calls in GISTIC regions</h2>
<div class="sourceCode" id="cb62"><pre class="downlit">
<span class="va">subcl.gisticOV</span> <span class="op">&lt;-</span> <span class="fu">querySubclonality</span><span class="op">(</span><span class="va">raOV</span>, query<span class="op">=</span><span class="fu">rowRanges</span><span class="op">(</span><span class="va">gisticOV</span><span class="op">)</span>, sum.method<span class="op">=</span><span class="st">"any"</span>, ext<span class="op">=</span><span class="fl">500000</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">subcl.gisticOV</span><span class="op">)</span></pre></div>
<pre><code>## [1]  70 516</code></pre>
<div class="sourceCode" id="cb64"><pre class="downlit">
<span class="va">subcl.gisticOV</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></pre></div>
<pre><code>##                          TCGA-04-1331-01 TCGA-04-1341-01 TCGA-04-1342-01
## chr1:26463410-28070286                 0               0              NA
## chr1:39387948-40668864                 0               0               0
## chr1:149983517-151239128              NA               1               1
## chr1:206816102-221205691               1               1               1
## chr1:233917530-236227932               1               1               1
##                          TCGA-04-1347-01 TCGA-04-1350-01
## chr1:26463410-28070286                 1               0
## chr1:39387948-40668864                 1               0
## chr1:149983517-151239128               1               0
## chr1:206816102-221205691               1               0
## chr1:233917530-236227932               1               0</code></pre>
</div>
<div id="subclonality-score" class="section level2">
<h2 class="hasAnchor">
<a href="#subclonality-score" class="anchor"></a>Subclonality score</h2>
<p>Def: Fraction of samples in which a mutation is subclonal.</p>
<div class="sourceCode" id="cb66"><pre class="downlit">
<span class="va">subcl.score</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowMeans</a></span><span class="op">(</span><span class="va">subcl.gisticOV</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">subcl.score</span><span class="op">)</span></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##  0.2206  0.3336  0.4075  0.4009  0.4707  0.6004</code></pre>
</div>
<div id="correlation-subtype-association-score-and-subclonality-score" class="section level2">
<h2 class="hasAnchor">
<a href="#correlation-subtype-association-score-and-subclonality-score" class="anchor"></a>Correlation: subtype-association score and subclonality score</h2>
<div class="sourceCode" id="cb68"><pre class="downlit">
<span class="va">assoc.score</span> <span class="op">&lt;-</span> <span class="fu">testSubtypes</span><span class="op">(</span><span class="va">gisticOV</span>, <span class="va">ovsubs</span>, what<span class="op">=</span><span class="st">"statistic"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="va">assoc.score</span>, <span class="va">subcl.score</span>, method<span class="op">=</span><span class="st">"spearman"</span><span class="op">)</span></pre></div>
<pre><code>## [1] 0.3097017</code></pre>
<div class="sourceCode" id="cb70"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/stats/cor.test.html">cor.test</a></span><span class="op">(</span><span class="va">assoc.score</span>, <span class="va">subcl.score</span>, method<span class="op">=</span><span class="st">"spearman"</span>, exact<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">$</span><span class="va">p.value</span></pre></div>
<pre><code>## [1] 0.009081272</code></pre>
<p>Permutation test:</p>
<div class="sourceCode" id="cb72"><pre class="downlit">
<span class="va">obs.cor</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="va">assoc.score</span>, <span class="va">subcl.score</span>, method<span class="op">=</span><span class="st">"spearman"</span><span class="op">)</span>
<span class="va">perm.cor</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">replicate</a></span><span class="op">(</span><span class="fl">1000</span>, 
    <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="va">assoc.score</span><span class="op">)</span>, <span class="va">subcl.score</span>, method<span class="op">=</span><span class="st">"spearman"</span><span class="op">)</span><span class="op">)</span>
<span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">perm.cor</span> <span class="op">&gt;=</span> <span class="va">obs.cor</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1000</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span></pre></div>
<pre><code>## [1] 0.003996004</code></pre>
<div class="sourceCode" id="cb74"><pre class="downlit">
<span class="fu">plotCorrelation</span><span class="op">(</span><span class="va">assoc.score</span>, <span class="va">subcl.score</span>, 
    subtypes<span class="op">=</span><span class="fu">mcols</span><span class="op">(</span><span class="va">gisticOV</span><span class="op">)</span><span class="op">$</span><span class="va">subtype</span>, stcols<span class="op">=</span><span class="va">stcols</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">3</span>,<span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span>x<span class="op">=</span><span class="fl">52.8</span>, y<span class="op">=</span><span class="fl">0.46</span>, <span class="st">"20q11.21\n(BCL2L1)"</span>, pos<span class="op">=</span><span class="fl">2</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span>x<span class="op">=</span><span class="fl">50</span>, y<span class="op">=</span><span class="fl">0.52</span>, <span class="st">"19p13.12\n(BRD4)"</span>, pos<span class="op">=</span><span class="fl">2</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span>x<span class="op">=</span><span class="fl">39.489</span>, y<span class="op">=</span><span class="fl">0.332</span>, <span class="st">"12q15\n(FRS2)"</span>, pos<span class="op">=</span><span class="fl">4</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span>x<span class="op">=</span><span class="fl">32.232</span>, y<span class="op">=</span><span class="fl">0.492</span>, <span class="st">"3q26.2\n(MECOM)"</span>, pos<span class="op">=</span><span class="fl">3</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span>x<span class="op">=</span><span class="fl">28.883</span>, y<span class="op">=</span><span class="fl">0.6</span>, <span class="st">"8q24.21 (MYC)"</span>, pos<span class="op">=</span><span class="fl">2</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span>x<span class="op">=</span><span class="fl">29.801</span>, y<span class="op">=</span><span class="fl">0.563</span>, <span class="st">"20q13.33"</span>, pos<span class="op">=</span><span class="fl">2</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span>x<span class="op">=</span><span class="fl">25.693</span>, y<span class="op">=</span><span class="fl">0.408</span>, <span class="st">"2q31.2 (PDE11A)"</span>, pos<span class="op">=</span><span class="fl">4</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span>x<span class="op">=</span><span class="fl">26.991</span>, y<span class="op">=</span><span class="fl">0.353</span>, <span class="st">"3p26.3"</span>, pos<span class="op">=</span><span class="fl">4</span><span class="op">)</span> 
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span>x<span class="op">=</span><span class="fl">17.59</span>, y<span class="op">=</span><span class="fl">0.272</span>, <span class="st">"15q15.1 (MGA)"</span>, pos<span class="op">=</span><span class="fl">4</span><span class="op">)</span> 
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span>x<span class="op">=</span><span class="fl">12.389</span>, y<span class="op">=</span><span class="fl">0.22</span>, <span class="st">"8p21.2 (PPP2R2A)"</span>, pos<span class="op">=</span><span class="fl">4</span><span class="op">)</span></pre></div>
<p><img src="subtypeHeterogeneity_files/figure-html/plotCor-1.png" width="100%"></p>
<div id="purity-stratified-analysis" class="section level3">
<h3 class="hasAnchor">
<a href="#purity-stratified-analysis" class="anchor"></a>Purity-stratified analysis</h3>
<div class="sourceCode" id="cb75"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">squint</span>, <span class="kw">function</span><span class="op">(</span><span class="va">ids</span><span class="op">)</span> <span class="fu">analyzeStrata</span><span class="op">(</span><span class="va">ids</span>, <span class="va">absGRL</span>, <span class="va">gisticOV</span>, <span class="va">ovsubs</span><span class="op">)</span><span class="op">)</span></pre></div>
<pre><code>## (0.21,0.658] (0.658,0.77]  (0.77,0.84]   (0.84,0.9]      (0.9,1] 
##    0.2804451    0.3909148    0.1793591    0.2038877    0.2316690</code></pre>
<div class="sourceCode" id="cb77"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">sebin</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span>, <span class="kw">function</span><span class="op">(</span><span class="va">ids</span><span class="op">)</span> <span class="fu">analyzeStrata</span><span class="op">(</span><span class="va">ids</span>, <span class="va">absGRL</span>, <span class="va">gisticOV</span>, <span class="va">ovsubs</span><span class="op">)</span><span class="op">)</span></pre></div>
<pre><code>## (0.368,0.526] (0.526,0.684] (0.684,0.842]     (0.842,1] 
##     0.2298369     0.1667571     0.2469272     0.3788186</code></pre>
<div class="sourceCode" id="cb79"><pre class="downlit">
<span class="fu">plotPurityStrata</span><span class="op">(</span><span class="va">puri.ploi</span>, <span class="va">ovsubs</span>, <span class="va">gisticOV</span>, <span class="va">absGRL</span><span class="op">)</span></pre></div>
<p><img src="subtypeHeterogeneity_files/figure-html/plotPurStrat-1.png" width="100%"></p>
<div class="sourceCode" id="cb80"><pre class="downlit">
<span class="fu">plotPurityStrata</span><span class="op">(</span><span class="va">puri.ploi</span>, <span class="va">ovsubs</span>, <span class="va">gisticOV</span>, <span class="va">absGRL</span>, method<span class="op">=</span><span class="st">"quintile"</span><span class="op">)</span></pre></div>
<p><img src="subtypeHeterogeneity_files/figure-html/plotPurStrat-2.png" width="100%"></p>
<div class="sourceCode" id="cb81"><pre class="downlit">
<span class="fu">rowRanges</span><span class="op">(</span><span class="va">gisticOV</span><span class="op">)</span><span class="op">$</span><span class="va">adj.pval</span> <span class="op">&lt;-</span> <span class="va">adj.pvals</span>
<span class="fu">rowRanges</span><span class="op">(</span><span class="va">gisticOV</span><span class="op">)</span><span class="op">$</span><span class="va">subcl</span> <span class="op">&lt;-</span> <span class="va">subcl.score</span> </pre></div>
</div>
</div>
<div id="assessing-subclonality-calls-with-purecn" class="section level2">
<h2 class="hasAnchor">
<a href="#assessing-subclonality-calls-with-purecn" class="anchor"></a>Assessing subclonality calls with PureCN</h2>
<div id="read-and-order" class="section level3">
<h3 class="hasAnchor">
<a href="#read-and-order" class="anchor"></a>Read and order</h3>
<div class="sourceCode" id="cb82"><pre class="downlit">
<span class="va">ppp.file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">data.dir</span>, <span class="st">"PureCN_Purity_Ploidy.txt"</span><span class="op">)</span>
<span class="va">puriploi.pcn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.table</a></span><span class="op">(</span><span class="va">ppp.file</span><span class="op">)</span> 
<span class="va">puriploi.pcn</span> <span class="op">&lt;-</span> <span class="va">puriploi.pcn</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/duplicated.html">duplicated</a></span><span class="op">(</span><span class="va">puriploi.pcn</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span>,<span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">puriploi.pcn</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">puriploi.pcn</span><span class="op">[</span>,<span class="st">"Sampleid"</span><span class="op">]</span>
<span class="va">puriploi.pcn</span> <span class="op">&lt;-</span> <span class="va">puriploi.pcn</span><span class="op">[</span>,<span class="op">-</span><span class="fl">1</span><span class="op">]</span>
<span class="va">puriploi.pcn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">puriploi.pcn</span><span class="op">)</span>
<span class="va">absdiff</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">puriploi.pcn</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"purity"</span>, <span class="st">"ploidy"</span><span class="op">)</span><span class="op">]</span> <span class="op">-</span> 
                <span class="va">puriploi.pcn</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Purity_wes"</span>, <span class="st">"Ploidy_wes"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>
<span class="va">ind</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="va">order</span>, <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">absdiff</span><span class="op">)</span><span class="op">)</span>
<span class="va">puriploi.pcn</span> <span class="op">&lt;-</span> <span class="va">puriploi.pcn</span><span class="op">[</span><span class="va">ind</span>,<span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">puriploi.pcn</span><span class="op">)</span></pre></div>
<pre><code>##                 purity ploidy Genome.doublings Subclonal.genome.fraction
## TCGA-29-2427-01   0.69   1.80                0                      0.02
## TCGA-24-2035-01   0.61   1.98                0                      0.05
## TCGA-24-1467-01   0.77   3.98                1                      0.09
## TCGA-61-2012-01   0.58   2.90                1                      0.12
## TCGA-13-0751-01   0.93   2.84                1                      0.10
## TCGA-23-2078-01   0.60   1.98                0                      0.17
##                 Purity_wes Ploidy_wes Purity_snp6 Ploidy_snp6
## TCGA-29-2427-01       0.69   1.804566        0.64    1.805899
## TCGA-24-2035-01       0.61   1.945255          NA          NA
## TCGA-24-1467-01       0.78   4.005017        0.71    4.015652
## TCGA-61-2012-01       0.59   2.868254        0.59    2.864081
## TCGA-13-0751-01       0.92   2.808227          NA          NA
## TCGA-23-2078-01       0.59   1.944129        0.59    1.995981</code></pre>
<div class="sourceCode" id="cb84"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="va">puriploi.pcn</span><span class="op">[</span>,<span class="st">"purity"</span><span class="op">]</span>, <span class="va">puriploi.pcn</span><span class="op">[</span>,<span class="st">"Purity_wes"</span><span class="op">]</span>, use<span class="op">=</span><span class="st">"complete.obs"</span><span class="op">)</span></pre></div>
<pre><code>## [1] 0.7684567</code></pre>
<div class="sourceCode" id="cb86"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="va">puriploi.pcn</span><span class="op">[</span>,<span class="st">"Purity_wes"</span><span class="op">]</span>, <span class="va">puriploi.pcn</span><span class="op">[</span>,<span class="st">"Purity_snp6"</span><span class="op">]</span>, use<span class="op">=</span><span class="st">"complete.obs"</span><span class="op">)</span></pre></div>
<pre><code>## [1] 0.8265775</code></pre>
</div>
<div id="cn-concordance-with-absolute" class="section level3">
<h3 class="hasAnchor">
<a href="#cn-concordance-with-absolute" class="anchor"></a>CN concordance with ABSOLUTE</h3>
<p>PureCN calls for S0293689 capture kit:</p>
<div class="sourceCode" id="cb88"><pre class="downlit">
<span class="va">pcn.call.file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">data.dir</span>, <span class="st">"PureCN_OV_S0293689_grangeslist.rds"</span><span class="op">)</span>
<span class="va">pcn.calls</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="va">pcn.call.file</span><span class="op">)</span>
<span class="va">pcn.calls</span></pre></div>
<pre><code>## GRangesList object of length 171:
## $`TCGA-13-0924-01`
## GRanges object with 545 ranges and 2 metadata columns:
##     seqnames              ranges strand |        CN     score
##        &lt;Rle&gt;           &lt;IRanges&gt;  &lt;Rle&gt; | &lt;numeric&gt; &lt;integer&gt;
##         chr1       36357-6634553      * |         2         0
##         chr1    6634723-10629753      * |         1         0
##         chr1   10629823-10659920      * |         2         0
##         chr1   10659931-11519947      * |         1         0
##         chr1   11520570-11649964      * |         2         0
##   .      ...                 ...    ... .       ...       ...
##        chr23 153743355-153785541      * |         3         0
##        chr23 153785930-154558727      * |         2         0
##        chr23 154560355-154642787      * |         3         0
##        chr23 154645729-156010146      * |         2         0
##        chr23 156010202-156010468      * |         1         0
##   -------
##   seqinfo: 23 sequences from an unspecified genome; no seqlengths
## 
## ...
## &lt;170 more elements&gt;</code></pre>
<div class="sourceCode" id="cb90"><pre class="downlit">
<span class="co"># select samples that intersect with ABSOLUTE data</span>
<span class="va">isect.samples</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sets.html">intersect</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">pcn.calls</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">absGRL</span><span class="op">)</span><span class="op">)</span>
<span class="va">pcn.calls</span> <span class="op">&lt;-</span> <span class="va">pcn.calls</span><span class="op">[</span><span class="va">isect.samples</span><span class="op">]</span>
<span class="va">pcn.calls.ra</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/RaggedExperiment/man/RaggedExperiment-class.html">RaggedExperiment</a></span><span class="op">(</span><span class="va">pcn.calls</span><span class="op">)</span> 
<span class="va">pcn.calls.ra</span></pre></div>
<pre><code>## class: RaggedExperiment 
## dim: 185221 166 
## assays(2): CN score
## rownames(185221): '' '' ... '' ''
## colnames(166): TCGA-13-0924-01 TCGA-29-1768-01 ... TCGA-29-1784-01
##   TCGA-13-0807-01
## colData names(0):</code></pre>
<p>Get corresponding ABSOLUTE calls:</p>
<div class="sourceCode" id="cb92"><pre class="downlit">
<span class="va">abs.calls</span> <span class="op">&lt;-</span> <span class="va">absGRL</span><span class="op">[</span><span class="va">isect.samples</span><span class="op">]</span>
<span class="va">abs.calls</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">abs.calls</span><span class="op">)</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span><span class="op">:</span><span class="fl">5</span>,<span class="fl">8</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span><span class="op">]</span>
<span class="va">totalCN</span> <span class="op">&lt;-</span> <span class="va">abs.calls</span><span class="op">[</span>,<span class="st">"Modal_HSCN_1"</span><span class="op">]</span> <span class="op">+</span> <span class="va">abs.calls</span><span class="op">[</span>,<span class="st">"Modal_HSCN_2"</span><span class="op">]</span>
<span class="va">abs.calls</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">abs.calls</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span>, CN<span class="op">=</span><span class="va">totalCN</span>, score<span class="op">=</span><span class="va">abs.calls</span><span class="op">[</span>,<span class="st">"score"</span><span class="op">]</span><span class="op">)</span>
<span class="va">abs.calls</span> <span class="op">&lt;-</span> <span class="fu">makeGRangesListFromDataFrame</span><span class="op">(</span><span class="va">abs.calls</span>, 
    split.field<span class="op">=</span><span class="st">"group_name"</span>, keep.extra.columns<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
<span class="va">abs.calls</span></pre></div>
<pre><code>## GRangesList object of length 166:
## $`TCGA-04-1332-01`
## GRanges object with 104 ranges and 2 metadata columns:
##         seqnames              ranges strand |        CN     score
##            &lt;Rle&gt;           &lt;IRanges&gt;  &lt;Rle&gt; | &lt;numeric&gt; &lt;integer&gt;
##     [1]     chr1    3218923-34828319      * |         3         0
##     [2]     chr1   34829840-49468025      * |         4         0
##     [3]     chr1 116676668-166002656      * |         4         1
##     [4]     chr1 166002866-196696737      * |         4         1
##     [5]     chr1 196966853-247812431      * |         3         0
##     ...      ...                 ...    ... .       ...       ...
##   [100]    chr20     456452-42230695      * |         3         0
##   [101]    chr20   42240730-62219837      * |         4         0
##   [102]    chr21   15372509-36666340      * |         4         0
##   [103]    chr21   36669447-47678774      * |         4         1
##   [104]    chr22   17423930-32027449      * |         3         0
##   -------
##   seqinfo: 22 sequences from an unspecified genome; no seqlengths
## 
## ...
## &lt;165 more elements&gt;</code></pre>
<div class="sourceCode" id="cb94"><pre class="downlit">
<span class="va">abs.calls.ra</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/RaggedExperiment/man/RaggedExperiment-class.html">RaggedExperiment</a></span><span class="op">(</span><span class="va">abs.calls</span><span class="op">)</span>
<span class="va">abs.calls.ra</span> <span class="op">&lt;-</span> <span class="va">abs.calls.ra</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">pcn.calls.ra</span><span class="op">)</span><span class="op">]</span></pre></div>
<p>OVC GISTIC2 regions on hg19 (ABSOLUTE) and hg38 (PureCN)</p>
<div class="sourceCode" id="cb95"><pre class="downlit">
<span class="va">gisticOV.ranges.hg19</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">data.dir</span>, <span class="st">"gisticOV_ranges_hg19.txt"</span><span class="op">)</span> 
<span class="va">gisticOV.ranges.hg19</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/scan.html">scan</a></span><span class="op">(</span><span class="va">gisticOV.ranges.hg19</span>, what<span class="op">=</span><span class="st">"character"</span><span class="op">)</span>
<span class="va">gisticOV.ranges.hg19</span> <span class="op">&lt;-</span> <span class="fu">GRanges</span><span class="op">(</span><span class="va">gisticOV.ranges.hg19</span><span class="op">)</span> 
<span class="va">gisticOV.ranges.hg19</span> </pre></div>
<pre><code>## GRanges object with 65 ranges and 0 metadata columns:
##        seqnames              ranges strand
##           &lt;Rle&gt;           &lt;IRanges&gt;  &lt;Rle&gt;
##    [1]     chr1   26963410-27570286      *
##    [2]     chr1   39887948-40168864      *
##    [3]     chr1 150483517-150739128      *
##    [4]     chr1 207316102-220705691      *
##    [5]     chr1 234417530-235727932      *
##    ...      ...                 ...    ...
##   [61]    chr20           1-4108014      *
##   [62]    chr20   30061713-30332464      *
##   [63]    chr21   42519390-48129895      *
##   [64]    chr22   30113489-30692352      *
##   [65]    chr22   48668761-51304566      *
##   -------
##   seqinfo: 22 sequences from an unspecified genome; no seqlengths</code></pre>
<div class="sourceCode" id="cb97"><pre class="downlit">
<span class="va">gisticOV.ranges.hg38</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">data.dir</span>, <span class="st">"gisticOV_ranges_hg38.txt"</span><span class="op">)</span> 
<span class="va">gisticOV.ranges.hg38</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/scan.html">scan</a></span><span class="op">(</span><span class="va">gisticOV.ranges.hg38</span>, what<span class="op">=</span><span class="st">"character"</span><span class="op">)</span>
<span class="va">gisticOV.ranges.hg38</span> <span class="op">&lt;-</span> <span class="fu">GRanges</span><span class="op">(</span><span class="va">gisticOV.ranges.hg38</span><span class="op">)</span> 
<span class="va">gisticOV.ranges.hg38</span></pre></div>
<pre><code>## GRanges object with 65 ranges and 0 metadata columns:
##        seqnames              ranges strand
##           &lt;Rle&gt;           &lt;IRanges&gt;  &lt;Rle&gt;
##    [1]     chr1   26636919-27243795      *
##    [2]     chr1   39422276-39703192      *
##    [3]     chr1 150511041-150766652      *
##    [4]     chr1 207142757-220532349      *
##    [5]     chr1 234281784-235564632      *
##    ...      ...                 ...    ...
##   [61]    chr20       79360-4127367      *
##   [62]    chr20   31473910-31744661      *
##   [63]    chr21   41147463-46699983      *
##   [64]    chr22   29717500-30296363      *
##   [65]    chr22   48272949-50806138      *
##   -------
##   seqinfo: 22 sequences from an unspecified genome; no seqlengths</code></pre>
<p>Summarize calls in GISTIC regions using either</p>
<ul>
<li>the largest call overlapping a GISTIC region<br>
</li>
<li>a weighted mean of calls overlapping a GISTIC region</li>
</ul>
<div class="sourceCode" id="cb99"><pre class="downlit">
<span class="va">.largest</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">score</span>, <span class="va">range</span>, <span class="va">qrange</span><span class="op">)</span> 
<span class="op">{</span>
    <span class="va">return.type</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">score</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
    <span class="va">default.value</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="va">return.type</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>
    <span class="va">ind</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.min.html">which.max</a></span><span class="op">(</span><span class="fu">width</span><span class="op">(</span><span class="va">range</span><span class="op">)</span><span class="op">)</span>
    <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">vapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span><span class="op">(</span><span class="va">score</span><span class="op">)</span>, 
           <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="va">score</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="va">ind</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>, <span class="va">default.value</span><span class="op">)</span>
    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span>
<span class="op">}</span>
<span class="va">pcn.rassay</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/RaggedExperiment/man/assay-functions.html">qreduceAssay</a></span><span class="op">(</span><span class="va">pcn.calls.ra</span>, query<span class="op">=</span><span class="va">gisticOV.ranges.hg38</span>, 
                    simplifyReduce<span class="op">=</span><span class="va">.largest</span>, background<span class="op">=</span><span class="fl">2</span><span class="op">)</span>
<span class="va">abs.rassay</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/RaggedExperiment/man/assay-functions.html">qreduceAssay</a></span><span class="op">(</span><span class="va">abs.calls.ra</span>, query<span class="op">=</span><span class="va">gisticOV.ranges.hg19</span>,
                    simplifyReduce<span class="op">=</span><span class="va">.largest</span>, background<span class="op">=</span><span class="fl">2</span><span class="op">)</span>


<span class="va">.weightedmean</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">score</span>, <span class="va">range</span>, <span class="va">qrange</span><span class="op">)</span>
<span class="op">{</span>
    <span class="va">w</span> <span class="op">&lt;-</span> <span class="fu">width</span><span class="op">(</span><span class="va">range</span><span class="op">)</span>
    <span class="va">s</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">score</span> <span class="op">*</span> <span class="va">w</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">w</span><span class="op">)</span>
    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">s</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">pcn.rassay2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/RaggedExperiment/man/assay-functions.html">qreduceAssay</a></span><span class="op">(</span><span class="va">pcn.calls.ra</span>, query<span class="op">=</span><span class="va">gisticOV.ranges.hg38</span>,
                    simplifyReduce<span class="op">=</span><span class="va">.weightedmean</span>, background<span class="op">=</span><span class="fl">2</span><span class="op">)</span>
<span class="va">abs.rassay2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/RaggedExperiment/man/assay-functions.html">qreduceAssay</a></span><span class="op">(</span><span class="va">abs.calls.ra</span>, query<span class="op">=</span><span class="va">gisticOV.ranges.hg19</span>,
                    simplifyReduce<span class="op">=</span><span class="va">.weightedmean</span>, background<span class="op">=</span><span class="fl">2</span><span class="op">)</span></pre></div>
<p>Evaluate per-sample concordance:</p>
<ul>
<li>fraction of GISTIC regions with equal copy number<br>
</li>
<li>fraction of GISTIC regions agreeing in alteration type (amplification / deletion)<br>
</li>
<li>fraction of GISTIC regions that deviate by max. 1 copy</li>
</ul>
<div class="sourceCode" id="cb100"><pre class="downlit">
<span class="co"># largest</span>
<span class="va">fract.equal</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">vapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span><span class="op">(</span><span class="va">isect.samples</span><span class="op">)</span>, 
        <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">pcn.rassay</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span> <span class="op">==</span> <span class="va">abs.rassay</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span><span class="op">)</span>, 
        <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">numeric</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="va">fract.type</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">vapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span><span class="op">(</span><span class="va">isect.samples</span><span class="op">)</span>, 
        <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="op">(</span><span class="op">(</span><span class="va">pcn.rassay</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span> <span class="op">&lt;</span> <span class="fl">2</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">(</span><span class="va">abs.rassay</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span> <span class="op">&lt;</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">|</span>
                          <span class="op">(</span><span class="op">(</span><span class="va">pcn.rassay</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span> <span class="op">&gt;</span> <span class="fl">2</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">(</span><span class="va">abs.rassay</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span> <span class="op">&gt;</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">|</span>  
                          <span class="op">(</span><span class="op">(</span><span class="va">pcn.rassay</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span> <span class="op">==</span> <span class="fl">2</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">(</span><span class="va">abs.rassay</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span> <span class="op">==</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, 
        <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">numeric</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="va">fract.diff1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">vapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span><span class="op">(</span><span class="va">isect.samples</span><span class="op">)</span>, 
        <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="op">(</span><span class="va">pcn.rassay</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span> <span class="op">==</span> <span class="va">abs.rassay</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span><span class="op">)</span> <span class="op">|</span> 
                            <span class="op">(</span><span class="va">pcn.rassay</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span> <span class="op">==</span> <span class="va">abs.rassay</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span> <span class="op">|</span>
                            <span class="op">(</span><span class="va">pcn.rassay</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span> <span class="op">==</span> <span class="va">abs.rassay</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>, 
        <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">numeric</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>

<span class="co"># weighted mean</span>
<span class="va">fract.equal2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">vapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span><span class="op">(</span><span class="va">isect.samples</span><span class="op">)</span>, 
        <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">pcn.rassay2</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span> <span class="op">==</span> <span class="va">abs.rassay2</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span><span class="op">)</span>, 
        <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">numeric</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="va">fract.type2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">vapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span><span class="op">(</span><span class="va">isect.samples</span><span class="op">)</span>, 
        <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="op">(</span><span class="op">(</span><span class="va">pcn.rassay2</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span> <span class="op">&lt;</span> <span class="fl">2</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">(</span><span class="va">abs.rassay2</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span> <span class="op">&lt;</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">|</span>
                          <span class="op">(</span><span class="op">(</span><span class="va">pcn.rassay2</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span> <span class="op">&gt;</span> <span class="fl">2</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">(</span><span class="va">abs.rassay2</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span> <span class="op">&gt;</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">|</span>  
                          <span class="op">(</span><span class="op">(</span><span class="va">pcn.rassay2</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span> <span class="op">==</span> <span class="fl">2</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">(</span><span class="va">abs.rassay2</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span> <span class="op">==</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, 
        <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">numeric</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="va">fract.diff12</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">vapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span><span class="op">(</span><span class="va">isect.samples</span><span class="op">)</span>, 
        <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="op">(</span><span class="va">pcn.rassay2</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span> <span class="op">==</span> <span class="va">abs.rassay2</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span><span class="op">)</span> <span class="op">|</span> 
                            <span class="op">(</span><span class="va">pcn.rassay2</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span> <span class="op">==</span> <span class="va">abs.rassay2</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span> <span class="op">|</span>
                            <span class="op">(</span><span class="va">pcn.rassay2</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span> <span class="op">==</span> <span class="va">abs.rassay2</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>, 
        <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">numeric</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></pre></div>
<p>Plot concordance:</p>
<div class="sourceCode" id="cb101"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">5.1</span>, <span class="fl">4.1</span>, <span class="fl">4.1</span>, <span class="fl">8.1</span><span class="op">)</span>, xpd<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/boxplot.html">boxplot</a></span><span class="op">(</span><span class="va">fract.equal</span>, <span class="va">fract.equal2</span>, 
        <span class="va">fract.type</span>, <span class="va">fract.type2</span>,
        <span class="va">fract.diff1</span>, <span class="va">fract.diff12</span>, col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">cb.blue</span>, <span class="va">cb.red</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span>,
        names<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"equal"</span>, <span class="st">"type"</span>, <span class="st">"diff1"</span><span class="op">)</span>, each<span class="op">=</span><span class="fl">2</span><span class="op">)</span>,
        ylab<span class="op">=</span><span class="st">"Fraction of concordant GISTIC2 regions"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op">(</span><span class="st">"topright"</span>, inset<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.3</span>,<span class="fl">0</span><span class="op">)</span>, legend<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"largest"</span>, <span class="st">"wmean"</span><span class="op">)</span>,
        col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">cb.blue</span>, <span class="va">cb.red</span><span class="op">)</span>, lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></pre></div>
<p><img src="subtypeHeterogeneity_files/figure-html/plotConcord-1.png" width="100%"></p>
</div>
<div id="select-large-losses-called-subclonal-by-absolute" class="section level3">
<h3 class="hasAnchor">
<a href="#select-large-losses-called-subclonal-by-absolute" class="anchor"></a>Select large losses called subclonal by ABSOLUTE</h3>
<div class="sourceCode" id="cb102"><pre class="downlit">
<span class="va">selectAbsCalls</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">sample</span>, <span class="va">min.size</span><span class="op">=</span><span class="fl">3000000</span><span class="op">)</span>
<span class="op">{</span>
    <span class="va">gr</span> <span class="op">&lt;-</span> <span class="va">absGRL</span><span class="op">[[</span><span class="va">sample</span><span class="op">]</span><span class="op">]</span>
    <span class="va">gr.3MB</span> <span class="op">&lt;-</span> <span class="fu">width</span><span class="op">(</span><span class="va">gr</span><span class="op">)</span> <span class="op">&gt;</span> <span class="va">min.size</span>
    <span class="va">is.loss</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">gr</span><span class="op">$</span><span class="va">Modal_HSCN_1</span> <span class="op">+</span> <span class="va">gr</span><span class="op">$</span><span class="va">Modal_HSCN_2</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">2</span> 
    <span class="va">is.subcl</span> <span class="op">&lt;-</span> <span class="va">gr</span><span class="op">$</span><span class="va">score</span> <span class="op">==</span> <span class="fl">1</span>

    <span class="va">ind</span> <span class="op">&lt;-</span> <span class="va">gr.3MB</span> <span class="op">&amp;</span> <span class="va">is.loss</span> <span class="op">&amp;</span> <span class="va">is.subcl</span>
    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">gr</span><span class="op">[</span><span class="va">ind</span><span class="op">]</span><span class="op">)</span>
<span class="op">}</span>
<span class="op">(</span><span class="va">abs.calls</span> <span class="op">&lt;-</span> <span class="fu">selectAbsCalls</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">puriploi.pcn</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></pre></div>
<pre><code>## GRanges object with 4 ranges and 3 metadata columns:
##       seqnames             ranges strand | Modal_HSCN_1 Modal_HSCN_2     score
##          &lt;Rle&gt;          &lt;IRanges&gt;  &lt;Rle&gt; |    &lt;numeric&gt;    &lt;numeric&gt; &lt;integer&gt;
##   [1]    chr13  49131496-77266538      * |            0            1         1
##   [2]    chr13 78155543-114987333      * |            0            1         1
##   [3]    chr14  23708769-32553018      * |            0            1         1
##   [4]    chr19  15079104-28465910      * |            0            1         1
##   -------
##   seqinfo: 22 sequences from an unspecified genome; no seqlengths</code></pre>
</div>
<div id="liftover-hg19-based-absolute-calls-to-compare-with-hg38-based-purecn-calls" class="section level3">
<h3 class="hasAnchor">
<a href="#liftover-hg19-based-absolute-calls-to-compare-with-hg38-based-purecn-calls" class="anchor"></a>liftOver hg19-based ABSOLUTE calls to compare with hg38-based PureCN calls</h3>
<ul>
<li>UCSC online liftOver (<a href="https://genome.ucsc.edu/cgi-bin/hgLiftOver" class="uri">https://genome.ucsc.edu/cgi-bin/hgLiftOver</a>)</li>
<li>does smoothing and filtering on top of the chain mappings</li>
<li>
<code><a href="https://rdrr.io/pkg/rtracklayer/man/liftOver.html">rtracklayer::liftOver</a></code> only provides chain mappings</li>
</ul>
<div class="sourceCode" id="cb104"><pre class="downlit">
<span class="va">chain.file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">data.dir</span>, <span class="st">"hg19ToHg38.over.chain"</span><span class="op">)</span>
<span class="va">ch</span> <span class="op">&lt;-</span> <span class="fu">rtracklayer</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rtracklayer/man/Chain-class.html">import.chain</a></span><span class="op">(</span><span class="va">chain.file</span><span class="op">)</span>
<span class="op">(</span><span class="va">hg19.call</span> <span class="op">&lt;-</span> <span class="va">absGRL</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></pre></div>
<pre><code>## GRanges object with 1 range and 3 metadata columns:
##       seqnames           ranges strand | Modal_HSCN_1 Modal_HSCN_2     score
##          &lt;Rle&gt;        &lt;IRanges&gt;  &lt;Rle&gt; |    &lt;numeric&gt;    &lt;numeric&gt; &lt;integer&gt;
##   [1]     chr1 3218923-74907316      * |            2            2         0
##   -------
##   seqinfo: 22 sequences from an unspecified genome; no seqlengths</code></pre>
<div class="sourceCode" id="cb106"><pre class="downlit">
<span class="op">(</span><span class="va">blocks</span> <span class="op">&lt;-</span> <span class="fu">rtracklayer</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rtracklayer/man/liftOver.html">liftOver</a></span><span class="op">(</span><span class="va">hg19.call</span>, <span class="va">ch</span><span class="op">)</span><span class="op">)</span></pre></div>
<pre><code>## GRangesList object of length 1:
## [[1]]
## GRanges object with 1072 ranges and 3 metadata columns:
##          seqnames            ranges strand | Modal_HSCN_1 Modal_HSCN_2
##             &lt;Rle&gt;         &lt;IRanges&gt;  &lt;Rle&gt; |    &lt;numeric&gt;    &lt;numeric&gt;
##      [1]     chr1   3302359-3928704      * |            2            2
##      [2]     chr1   3935210-3936533      * |            2            2
##      [3]     chr1   3936534-7366717      * |            2            2
##      [4]     chr1   7366718-7382536      * |            2            2
##      [5]     chr1   7382538-8504448      * |            2            2
##      ...      ...               ...    ... .          ...          ...
##   [1068]     chr1 13203465-13203520      * |            2            2
##   [1069]     chr1 13203521-13203532      * |            2            2
##   [1070]     chr1 13203533-13203548      * |            2            2
##   [1071]    chr20 38461961-38462015      * |            2            2
##   [1072]     chr1 12893309-12893335      * |            2            2
##              score
##          &lt;integer&gt;
##      [1]         0
##      [2]         0
##      [3]         0
##      [4]         0
##      [5]         0
##      ...       ...
##   [1068]         0
##   [1069]         0
##   [1070]         0
##   [1071]         0
##   [1072]         0
##   -------
##   seqinfo: 2 sequences from an unspecified genome; no seqlengths</code></pre>
<div class="sourceCode" id="cb108"><pre class="downlit">
<span class="va">blocks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="va">blocks</span><span class="op">)</span>
<span class="co"># harmonize chromosome by majority vote</span>
<span class="va">tab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="fu">seqnames</span><span class="op">(</span><span class="va">blocks</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> 
<span class="va">nmax</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">tab</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.min.html">which.max</a></span><span class="op">(</span><span class="va">tab</span><span class="op">)</span><span class="op">]</span>
<span class="co"># collapse blocks</span>
<span class="va">blocks</span> <span class="op">&lt;-</span> <span class="va">blocks</span><span class="op">[</span><span class="fu">seqnames</span><span class="op">(</span><span class="va">blocks</span><span class="op">)</span> <span class="op">==</span> <span class="va">nmax</span><span class="op">]</span>
<span class="op">(</span><span class="va">hg38.call</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html">range</a></span><span class="op">(</span><span class="fu">reduce</span><span class="op">(</span><span class="va">blocks</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></pre></div>
<pre><code>## GRanges object with 1 range and 0 metadata columns:
##       seqnames           ranges strand
##          &lt;Rle&gt;        &lt;IRanges&gt;  &lt;Rle&gt;
##   [1]     chr1 3302359-74441632      *
##   -------
##   seqinfo: 2 sequences from an unspecified genome; no seqlengths</code></pre>
</div>
<div id="select-gistic-regions-of-high-subtype-association-and-subclonality" class="section level3">
<h3 class="hasAnchor">
<a href="#select-gistic-regions-of-high-subtype-association-and-subclonality" class="anchor"></a>Select GISTIC regions of high subtype association and subclonality</h3>
<div class="sourceCode" id="cb110"><pre class="downlit">
<span class="va">tests</span> <span class="op">&lt;-</span> <span class="fu">testSubtypes</span><span class="op">(</span><span class="va">gisticOV</span>, <span class="va">ovsubs</span>, what<span class="op">=</span><span class="st">"full"</span><span class="op">)</span>
<span class="va">extraL</span> <span class="op">&lt;-</span> <span class="fu">stratifySubclonality</span><span class="op">(</span><span class="va">gisticOV</span>, <span class="va">subcl.gisticOV</span>, <span class="va">ovsubs</span>,
                               <span class="va">tests</span>, st.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">stcols</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">3</span>,<span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></pre></div>
<div class="sourceCode" id="cb111"><pre class="downlit">
<span class="co"># highest subtype association</span>
<span class="va">ind</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/order.html">order</a></span><span class="op">(</span><span class="va">assoc.score</span>, decreasing<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
<span class="fu">rowRanges</span><span class="op">(</span><span class="va">gisticOV</span><span class="op">)</span><span class="op">[</span><span class="va">ind</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></pre></div>
<pre><code>## GRanges object with 2 ranges and 6 metadata columns:
##       seqnames            ranges strand |          type   subtype significance
##          &lt;Rle&gt;         &lt;IRanges&gt;  &lt;Rle&gt; |   &lt;character&gt; &lt;integer&gt;  &lt;character&gt;
##   [1]    chr20 30061713-30332464      * | Amplification         1            *
##   [2]    chr19 15333311-15422141      * | Amplification         1            *
##              band    adj.pval     subcl
##       &lt;character&gt;   &lt;numeric&gt; &lt;numeric&gt;
##   [1]    20q11.21 1.44652e-07  0.485465
##   [2]    19p13.12 2.04648e-07  0.507163
##   -------
##   seqinfo: 23 sequences from an unspecified genome; no seqlengths</code></pre>
<div class="sourceCode" id="cb113"><pre class="downlit">
<span class="co"># 20q11.21 (BCL2L1)</span>
<span class="va">x</span> <span class="op">&lt;-</span> <span class="va">tests</span><span class="op">[[</span><span class="va">ind</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">]</span>
<span class="op">(</span><span class="va">ot</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">$</span><span class="va">observed</span><span class="op">)</span></pre></div>
<pre><code>##    subtys
## x    1  2  3  4
##   0 44 41 72 68
##   1 77 55 32 59
##   2 55 14 14 24</code></pre>
<div class="sourceCode" id="cb115"><pre class="downlit">
<span class="va">x</span><span class="op">$</span><span class="va">expected</span></pre></div>
<pre><code>##    subtys
## x          1        2        3        4
##   0 71.35135 44.59459 47.83784 61.21622
##   1 70.71712 44.19820 47.41261 60.67207
##   2 33.93153 21.20721 22.74955 29.11171</code></pre>
<div class="sourceCode" id="cb117"><pre class="downlit">
<span class="va">diff</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">$</span><span class="va">observed</span> <span class="op">-</span> <span class="va">x</span><span class="op">$</span><span class="va">expected</span>
<span class="op">(</span><span class="va">csums</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colSums</a></span><span class="op">(</span><span class="va">diff</span><span class="op">^</span><span class="fl">2</span> <span class="op">/</span> <span class="va">x</span><span class="op">$</span><span class="va">expected</span><span class="op">)</span><span class="op">)</span></pre></div>
<pre><code>##         1         2         3         4 
## 24.124538  5.378997 20.579286  1.695401</code></pre>
<div class="sourceCode" id="cb119"><pre class="downlit">
<span class="co"># 19p13.12 (BRD4)</span>
<span class="va">x</span> <span class="op">&lt;-</span> <span class="va">tests</span><span class="op">[[</span><span class="va">ind</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">]</span>
<span class="op">(</span><span class="va">ot</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">$</span><span class="va">observed</span><span class="op">)</span></pre></div>
<pre><code>##    subtys
## x    1  2  3  4
##   0 62 67 48 76
##   1 49 36 45 54
##   2 65  7 25 21</code></pre>
<div class="sourceCode" id="cb121"><pre class="downlit">
<span class="va">x</span><span class="op">$</span><span class="va">expected</span></pre></div>
<pre><code>##    subtys
## x          1        2        3        4
##   0 80.23063 50.14414 53.79099 68.83423
##   1 58.34955 36.46847 39.12072 50.06126
##   2 37.41982 23.38739 25.08829 32.10450</code></pre>
<div class="sourceCode" id="cb123"><pre class="downlit">
<span class="va">diff</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">$</span><span class="va">observed</span> <span class="op">-</span> <span class="va">x</span><span class="op">$</span><span class="va">expected</span>
<span class="op">(</span><span class="va">csums</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colSums</a></span><span class="op">(</span><span class="va">diff</span><span class="op">^</span><span class="fl">2</span> <span class="op">/</span> <span class="va">x</span><span class="op">$</span><span class="va">expected</span><span class="op">)</span><span class="op">)</span></pre></div>
<pre><code>##         1         2         3         4 
## 25.968516 17.154615  1.507324  4.896757</code></pre>
<div class="sourceCode" id="cb125"><pre class="downlit">
<span class="co"># highest subclonality</span>
<span class="va">ind</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/order.html">order</a></span><span class="op">(</span><span class="va">subcl.score</span>, decreasing<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
<span class="fu">rowRanges</span><span class="op">(</span><span class="va">gisticOV</span><span class="op">)</span><span class="op">[</span><span class="va">ind</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></pre></div>
<pre><code>## GRanges object with 2 ranges and 6 metadata columns:
##       seqnames              ranges strand |          type   subtype
##          &lt;Rle&gt;           &lt;IRanges&gt;  &lt;Rle&gt; |   &lt;character&gt; &lt;integer&gt;
##   [1]     chr8 128694547-129309687      * | Amplification         1
##   [2]    chr20   62137482-63025520      * | Amplification         1
##       significance        band    adj.pval     subcl
##        &lt;character&gt; &lt;character&gt;   &lt;numeric&gt; &lt;numeric&gt;
##   [1]            *     8q24.21 0.000497912  0.600432
##   [2]            *    20q13.33 0.000428776  0.562982
##   -------
##   seqinfo: 23 sequences from an unspecified genome; no seqlengths</code></pre>
<div class="sourceCode" id="cb127"><pre class="downlit">
<span class="va">x</span> <span class="op">&lt;-</span> <span class="va">extraL</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html">order</a></span><span class="op">(</span><span class="va">subcl.score</span>, decreasing<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">7</span><span class="op">)</span><span class="op">]</span><span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"8q24.21 (MYC)"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"20q13.33"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"19p13.12 (BRD4)"</span><span class="op">)</span><span class="op">)</span>
<span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">extraL</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html">order</a></span><span class="op">(</span><span class="va">subcl.score</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">7</span>,<span class="fl">9</span><span class="op">)</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">[</span><span class="fl">4</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"8p21.2 (PPP2R2A)"</span>, <span class="st">"15q15.1 (MGA)"</span>, <span class="st">"15q11.2 (SNRPN)"</span><span class="op">)</span>
<span class="fu">ggplotSubtypeStrata</span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span><span class="op">:</span><span class="fl">6</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"loss"</span>,<span class="st">"gain"</span><span class="op">)</span>, each<span class="op">=</span><span class="fl">3</span><span class="op">)</span><span class="op">)</span></pre></div>
<p><img src="subtypeHeterogeneity_files/figure-html/clonalSubclOV-1.png" width="100%"></p>
<p>Strongest subtype association:</p>
<div class="sourceCode" id="cb128"><pre class="downlit">
<span class="va">ind</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/order.html">order</a></span><span class="op">(</span><span class="va">assoc.score</span>, decreasing<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
<span class="va">x</span> <span class="op">&lt;-</span> <span class="va">extraL</span><span class="op">[</span><span class="va">ind</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">:</span><span class="fl">5</span>,<span class="fl">7</span>,<span class="fl">9</span><span class="op">)</span><span class="op">]</span><span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"20q11.21 (BCL2L1)"</span>, <span class="st">"12q15 (FRS2)"</span>, <span class="st">"3q26.2 (MECOM)"</span>, 
    <span class="st">"6p22.3 (ID4)"</span>, <span class="st">"20p13"</span>, <span class="st">"12p13.33"</span><span class="op">)</span>
<span class="fu">ggplotSubtypeStrata</span><span class="op">(</span><span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"gain"</span>, <span class="fl">6</span><span class="op">)</span><span class="op">)</span></pre></div>
<p><img src="subtypeHeterogeneity_files/figure-html/selecttopplotOV-1.png" width="100%"></p>
<p>Regions of frequent loss in HGSOC:</p>
<div class="sourceCode" id="cb129"><pre class="downlit">
<span class="va">x</span> <span class="op">&lt;-</span> <span class="va">extraL</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">34</span>,<span class="fl">44</span>,<span class="fl">55</span><span class="op">)</span><span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"10q23.31 (PTEN)"</span>, <span class="st">"13q14.2 (RB1)"</span>, <span class="st">"17q11.2 (NF1)"</span><span class="op">)</span>
<span class="fu">ggplotSubtypeStrata</span><span class="op">(</span><span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"loss"</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></pre></div>
<p><img src="subtypeHeterogeneity_files/figure-html/freqLossRegs-1.png" width="100%"></p>
<p>Enrichment of deletions in predom. clonal regions</p>
<div class="sourceCode" id="cb130"><pre class="downlit">
<span class="fu">rowRanges</span><span class="op">(</span><span class="va">gisticOV</span><span class="op">)</span><span class="op">$</span><span class="va">type</span><span class="op">[</span><span class="va">subcl.score</span> <span class="op">&lt;</span> <span class="fl">0.3</span><span class="op">]</span></pre></div>
<pre><code>##  [1] "Amplification" "Deletion"      "Deletion"      "Deletion"     
##  [5] "Deletion"      "Deletion"      "Deletion"      "Deletion"     
##  [9] "Deletion"      "Deletion"      "Deletion"      "Deletion"</code></pre>
</div>
</div>
</div>
<div id="other-cancer-types" class="section level1">
<h1 class="hasAnchor">
<a href="#other-cancer-types" class="anchor"></a>Other cancer types</h1>
<div class="sourceCode" id="cb132"><pre class="downlit">
<span class="va">allFile</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">data.dir</span>, <span class="st">"all_cancer_types.rds"</span><span class="op">)</span>
<span class="va">allCT</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="va">allFile</span><span class="op">)</span></pre></div>
<div id="number-of-samples" class="section level2">
<h2 class="hasAnchor">
<a href="#number-of-samples" class="anchor"></a>Number of samples</h2>
<div class="sourceCode" id="cb133"><pre class="downlit">
<span class="va">st</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">allCT</span>, <span class="kw">function</span><span class="op">(</span><span class="va">ct</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">ct</span><span class="op">$</span><span class="va">subtypes</span><span class="op">)</span><span class="op">)</span>
<span class="va">gs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">allCT</span>, <span class="kw">function</span><span class="op">(</span><span class="va">ct</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">ct</span><span class="op">$</span><span class="va">gistic</span><span class="op">)</span><span class="op">)</span>
<span class="va">as</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">allCT</span>, <span class="kw">function</span><span class="op">(</span><span class="va">ct</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">ct</span><span class="op">$</span><span class="va">subtypes</span><span class="op">)</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">absGRL</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="fu">plotNrSamples</span><span class="op">(</span><span class="va">gs</span>, <span class="va">st</span>, <span class="va">as</span><span class="op">)</span> </pre></div>
<p><img src="subtypeHeterogeneity_files/figure-html/plotNrSamples-1.png" width="100%"></p>
</div>
<div id="number-of-subtypes-gistic-regions" class="section level2">
<h2 class="hasAnchor">
<a href="#number-of-subtypes-gistic-regions" class="anchor"></a>Number of subtypes &amp; GISTIC regions</h2>
<div class="sourceCode" id="cb134"><pre class="downlit">
<span class="va">nr.sts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">allCT</span>, <span class="kw">function</span><span class="op">(</span><span class="va">ct</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">ct</span><span class="op">$</span><span class="va">subtypes</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">nr.gregs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">allCT</span>, <span class="kw">function</span><span class="op">(</span><span class="va">ct</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">ct</span><span class="op">$</span><span class="va">gistic</span><span class="op">)</span><span class="op">)</span>
<span class="fu">plotNrSubtypesVsNrGisticRegions</span><span class="op">(</span><span class="va">nr.sts</span>, <span class="va">nr.gregs</span><span class="op">)</span></pre></div>
<p><img src="subtypeHeterogeneity_files/figure-html/descrStats-1.png" width="100%"></p>
</div>
<div id="subclonality-1" class="section level2">
<h2 class="hasAnchor">
<a href="#subclonality-1" class="anchor"></a>Subclonality</h2>
<div class="sourceCode" id="cb135"><pre class="downlit">
<span class="va">subcl.scores</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">allCT</span>, <span class="kw">function</span><span class="op">(</span><span class="va">ct</span><span class="op">)</span> <span class="va">ct</span><span class="op">$</span><span class="va">subcl.score</span><span class="op">)</span>
<span class="fu">plotSubclonalityDistributions</span><span class="op">(</span><span class="va">subcl.scores</span><span class="op">)</span></pre></div>
<p><img src="subtypeHeterogeneity_files/figure-html/subclDistrs-1.png" width="100%"></p>
</div>
<div id="correlation-subtype-association-subclonality" class="section level2">
<h2 class="hasAnchor">
<a href="#correlation-subtype-association-subclonality" class="anchor"></a>Correlation: subtype association &amp; subclonality</h2>
<div class="sourceCode" id="cb136"><pre class="downlit">
<span class="va">rho</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">allCT</span>, <span class="kw">function</span><span class="op">(</span><span class="va">ct</span><span class="op">)</span> <span class="va">ct</span><span class="op">$</span><span class="va">rho</span><span class="op">)</span>
<span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">allCT</span>, <span class="kw">function</span><span class="op">(</span><span class="va">ct</span><span class="op">)</span> <span class="va">ct</span><span class="op">$</span><span class="va">p</span><span class="op">)</span>
<span class="fu">volcanoCorrelation</span><span class="op">(</span><span class="va">rho</span>, <span class="va">p</span><span class="op">)</span></pre></div>
<p><img src="subtypeHeterogeneity_files/figure-html/corVolcano-1.png" width="100%"></p>
</div>
<div id="intrinsic-subtypes-sarcoma" class="section level2">
<h2 class="hasAnchor">
<a href="#intrinsic-subtypes-sarcoma" class="anchor"></a>Intrinsic subtypes: sarcoma</h2>
<div class="sourceCode" id="cb137"><pre class="downlit">
<span class="va">gisticSARC</span> <span class="op">&lt;-</span> <span class="fu">gistic2RSE</span><span class="op">(</span>ctype<span class="op">=</span><span class="st">"SARC"</span>, peak<span class="op">=</span><span class="st">"wide"</span><span class="op">)</span>
<span class="va">sarcsubs</span> <span class="op">&lt;-</span> <span class="fu">getBroadSubtypes</span><span class="op">(</span>ctype<span class="op">=</span><span class="st">"SARC"</span>, clust.alg<span class="op">=</span><span class="st">"CNMF"</span><span class="op">)</span></pre></div>
<pre><code>## Warning in getBroadSubtypes(ctype = "SARC", clust.alg = "CNMF"): mRNA clustering
## not available for SARC - mRNAseq clustering is taken instead</code></pre>
<div class="sourceCode" id="cb139"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">sarcsubs</span><span class="op">$</span><span class="va">cluster</span><span class="op">)</span></pre></div>
<pre><code>## 
##   1   2   3 
## 116  78  65</code></pre>
<div class="sourceCode" id="cb141"><pre class="downlit">
<span class="va">pvals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/warning.html">suppressWarnings</a></span><span class="op">(</span> <span class="fu">testSubtypes</span><span class="op">(</span><span class="va">gisticSARC</span>, <span class="va">sarcsubs</span>, padj.method<span class="op">=</span><span class="st">"none"</span><span class="op">)</span> <span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">pvals</span><span class="op">)</span></pre></div>
<pre><code>## [1] 64</code></pre>
<div class="sourceCode" id="cb143"><pre class="downlit">
<span class="va">adj.pvals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/p.adjust.html">p.adjust</a></span><span class="op">(</span><span class="va">pvals</span>, method<span class="op">=</span><span class="st">"BH"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">adj.pvals</span> <span class="op">&lt;</span> <span class="fl">0.1</span><span class="op">)</span></pre></div>
<pre><code>## [1] 41</code></pre>
<div class="sourceCode" id="cb145"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="va">pvals</span>, breaks<span class="op">=</span><span class="fl">25</span>, col<span class="op">=</span><span class="st">"firebrick"</span>,xlab<span class="op">=</span><span class="st">"Subtype association p-value"</span>, main<span class="op">=</span><span class="st">""</span><span class="op">)</span></pre></div>
<p><img src="subtypeHeterogeneity_files/figure-html/sarcSubtyAssoc-1.png" width="100%"></p>
<div class="sourceCode" id="cb146"><pre class="downlit">
<span class="va">sarc.clin</span> <span class="op">&lt;-</span> <span class="fu">RTCGAToolbox</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/RTCGAToolbox/man/getFirehoseData.html">getFirehoseData</a></span><span class="op">(</span>dataset<span class="op">=</span><span class="st">"SARC"</span>, runDate<span class="op">=</span><span class="st">"20160128"</span><span class="op">)</span></pre></div>
<pre><code>## gdac.broadinstitute.org_SARC.Clinical_Pick_Tier1.Level_4.2016012800.0.0.tar.gz</code></pre>
<pre><code>## gdac.broadinstitute.org_SARC.Clinical_Pick_Tier1.Level_4.2016012800.0.0</code></pre>
<div class="sourceCode" id="cb149"><pre class="downlit">
<span class="va">sarc.clin</span> <span class="op">&lt;-</span> <span class="fu">RTCGAToolbox</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/RTCGAToolbox/man/getData.html">getData</a></span><span class="op">(</span><span class="va">sarc.clin</span>, <span class="st">"clinical"</span><span class="op">)</span>
<span class="va">ids</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">sarcsubs</span><span class="op">)</span>
<span class="va">ids</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/chartr.html">tolower</a></span><span class="op">(</span><span class="va">ids</span><span class="op">)</span>
<span class="va">ids</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">"-"</span>, <span class="st">"."</span>, <span class="va">ids</span><span class="op">)</span>
<span class="va">ids</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/substr.html">substring</a></span><span class="op">(</span><span class="va">ids</span>, <span class="fl">1</span>, <span class="fl">12</span><span class="op">)</span>
<span class="va">sarcsubs</span><span class="op">$</span><span class="va">histType</span> <span class="op">&lt;-</span> <span class="va">sarc.clin</span><span class="op">[</span><span class="va">ids</span>,<span class="st">"histological_type"</span><span class="op">]</span> 
<span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="kw">function</span><span class="op">(</span><span class="va">cl</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">sarcsubs</span><span class="op">[</span><span class="va">sarcsubs</span><span class="op">$</span><span class="va">cluster</span> <span class="op">==</span> <span class="va">cl</span>,<span class="st">"histType"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></pre></div>
<pre><code>## [[1]]
## 
##                                             dedifferentiated liposarcoma 
##                                                                       38 
## giant cell 'mfh' / undifferentiated pleomorphic sarcoma with giant cells 
##                                                                        1 
##                                                     leiomyosarcoma (lms) 
##                                                                       12 
##                         malignant peripheral nerve sheath tumors (mpnst) 
##                                                                        1 
##                                                         myxofibrosarcoma 
##                                                                       23 
##                 pleomorphic 'mfh' / undifferentiated pleomorphic sarcoma 
##                                                                       25 
##                               undifferentiated pleomorphic sarcoma (ups) 
##                                                                       16 
## 
## [[2]]
## 
## dedifferentiated liposarcoma         leiomyosarcoma (lms) 
##                            1                           77 
## 
## [[3]]
## 
##                             dedifferentiated liposarcoma 
##                                                       19 
##                                            desmoid tumor 
##                                                        2 
##                                     leiomyosarcoma (lms) 
##                                                       15 
##         malignant peripheral nerve sheath tumors (mpnst) 
##                                                        8 
##                                         myxofibrosarcoma 
##                                                        2 
## pleomorphic 'mfh' / undifferentiated pleomorphic sarcoma 
##                                                        4 
##                 sarcoma; synovial; poorly differentiated 
##                                                        2 
##                              synovial sarcoma - biphasic 
##                                                        2 
##                            synovial sarcoma - monophasic 
##                                                        6 
##               undifferentiated pleomorphic sarcoma (ups) 
##                                                        5</code></pre>
<div class="sourceCode" id="cb151"><pre class="downlit">
<span class="va">assoc.score</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/warning.html">suppressWarnings</a></span><span class="op">(</span> <span class="fu">testSubtypes</span><span class="op">(</span><span class="va">gisticSARC</span>, <span class="va">sarcsubs</span>, what<span class="op">=</span><span class="st">"statistic"</span><span class="op">)</span> <span class="op">)</span>
<span class="va">raSARC</span> <span class="op">&lt;-</span> <span class="fu">getMatchedAbsoluteCalls</span><span class="op">(</span><span class="va">absGRL</span>, <span class="va">sarcsubs</span><span class="op">)</span>
<span class="va">subcl.gisticSARC</span> <span class="op">&lt;-</span> <span class="fu">querySubclonality</span><span class="op">(</span><span class="va">raSARC</span>, query<span class="op">=</span><span class="fu">rowRanges</span><span class="op">(</span><span class="va">gisticSARC</span><span class="op">)</span>, sum.method<span class="op">=</span><span class="st">"any"</span><span class="op">)</span>
<span class="va">subcl.score</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowMeans</a></span><span class="op">(</span><span class="va">subcl.gisticSARC</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">subcl.score</span><span class="op">)</span></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##  0.2486  0.3667  0.4736  0.4701  0.5573  0.6788</code></pre>
<div class="sourceCode" id="cb153"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="va">assoc.score</span>, <span class="va">subcl.score</span>, method<span class="op">=</span><span class="st">"spearman"</span><span class="op">)</span></pre></div>
<pre><code>## [1] -0.364473</code></pre>
<div class="sourceCode" id="cb155"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/stats/cor.test.html">cor.test</a></span><span class="op">(</span><span class="va">assoc.score</span>, <span class="va">subcl.score</span>, method<span class="op">=</span><span class="st">"spearman"</span>, exact<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">$</span><span class="va">p.value</span></pre></div>
<pre><code>## [1] 0.003067494</code></pre>
<div class="sourceCode" id="cb157"><pre class="downlit">
<span class="va">sarc.cols</span> <span class="op">&lt;-</span> <span class="va">stcols</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span>,<span class="fl">2</span><span class="op">)</span><span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">sarc.cols</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"MFS/UPS"</span>, <span class="st">"LMS"</span>, <span class="st">"DDLPS"</span><span class="op">)</span>
<span class="va">sts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/warning.html">suppressWarnings</a></span><span class="op">(</span> <span class="fu">testSubtypes</span><span class="op">(</span><span class="va">gisticSARC</span>, <span class="va">sarcsubs</span>, what<span class="op">=</span><span class="st">"subtype"</span><span class="op">)</span> <span class="op">)</span>
<span class="va">sts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">sarc.cols</span><span class="op">)</span><span class="op">[</span><span class="va">sts</span><span class="op">]</span>
<span class="fu">plotCorrelation</span><span class="op">(</span><span class="va">assoc.score</span>, <span class="va">subcl.score</span>, subtypes<span class="op">=</span><span class="va">sts</span>, stcols<span class="op">=</span><span class="va">sarc.cols</span>, lpos<span class="op">=</span><span class="st">"right"</span><span class="op">)</span>
<span class="co"># top assoc</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span>x<span class="op">=</span><span class="fl">56.885</span>, y<span class="op">=</span><span class="fl">0.548</span>, <span class="st">"1p36.32\n(TP73)"</span>, pos<span class="op">=</span><span class="fl">2</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span>x<span class="op">=</span><span class="fl">36.908</span>, y<span class="op">=</span><span class="fl">0.336</span>, <span class="st">"6q25.1\n(UST)"</span>, pos<span class="op">=</span><span class="fl">4</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span>x<span class="op">=</span><span class="fl">33.943</span>, y<span class="op">=</span><span class="fl">0.275</span>, <span class="st">"10q23.31 (PTEN)"</span>, pos<span class="op">=</span><span class="fl">2</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span>x<span class="op">=</span><span class="fl">30.257</span>, y<span class="op">=</span><span class="fl">0.249</span>, <span class="st">"13q14.2 (RB1)"</span>, pos<span class="op">=</span><span class="fl">2</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span>x<span class="op">=</span><span class="fl">27.44</span>, y<span class="op">=</span><span class="fl">0.435</span>, <span class="st">"10q26.3\n(SPRN)"</span>, pos<span class="op">=</span><span class="fl">4</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span>x<span class="op">=</span><span class="fl">25.501</span>, y<span class="op">=</span><span class="fl">0.362</span>, <span class="st">"1p32.1\n(JUN)"</span>, pos<span class="op">=</span><span class="fl">4</span><span class="op">)</span>
<span class="co"># top subcl</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span>x<span class="op">=</span><span class="fl">10.116</span>, y<span class="op">=</span><span class="fl">0.679</span>, <span class="st">"8q"</span>, pos<span class="op">=</span><span class="fl">4</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span>x<span class="op">=</span><span class="fl">6.37</span>, y<span class="op">=</span><span class="fl">0.678</span>, <span class="st">"9q34"</span>, pos<span class="op">=</span><span class="fl">2</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span>x<span class="op">=</span><span class="fl">8.586</span>, y<span class="op">=</span><span class="fl">0.662</span>, <span class="st">"17q"</span>, pos<span class="op">=</span><span class="fl">4</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span>x<span class="op">=</span><span class="fl">7.658</span>, y<span class="op">=</span><span class="fl">0.65</span>, <span class="st">"5p15.33\n(TERT)"</span>, pos<span class="op">=</span><span class="fl">2</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span>x<span class="op">=</span><span class="fl">19.497</span>, y<span class="op">=</span><span class="fl">0.625</span>, <span class="st">"8p23.2 (CSMD1)"</span>, pos<span class="op">=</span><span class="fl">4</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span>x<span class="op">=</span><span class="fl">17.4</span>, y<span class="op">=</span><span class="fl">0.625</span>, <span class="st">"20q13.33"</span>, pos<span class="op">=</span><span class="fl">2</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span>x<span class="op">=</span><span class="fl">55.915</span>, y<span class="op">=</span><span class="fl">0.262</span>, <span class="st">"12q15 (MDM2)"</span>, pos<span class="op">=</span><span class="fl">2</span><span class="op">)</span></pre></div>
<p><img src="subtypeHeterogeneity_files/figure-html/sarcPlot-1.png" width="100%"></p>
<div class="sourceCode" id="cb158"><pre class="downlit">
<span class="va">gisticSARC</span> <span class="op">&lt;-</span> <span class="fu">annotateCytoBands</span><span class="op">(</span><span class="va">gisticSARC</span>, <span class="va">cbands</span><span class="op">)</span>
<span class="fu">rowRanges</span><span class="op">(</span><span class="va">gisticSARC</span><span class="op">)</span><span class="op">$</span><span class="va">assoc.score</span> <span class="op">&lt;-</span> <span class="va">assoc.score</span>
<span class="fu">rowRanges</span><span class="op">(</span><span class="va">gisticSARC</span><span class="op">)</span><span class="op">$</span><span class="va">subcl</span> <span class="op">&lt;-</span> <span class="va">subcl.score</span> 
<span class="fu">rowRanges</span><span class="op">(</span><span class="va">gisticSARC</span><span class="op">)</span><span class="op">$</span><span class="va">subtype</span> <span class="op">&lt;-</span> <span class="va">sts</span> 
<span class="va">ind.assoc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/order.html">order</a></span><span class="op">(</span><span class="va">assoc.score</span>, decreasing<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
<span class="va">ind.subcl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/order.html">order</a></span><span class="op">(</span><span class="va">subcl.score</span>, decreasing<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
<span class="fu">rowRanges</span><span class="op">(</span><span class="va">gisticSARC</span><span class="op">)</span><span class="op">[</span><span class="va">ind.assoc</span><span class="op">]</span></pre></div>
<pre><code>## GRanges object with 64 ranges and 5 metadata columns:
##        seqnames              ranges strand |          type        band
##           &lt;Rle&gt;           &lt;IRanges&gt;  &lt;Rle&gt; |   &lt;character&gt; &lt;character&gt;
##    [1]     chr1           1-5923787      * |      Deletion     1p36.32
##    [2]    chr12   69178021-69244387      * | Amplification       12q15
##    [3]     chr6 148810209-149693136      * | Amplification      6q25.1
##    [4]    chr10   89617158-89755074      * |      Deletion    10q23.31
##    [5]    chr13   48875329-49064807      * |      Deletion     13q14.2
##    ...      ...                 ...    ... .           ...         ...
##   [60]     chr6  66417081-104031403      * |      Deletion      6q14.1
##   [61]    chr11            1-496996      * |      Deletion     11p15.5
##   [62]    chr12 132611527-133851895      * |      Deletion    12q24.33
##   [63]    chr18           1-5145388      * |      Deletion    18p11.32
##   [64]    chr22   45095899-51304566      * |      Deletion    22q13.31
##        assoc.score     subcl     subtype
##          &lt;numeric&gt; &lt;numeric&gt; &lt;character&gt;
##    [1]     56.8853  0.548193         LMS
##    [2]     55.9154  0.261905         LMS
##    [3]     36.9080  0.336000     MFS/UPS
##    [4]     33.9432  0.274510         LMS
##    [5]     30.2573  0.248588       DDLPS
##    ...         ...       ...         ...
##   [60]    1.450279  0.585799       DDLPS
##   [61]    1.238339  0.445205       DDLPS
##   [62]    0.904199  0.500000         LMS
##   [63]    0.742853  0.443709         LMS
##   [64]    0.641115  0.610738       DDLPS
##   -------
##   seqinfo: 23 sequences from an unspecified genome; no seqlengths</code></pre>
<div class="sourceCode" id="cb160"><pre class="downlit">
<span class="fu">rowRanges</span><span class="op">(</span><span class="va">gisticSARC</span><span class="op">)</span><span class="op">[</span><span class="va">ind.subcl</span><span class="op">]</span></pre></div>
<pre><code>## GRanges object with 64 ranges and 5 metadata columns:
##        seqnames              ranges strand |          type        band
##           &lt;Rle&gt;           &lt;IRanges&gt;  &lt;Rle&gt; |   &lt;character&gt; &lt;character&gt;
##    [1]     chr8  54604081-146364022      * | Amplification      8q24.3
##    [2]     chr9 134952380-141213431      * |      Deletion      9q34.3
##    [3]    chr17   57292827-81195210      * | Amplification     17q25.3
##    [4]     chr5           1-5129938      * |      Deletion     5p15.33
##    [5]     chr8           1-4251018      * |      Deletion      8p23.3
##    ...      ...                 ...    ... .           ...         ...
##   [60]     chr3   86917447-87350419      * | Amplification      3p12.1
##   [61]    chr10   89617158-89755074      * |      Deletion    10q23.31
##   [62]     chr8   37911089-38852966      * | Amplification     8p11.22
##   [63]    chr12   69178021-69244387      * | Amplification       12q15
##   [64]    chr13   48875329-49064807      * |      Deletion     13q14.2
##        assoc.score     subcl     subtype
##          &lt;numeric&gt; &lt;numeric&gt; &lt;character&gt;
##    [1]    10.11579  0.678788       DDLPS
##    [2]     6.36997  0.678322         LMS
##    [3]     8.58887  0.664557       DDLPS
##    [4]     7.65827  0.664430         LMS
##    [5]    19.49664  0.625000     MFS/UPS
##    ...         ...       ...         ...
##   [60]    18.08966  0.311475     MFS/UPS
##   [61]    33.94320  0.274510         LMS
##   [62]     3.39771  0.265152     MFS/UPS
##   [63]    55.91538  0.261905         LMS
##   [64]    30.25732  0.248588       DDLPS
##   -------
##   seqinfo: 23 sequences from an unspecified genome; no seqlengths</code></pre>
<div class="sourceCode" id="cb162"><pre class="downlit">
<span class="va">tests</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/warning.html">suppressWarnings</a></span><span class="op">(</span> <span class="fu">testSubtypes</span><span class="op">(</span><span class="va">gisticSARC</span>, <span class="va">sarcsubs</span>, what<span class="op">=</span><span class="st">"full"</span><span class="op">)</span> <span class="op">)</span>
<span class="va">extraL</span> <span class="op">&lt;-</span> <span class="fu">stratifySubclonality</span><span class="op">(</span><span class="va">gisticSARC</span>, <span class="va">subcl.gisticSARC</span>, 
    <span class="va">sarcsubs</span>, <span class="va">tests</span>, st.names<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">sarc.cols</span><span class="op">)</span><span class="op">)</span></pre></div>
<div class="sourceCode" id="cb163"><pre class="downlit">
<span class="va">x</span> <span class="op">&lt;-</span> <span class="va">extraL</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html">order</a></span><span class="op">(</span><span class="va">subcl.score</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">4</span><span class="op">)</span><span class="op">]</span><span class="op">]</span>
<span class="co"># loss, gain, loss</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"13q14.2 (RB1)"</span>, <span class="st">"12q15 (MDM2)"</span>, <span class="st">"10q23.31 (PTEN)"</span><span class="op">)</span>
<span class="va">sarc.hscl</span> <span class="op">&lt;-</span> <span class="va">extraL</span><span class="op">[</span><span class="fu">rowRanges</span><span class="op">(</span><span class="va">gisticSARC</span><span class="op">)</span><span class="op">$</span><span class="va">band</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"1p36.32"</span>, <span class="st">"8p23.3"</span>, <span class="st">"20q13.33"</span><span class="op">)</span><span class="op">]</span>
<span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">sarc.hscl</span><span class="op">)</span>
<span class="co"># loss, loss, loss</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">[</span><span class="fl">4</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"1p36.32 (TP73)"</span>, <span class="st">"8p23.2 (CSMD1)"</span>, <span class="st">"20q13.33"</span><span class="op">)</span>
<span class="fu">ggplotSubtypeStrata</span><span class="op">(</span><span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"loss"</span>,<span class="st">"gain"</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"loss"</span>, <span class="fl">3</span><span class="op">)</span>, <span class="st">"gain"</span><span class="op">)</span><span class="op">)</span></pre></div>
<p><img src="subtypeHeterogeneity_files/figure-html/clonalSubclSARC-1.png" width="100%"></p>
<p>Using histopathological classification for subtype assignment:</p>
<div class="sourceCode" id="cb164"><pre class="downlit">
<span class="va">histcl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">sarcsubs</span><span class="op">)</span><span class="op">)</span>
<span class="va">ind</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">grep</a></span><span class="op">(</span><span class="st">"myxofibrosarcoma"</span>, <span class="va">sarcsubs</span><span class="op">$</span><span class="va">histType</span><span class="op">)</span>
<span class="va">histcl</span><span class="op">[</span><span class="va">ind</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span>
<span class="va">ind</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">grep</a></span><span class="op">(</span><span class="st">"undifferentiated pleomorphic sarcoma"</span>, <span class="va">sarcsubs</span><span class="op">$</span><span class="va">histType</span><span class="op">)</span>
<span class="va">histcl</span><span class="op">[</span><span class="va">ind</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span>
<span class="va">ind</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">grep</a></span><span class="op">(</span><span class="st">"leiomyosarcoma"</span>, <span class="va">sarcsubs</span><span class="op">$</span><span class="va">histType</span><span class="op">)</span>
<span class="va">histcl</span><span class="op">[</span><span class="va">ind</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">2</span>
<span class="va">ind</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">grep</a></span><span class="op">(</span><span class="st">"dedifferentiated liposarcoma"</span>, <span class="va">sarcsubs</span><span class="op">$</span><span class="va">histType</span><span class="op">)</span>
<span class="va">histcl</span><span class="op">[</span><span class="va">ind</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">3</span>
<span class="va">histsubs</span> <span class="op">&lt;-</span> <span class="va">sarcsubs</span><span class="op">[</span><span class="va">histcl</span> <span class="op">!=</span> <span class="fl">4</span>,<span class="op">]</span>
<span class="va">histsubs</span><span class="op">$</span><span class="va">cluster</span> <span class="op">&lt;-</span> <span class="va">histcl</span><span class="op">[</span><span class="va">histcl</span> <span class="op">!=</span> <span class="fl">4</span><span class="op">]</span>  </pre></div>
<div class="sourceCode" id="cb165"><pre class="downlit">
<span class="va">assoc.score</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/warning.html">suppressWarnings</a></span><span class="op">(</span> <span class="fu">testSubtypes</span><span class="op">(</span><span class="va">gisticSARC</span>, <span class="va">histsubs</span>, what<span class="op">=</span><span class="st">"statistic"</span><span class="op">)</span> <span class="op">)</span>
<span class="va">raSARC</span> <span class="op">&lt;-</span> <span class="fu">getMatchedAbsoluteCalls</span><span class="op">(</span><span class="va">absGRL</span>, <span class="va">histsubs</span><span class="op">)</span>
<span class="va">subcl.gisticSARC</span> <span class="op">&lt;-</span> <span class="fu">querySubclonality</span><span class="op">(</span><span class="va">raSARC</span>, query<span class="op">=</span><span class="fu">rowRanges</span><span class="op">(</span><span class="va">gisticSARC</span><span class="op">)</span>, sum.method<span class="op">=</span><span class="st">"any"</span><span class="op">)</span>
<span class="va">subcl.score</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowMeans</a></span><span class="op">(</span><span class="va">subcl.gisticSARC</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">subcl.score</span><span class="op">)</span></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##  0.2308  0.3677  0.4748  0.4713  0.5511  0.6788</code></pre>
<div class="sourceCode" id="cb167"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="va">assoc.score</span>, <span class="va">subcl.score</span>, method<span class="op">=</span><span class="st">"spearman"</span><span class="op">)</span></pre></div>
<pre><code>## [1] -0.3810298</code></pre>
<div class="sourceCode" id="cb169"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/stats/cor.test.html">cor.test</a></span><span class="op">(</span><span class="va">assoc.score</span>, <span class="va">subcl.score</span>, method<span class="op">=</span><span class="st">"spearman"</span>, exact<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">$</span><span class="va">p.value</span></pre></div>
<pre><code>## [1] 0.001894787</code></pre>
<div id="overlapping-scnas-between-ov-and-sarc" class="section level3">
<h3 class="hasAnchor">
<a href="#overlapping-scnas-between-ov-and-sarc" class="anchor"></a>Overlapping SCNAs between OV and SARC</h3>
<div class="sourceCode" id="cb171"><pre class="downlit">
<span class="va">sarcranges</span> <span class="op">&lt;-</span> <span class="fu">rowRanges</span><span class="op">(</span><span class="va">gisticSARC</span><span class="op">)</span>
<span class="va">sarcranges</span><span class="op">$</span><span class="va">adj.pval</span> <span class="op">&lt;-</span> <span class="va">adj.pvals</span>
<span class="va">sarcranges</span><span class="op">$</span><span class="va">subcl</span> <span class="op">&lt;-</span> <span class="va">subcl.score</span>
<span class="va">ovranges</span> <span class="op">&lt;-</span> <span class="fu">rowRanges</span><span class="op">(</span><span class="va">gisticOV</span><span class="op">)</span>
<span class="fu">plotCommonSCNAs</span><span class="op">(</span><span class="va">ovranges</span>, <span class="va">sarcranges</span><span class="op">)</span></pre></div>
<p><img src="subtypeHeterogeneity_files/figure-html/ovsarcranges-1.png" width="100%"></p>
</div>
</div>
</div>
<div id="subtype-classification-in-single-cell-rna-seq-data" class="section level1">
<h1 class="hasAnchor">
<a href="#subtype-classification-in-single-cell-rna-seq-data" class="anchor"></a>Subtype classification in single-cell RNA-seq data</h1>
<div id="subtype-classification" class="section level2">
<h2 class="hasAnchor">
<a href="#subtype-classification" class="anchor"></a>Subtype classification</h2>
<p>Genes considered by the <code>consensusOV</code> classifier:</p>
<div class="sourceCode" id="cb172"><pre class="downlit">
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://www.pmgenomics.ca/bhklab/software/consensusOV">consensusOV</a></span><span class="op">)</span>
<span class="va">clgenes</span> <span class="op">&lt;-</span> <span class="fu">getClassifierGenes</span><span class="op">(</span><span class="op">)</span>
<span class="va">clgenes</span></pre></div>
<pre><code>##   [1] "10158"  "10278"  "10395"  "10437"  "10630"  "10635"  "10982"  "11343" 
##   [9] "1191"   "1288"   "1289"   "1295"   "1318"   "1490"   "1890"   "1901"  
##  [17] "2123"   "2149"   "2207"   "22836"  "22919"  "23022"  "23220"  "2335"  
##  [25] "2524"   "259173" "26271"  "27286"  "27299"  "301"    "3268"   "3627"  
##  [33] "3902"   "3903"   "3912"   "3925"   "3934"   "3956"   "4038"   "4082"  
##  [41] "4162"   "4237"   "4250"   "4261"   "4323"   "4430"   "4681"   "4837"  
##  [49] "4921"   "50615"  "51091"  "51177"  "5118"   "54020"  "54587"  "547"   
##  [57] "54961"  "55240"  "55340"  "5569"   "55859"  "55930"  "56937"  "57007" 
##  [65] "5732"   "5920"   "60489"  "6297"   "64092"  "642"    "6503"   "65108" 
##  [73] "65244"  "6602"   "6624"   "6782"   "7216"   "7345"   "7456"   "775"   
##  [81] "7805"   "79070"  "79083"  "800"    "81831"  "834"    "83439"  "8460"  
##  [89] "84707"  "8522"   "8533"   "8564"   "861"    "8655"   "8764"   "9246"  
##  [97] "9447"   "9610"   "9766"   "9854"   "9891"   "9940"   "9961"</code></pre>
<p>Single cell data restricted to classifier genes:</p>
<div class="sourceCode" id="cb174"><pre class="downlit">
<span class="va">sc.file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">data.dir</span>, <span class="st">"scRNAseq_consensusOV_genes.txt"</span><span class="op">)</span>
<span class="va">sc.expr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.delim</a></span><span class="op">(</span><span class="va">sc.file</span>, row.names<span class="op">=</span><span class="fl">1L</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">sc.expr</span><span class="op">)</span></pre></div>
<pre><code>## [1] 103  67</code></pre>
<div class="sourceCode" id="cb176"><pre class="downlit">
<span class="va">sc.expr</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></pre></div>
<pre><code>##       Bulk_2 X1_C01 X1_C02 X1_C03 X1_C08
## 26271  19.62      0      0      0   0.00
## 6782   47.73      0      0      0  79.25
## 57007  93.28      0      0      0   0.00
## 81831   0.00      0      0      0  16.29
## 5569    5.15      0      0      0   0.00</code></pre>
<div class="sourceCode" id="cb178"><pre class="downlit">
<span class="co"># exclude all zero </span>
<span class="va">ind</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">sc.expr</span>, <span class="fl">1</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/all.html">all</a></span><span class="op">(</span><span class="va">x</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span>
<span class="va">sc.expr</span> <span class="op">&lt;-</span> <span class="va">sc.expr</span><span class="op">[</span><span class="op">!</span><span class="va">ind</span>,<span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">sc.expr</span><span class="op">)</span></pre></div>
<pre><code>## [1] 99 67</code></pre>
<p>Get consensus subtypes:</p>
<div class="sourceCode" id="cb180"><pre class="downlit">
<span class="co"># consensus.subtypes &lt;- get.consensus.subtypes(sc.expr, rownames(sc.expr))</span>
<span class="va">res.file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">data.dir</span>, <span class="st">"consensus_subtypes_verhaak100.rds"</span><span class="op">)</span>
<span class="va">consensus.subtypes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="va">res.file</span><span class="op">)</span></pre></div>
</div>
<div id="cell-type-annotation" class="section level2">
<h2 class="hasAnchor">
<a href="#cell-type-annotation" class="anchor"></a>Cell type annotation</h2>
<p>Manual cell type annotation from Winterhoff el al:</p>
<div class="sourceCode" id="cb181"><pre class="downlit">
<span class="va">c2t.file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">data.dir</span>, <span class="st">"scRNAseq_celltypes.txt"</span><span class="op">)</span>
<span class="va">c2t</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.delim</a></span><span class="op">(</span><span class="va">c2t.file</span>, as.is<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
<span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"X"</span>, <span class="va">c2t</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span>
<span class="va">c2t</span> <span class="op">&lt;-</span> <span class="va">c2t</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">c2t</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">n</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">c2t</span><span class="op">)</span> </pre></div>
<pre><code>##   X1_C02   X1_C15   X1_C27   X1_C30   X1_C41   X1_C42 
## "Stroma" "Stroma" "Stroma" "Stroma" "Stroma" "Stroma"</code></pre>
<div class="sourceCode" id="cb183"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">c2t</span><span class="op">)</span></pre></div>
<pre><code>## c2t
## Epithelial     Stroma 
##         37         29</code></pre>
<p>Expression heatmap incl.Â subtype and cell type annotation:</p>
<div class="sourceCode" id="cb185"><pre class="downlit">
<span class="va">sind</span> <span class="op">&lt;-</span> <span class="fl">2</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">sc.expr</span><span class="op">)</span>
<span class="va">sc.subtypes</span> <span class="op">&lt;-</span> <span class="va">consensus.subtypes</span>
<span class="va">sc.subtypes</span><span class="op">$</span><span class="va">consensusOV.subtypes</span> <span class="op">&lt;-</span> <span class="va">sc.subtypes</span><span class="op">$</span><span class="va">consensusOV.subtypes</span><span class="op">[</span><span class="va">sind</span><span class="op">]</span>
<span class="va">sc.subtypes</span><span class="op">$</span><span class="va">rf.probs</span> <span class="op">&lt;-</span> <span class="va">sc.subtypes</span><span class="op">$</span><span class="va">rf.probs</span><span class="op">[</span><span class="va">sind</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>,<span class="fl">4</span>,<span class="fl">3</span><span class="op">)</span><span class="op">]</span>
<span class="fu">scHeatmap</span><span class="op">(</span><span class="va">sc.expr</span><span class="op">[</span>,<span class="va">sind</span><span class="op">]</span>, <span class="va">sc.subtypes</span><span class="op">)</span></pre></div>
<p><img src="subtypeHeterogeneity_files/figure-html/scHeatmap-1.png" width="100%"></p>
<p>Subtype by cell type:</p>
<div class="sourceCode" id="cb186"><pre class="downlit">
<span class="co"># subtype</span>
<span class="va">st</span> <span class="op">&lt;-</span> <span class="va">consensus.subtypes</span><span class="op">$</span><span class="va">consensusOV.subtypes</span><span class="op">[</span><span class="va">sind</span><span class="op">]</span>
<span class="va">st</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">sub</a></span><span class="op">(</span><span class="st">"_consensus$"</span>, <span class="st">""</span>, <span class="va">st</span><span class="op">)</span>
<span class="va">ct</span> <span class="op">&lt;-</span> <span class="va">c2t</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">sc.expr</span><span class="op">)</span><span class="op">[</span><span class="va">sind</span><span class="op">]</span><span class="op">]</span>

<span class="va">ept</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">st</span><span class="op">[</span><span class="va">ct</span><span class="op">==</span><span class="st">"Epithelial"</span><span class="op">]</span><span class="op">)</span>
<span class="va">ept</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">ept</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">ept</span><span class="op">)</span>, digits<span class="op">=</span><span class="fl">3</span><span class="op">)</span>
<span class="va">ept</span></pre></div>
<pre><code>## 
##   DIF   IMR 
## 0.108 0.892</code></pre>
<div class="sourceCode" id="cb188"><pre class="downlit">
<span class="va">stro</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">st</span><span class="op">[</span><span class="va">ct</span><span class="op">==</span><span class="st">"Stroma"</span><span class="op">]</span><span class="op">)</span>
<span class="va">stro</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">stro</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">stro</span><span class="op">)</span>, digits<span class="op">=</span><span class="fl">3</span><span class="op">)</span>
<span class="va">stro</span></pre></div>
<pre><code>## 
##   IMR   MES 
## 0.724 0.276</code></pre>
<p>Contrasting manual with computational cell type annotation:</p>
<div class="sourceCode" id="cb190"><pre class="downlit">
<span class="va">sc.file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">data.dir</span>, <span class="st">"scRNAseq_symbols.rds"</span><span class="op">)</span>
<span class="va">sc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="va">sc.file</span><span class="op">)</span>
<span class="va">sc</span></pre></div>
<pre><code>## class: SummarizedExperiment 
## dim: 17652 93 
## metadata(1): annotation
## assays(1): ''
## rownames(17652): A1BG A1CF ... ZZEF1 ZZZ3
## rowData names(0):
## colnames(93): Bulk_2 X1_C01 ... X2_C89 X2_C95
## colData names(0):</code></pre>
<div class="sourceCode" id="cb192"><pre class="downlit">
<span class="fu">assay</span><span class="op">(</span><span class="va">sc</span>, <span class="st">"logcounts"</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="fu">assay</span><span class="op">(</span><span class="va">sc</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>
<span class="va">hpc</span> <span class="op">&lt;-</span> <span class="fu">transferCellType</span><span class="op">(</span><span class="va">sc</span><span class="op">[</span>,<span class="fl">2</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">sc</span><span class="op">)</span><span class="op">]</span>, <span class="st">"hpca"</span><span class="op">)</span>
<span class="va">encode</span> <span class="op">&lt;-</span> <span class="fu">transferCellType</span><span class="op">(</span><span class="va">sc</span><span class="op">[</span>,<span class="fl">2</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">sc</span><span class="op">)</span><span class="op">]</span>, <span class="st">"encode"</span><span class="op">)</span></pre></div>
<p>Verhaak subtypes:</p>
<div class="sourceCode" id="cb193"><pre class="downlit">
<span class="va">sc.entrez</span> <span class="op">&lt;-</span> <span class="fu">EnrichmentBrowser</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/EnrichmentBrowser/man/idMap.html">idMap</a></span><span class="op">(</span><span class="va">sc</span>, from <span class="op">=</span> <span class="st">"SYMBOL"</span>, to <span class="op">=</span> <span class="st">"ENTREZID"</span><span class="op">)</span>
<span class="va">sc.entrez</span> <span class="op">&lt;-</span> <span class="va">sc.entrez</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span><span class="op">(</span><span class="fu">assay</span><span class="op">(</span><span class="va">sc.entrez</span><span class="op">)</span><span class="op">[</span>,<span class="fl">2</span><span class="op">:</span><span class="fl">93</span><span class="op">]</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">10</span>,<span class="op">]</span>
<span class="va">vst</span> <span class="op">&lt;-</span> <span class="fu">consensusOV</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/consensusOV/man/get.verhaak.subtypes.html">get.verhaak.subtypes</a></span><span class="op">(</span><span class="fu">assay</span><span class="op">(</span><span class="va">sc.entrez</span>, <span class="st">"logcounts"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">sc.entrez</span><span class="op">)</span><span class="op">)</span></pre></div>
<pre><code>## Setting parallel calculations through a MulticoreParam back-end
## with workers=4 and tasks=100.
## Estimating ssGSEA scores for 4 gene sets.
## 
  |                                                                            
  |                                                                      |   0%
  |                                                                            
  |=                                                                     |   1%
  |                                                                            
  |==                                                                    |   2%
  |                                                                            
  |==                                                                    |   3%
  |                                                                            
  |===                                                                   |   4%
  |                                                                            
  |====                                                                  |   5%
  |                                                                            
  |=====                                                                 |   6%
  |                                                                            
  |=====                                                                 |   8%
  |                                                                            
  |======                                                                |   9%
  |                                                                            
  |=======                                                               |  10%
  |                                                                            
  |========                                                              |  11%
  |                                                                            
  |========                                                              |  12%
  |                                                                            
  |=========                                                             |  13%
  |                                                                            
  |==========                                                            |  14%
  |                                                                            
  |===========                                                           |  15%
  |                                                                            
  |===========                                                           |  16%
  |                                                                            
  |============                                                          |  17%
  |                                                                            
  |=============                                                         |  18%
  |                                                                            
  |==============                                                        |  19%
  |                                                                            
  |==============                                                        |  20%
  |                                                                            
  |===============                                                       |  22%
  |                                                                            
  |================                                                      |  23%
  |                                                                            
  |=================                                                     |  24%
  |                                                                            
  |=================                                                     |  25%
  |                                                                            
  |==================                                                    |  26%
  |                                                                            
  |===================                                                   |  27%
  |                                                                            
  |====================                                                  |  28%
  |                                                                            
  |====================                                                  |  29%
  |                                                                            
  |=====================                                                 |  30%
  |                                                                            
  |======================                                                |  31%
  |                                                                            
  |=======================                                               |  32%
  |                                                                            
  |=======================                                               |  33%
  |                                                                            
  |========================                                              |  34%
  |                                                                            
  |=========================                                             |  35%
  |                                                                            
  |==========================                                            |  37%
  |                                                                            
  |==========================                                            |  38%
  |                                                                            
  |===========================                                           |  39%
  |                                                                            
  |============================                                          |  40%
  |                                                                            
  |=============================                                         |  41%
  |                                                                            
  |=============================                                         |  42%
  |                                                                            
  |==============================                                        |  43%
  |                                                                            
  |===============================                                       |  44%
  |                                                                            
  |================================                                      |  45%
  |                                                                            
  |================================                                      |  46%
  |                                                                            
  |=================================                                     |  47%
  |                                                                            
  |==================================                                    |  48%
  |                                                                            
  |===================================                                   |  49%
  |                                                                            
  |===================================                                   |  51%
  |                                                                            
  |====================================                                  |  52%
  |                                                                            
  |=====================================                                 |  53%
  |                                                                            
  |======================================                                |  54%
  |                                                                            
  |======================================                                |  55%
  |                                                                            
  |=======================================                               |  56%
  |                                                                            
  |========================================                              |  57%
  |                                                                            
  |=========================================                             |  58%
  |                                                                            
  |=========================================                             |  59%
  |                                                                            
  |==========================================                            |  60%
  |                                                                            
  |===========================================                           |  61%
  |                                                                            
  |============================================                          |  62%
  |                                                                            
  |============================================                          |  63%
  |                                                                            
  |=============================================                         |  65%
  |                                                                            
  |==============================================                        |  66%
  |                                                                            
  |===============================================                       |  67%
  |                                                                            
  |===============================================                       |  68%
  |                                                                            
  |================================================                      |  69%
  |                                                                            
  |=================================================                     |  70%
  |                                                                            
  |==================================================                    |  71%
  |                                                                            
  |==================================================                    |  72%
  |                                                                            
  |===================================================                   |  73%
  |                                                                            
  |====================================================                  |  74%
  |                                                                            
  |=====================================================                 |  75%
  |                                                                            
  |=====================================================                 |  76%
  |                                                                            
  |======================================================                |  77%
  |                                                                            
  |=======================================================               |  78%
  |                                                                            
  |========================================================              |  80%
  |                                                                            
  |========================================================              |  81%
  |                                                                            
  |=========================================================             |  82%
  |                                                                            
  |==========================================================            |  83%
  |                                                                            
  |===========================================================           |  84%
  |                                                                            
  |===========================================================           |  85%
  |                                                                            
  |============================================================          |  86%
  |                                                                            
  |=============================================================         |  87%
  |                                                                            
  |==============================================================        |  88%
  |                                                                            
  |==============================================================        |  89%
  |                                                                            
  |===============================================================       |  90%
  |                                                                            
  |================================================================      |  91%
  |                                                                            
  |=================================================================     |  92%
  |                                                                            
  |=================================================================     |  94%
  |                                                                            
  |==================================================================    |  95%
  |                                                                            
  |===================================================================   |  96%
  |                                                                            
  |====================================================================  |  97%
  |                                                                            
  |====================================================================  |  98%
  |                                                                            
  |===================================================================== |  99%
  |                                                                            
  |======================================================================| 100%</code></pre>
<div class="sourceCode" id="cb195"><pre class="downlit">
<span class="va">vst</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">vst</span><span class="op">$</span><span class="va">Verhaak.subtypes</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">vst</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">sc.entrez</span><span class="op">)</span></pre></div>
<div class="sourceCode" id="cb196"><pre class="downlit">
<span class="va">acol</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>Winterhoff <span class="op">=</span> <span class="va">c2t</span>, Verhaak <span class="op">=</span> <span class="va">vst</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">c2t</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>
<span class="fu">SingleR</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/SingleR/man/plotScoreHeatmap.html">plotScoreHeatmap</a></span><span class="op">(</span><span class="va">encode</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">c2t</span><span class="op">)</span>,<span class="op">]</span>, annotation_col <span class="op">=</span> <span class="va">acol</span><span class="op">)</span></pre></div>
<p><img src="subtypeHeterogeneity_files/figure-html/unnamed-chunk-4-1.png" width="100%"></p>
<div class="sourceCode" id="cb197"><pre class="downlit">
<span class="fu">SingleR</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/SingleR/man/plotScoreHeatmap.html">plotScoreHeatmap</a></span><span class="op">(</span><span class="va">hpc</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">c2t</span><span class="op">)</span>,<span class="op">]</span>, annotation_col <span class="op">=</span> <span class="va">acol</span><span class="op">)</span></pre></div>
<p><img src="subtypeHeterogeneity_files/figure-html/unnamed-chunk-4-2.png" width="100%"> ## Margin score distribution</p>
<p>Margin scores in comparison to TCGA bulk:</p>
<div class="sourceCode" id="cb198"><pre class="downlit">
<span class="va">m100</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.0060</span>, <span class="fl">0.1425</span>, <span class="fl">0.2450</span>, <span class="fl">0.2551</span>, <span class="fl">0.3580</span>, <span class="fl">0.8460</span><span class="op">)</span>
<span class="va">m800</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.0020</span>, <span class="fl">0.1270</span>, <span class="fl">0.2050</span>, <span class="fl">0.2061</span>, <span class="fl">0.2860</span>, <span class="fl">0.4420</span><span class="op">)</span>
<span class="va">tcga.ma</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.0060</span>,  <span class="fl">0.2265</span>,  <span class="fl">0.5250</span>,  <span class="fl">0.5196</span>,  <span class="fl">0.8115</span>,  <span class="fl">1.0000</span><span class="op">)</span>
<span class="va">tcga.rseq</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.0000</span>,  <span class="fl">0.2700</span>,  <span class="fl">0.6020</span>,  <span class="fl">0.5524</span>,  <span class="fl">0.8280</span>,  <span class="fl">1.0000</span><span class="op">)</span>
<span class="va">tcga.rseq.down</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.0060</span>,  <span class="fl">0.2610</span>,  <span class="fl">0.5220</span>,  <span class="fl">0.5085</span>,  <span class="fl">0.7740</span>, <span class="fl">0.9940</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">m100</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Min."</span>, <span class="st">"1st Qu."</span>,  <span class="st">"Median"</span>, <span class="st">"Mean"</span>, <span class="st">"3rd Qu."</span>,    <span class="st">"Max."</span><span class="op">)</span> 
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">m800</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">tcga.ma</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">tcga.rseq.down</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">tcga.rseq</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">m100</span><span class="op">)</span>    

<span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>
    x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"scRNAseq100"</span>, <span class="st">"scRNAseq800"</span>, <span class="st">"TCGA-RNAseq \n (downsampled)"</span>, <span class="st">"TCGA-RNAseq"</span>, <span class="st">"TCGA-Marray"</span><span class="op">)</span>, 
    <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">m100</span>, <span class="va">m800</span>, <span class="va">tcga.rseq.down</span>, <span class="va">tcga.rseq</span>, <span class="va">tcga.ma</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">7</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"y0"</span>, <span class="st">"y25"</span>, <span class="st">"y50"</span>, <span class="st">"mean"</span>, <span class="st">"y75"</span>, <span class="st">"y100"</span><span class="op">)</span> 
<span class="va">df</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">df</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, levels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rev.html">rev</a></span><span class="op">(</span><span class="va">df</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
<span class="va">my.predictions.margins</span> <span class="op">&lt;-</span> <span class="fu">subtypeHeterogeneity</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/consensusOV/man/get.consensus.subtypes.html">margin</a></span><span class="op">(</span><span class="va">consensus.subtypes</span><span class="op">$</span><span class="va">rf.probs</span><span class="op">)</span><span class="op">[</span><span class="va">sind</span><span class="op">]</span>
<span class="va">df</span><span class="op">[</span><span class="fl">1</span>,<span class="st">"y100"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">my.predictions.margins</span>, <span class="fl">0.95</span><span class="op">)</span>

<span class="va">df.points</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">5</span>,<span class="fl">4</span>,<span class="fl">5</span><span class="op">)</span>, y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.482</span>, <span class="fl">0.452</span>, <span class="fl">0.846</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">df</span>,
        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x</span>, ymin<span class="op">=</span><span class="va">y0</span>, lower<span class="op">=</span><span class="va">y25</span>, middle<span class="op">=</span><span class="va">y50</span>, upper<span class="op">=</span><span class="va">y75</span>, ymax<span class="op">=</span><span class="va">y100</span><span class="op">)</span>, 
        stat<span class="op">=</span><span class="st">"identity"</span>, fill<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="va">cb.blue</span>, <span class="fl">3</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="va">cb.red</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">df.points</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>,<span class="op">]</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x</span>, y<span class="op">=</span><span class="va">y</span><span class="op">)</span>, color<span class="op">=</span><span class="va">cb.red</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">df.points</span><span class="op">[</span><span class="fl">3</span>,<span class="op">]</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x</span>, y<span class="op">=</span><span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_text</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">df.points</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>,<span class="op">]</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x</span>, y<span class="op">=</span><span class="va">y</span><span class="op">)</span>, 
                color<span class="op">=</span><span class="va">cb.red</span>, label<span class="op">=</span><span class="st">"Bulk"</span>, hjust<span class="op">=</span><span class="fl">0</span>, nudge_x <span class="op">=</span> <span class="fl">0.2</span>, size<span class="op">=</span><span class="fl">6</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">""</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"margin score"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_grey</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">18</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html">coord_flip</a></span><span class="op">(</span><span class="op">)</span></pre></div>
<p><img src="subtypeHeterogeneity_files/figure-html/marginCompTCGA-1.png" width="100%"></p>
<p>Consistency of subtpye calls (TCGA OV microarray vs RNA-seq):</p>
<div class="sourceCode" id="cb199"><pre class="downlit">
<span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">73</span>, <span class="fl">6</span>, <span class="fl">1</span>, <span class="fl">2</span>,
        <span class="fl">7</span>, <span class="fl">67</span>, <span class="fl">1</span>, <span class="fl">1</span>,
        <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">76</span>, <span class="fl">0</span>,
        <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">4</span>, <span class="fl">55</span><span class="op">)</span>, ncol<span class="op">=</span><span class="fl">4</span>, nrow<span class="op">=</span><span class="fl">4</span>, byrow<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"IMR"</span>, <span class="st">"DIF"</span>, <span class="st">"PRO"</span>, <span class="st">"MES"</span><span class="op">)</span>
<span class="va">m</span> <span class="op">&lt;-</span> <span class="va">m</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">1</span>,<span class="fl">4</span>,<span class="fl">3</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">1</span>,<span class="fl">4</span>,<span class="fl">3</span><span class="op">)</span><span class="op">]</span>
<span class="va">df</span> <span class="op">&lt;-</span> <span class="fu">reshape2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html">melt</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span>
<span class="va">df</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">df</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>, levels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rev.html">rev</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">df</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">df</span><span class="op">$</span><span class="va">color</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">value</span> <span class="op">&gt;</span> <span class="fl">10</span>, <span class="st">"white"</span>, <span class="st">"grey46"</span><span class="op">)</span>
<span class="va">df</span><span class="op">$</span><span class="va">class</span> <span class="op">&lt;-</span> <span class="st">"Top100%"</span>

<span class="va">m2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">46</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>,
        <span class="fl">1</span>, <span class="fl">47</span>, <span class="fl">0</span>, <span class="fl">0</span>,
        <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">59</span>, <span class="fl">0</span>,
        <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">40</span><span class="op">)</span>, ncol<span class="op">=</span><span class="fl">4</span>, nrow<span class="op">=</span><span class="fl">4</span>, byrow<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">m2</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">m2</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"IMR"</span>, <span class="st">"DIF"</span>, <span class="st">"PRO"</span>, <span class="st">"MES"</span><span class="op">)</span>
<span class="va">m2</span> <span class="op">&lt;-</span> <span class="va">m2</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">1</span>,<span class="fl">4</span>,<span class="fl">3</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">1</span>,<span class="fl">4</span>,<span class="fl">3</span><span class="op">)</span><span class="op">]</span>
<span class="va">df2</span> <span class="op">&lt;-</span> <span class="fu">reshape2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html">melt</a></span><span class="op">(</span><span class="va">m2</span><span class="op">)</span>
<span class="va">df2</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">df2</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>, levels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rev.html">rev</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">df2</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">df2</span><span class="op">$</span><span class="va">color</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">df2</span><span class="op">$</span><span class="va">value</span> <span class="op">&gt;</span> <span class="fl">10</span>, <span class="st">"white"</span>, <span class="st">"grey46"</span><span class="op">)</span>
<span class="va">df2</span><span class="op">$</span><span class="va">class</span> <span class="op">&lt;-</span> <span class="st">"Top75%"</span>

<span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">df</span>,<span class="va">df2</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Microarray"</span>, <span class="st">"RNAseq"</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">Microarray</span>, <span class="va">RNAseq</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_tile</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill<span class="op">=</span><span class="va">value</span><span class="op">)</span>, color<span class="op">=</span><span class="st">"white"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html">scale_fill_gradient2</a></span><span class="op">(</span>low<span class="op">=</span><span class="st">"white"</span>, high<span class="op">=</span><span class="st">"red"</span>, guide<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_text</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>label<span class="op">=</span><span class="va">value</span><span class="op">)</span>, size<span class="op">=</span><span class="fl">6</span>, color<span class="op">=</span><span class="va">df</span><span class="op">$</span><span class="va">color</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>angle<span class="op">=</span><span class="fl">45</span>, vjust<span class="op">=</span><span class="fl">1</span>, hjust<span class="op">=</span><span class="fl">1</span>, size<span class="op">=</span><span class="fl">12</span><span class="op">)</span>,
            axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">12</span><span class="op">)</span>, 
            strip.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">12</span>, face<span class="op">=</span><span class="st">"bold"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html">coord_equal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>   
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span> <span class="op">~</span> <span class="va">class</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></pre></div>
<p><img src="subtypeHeterogeneity_files/figure-html/tcgaMAvsRSEQ-1.png" width="100%"></p>
</div>
<div id="extension-of-consensus-classifier" class="section level2">
<h2 class="hasAnchor">
<a href="#extension-of-consensus-classifier" class="anchor"></a>Extension of consensus classifier</h2>
<div class="sourceCode" id="cb200"><pre class="downlit">
<span class="co"># Supplementary Table S8A from Verhaak et al, JCI, 2013</span>
<span class="va">verhaak.file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">data.dir</span>, <span class="st">"Verhaak_supplementT8A.txt"</span><span class="op">)</span>
<span class="va">verhaak800</span> <span class="op">&lt;-</span> <span class="fu">getExtendedVerhaakSignature</span><span class="op">(</span><span class="va">verhaak.file</span>, nr.genes.per.subtype<span class="op">=</span><span class="fl">200</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">verhaak800</span><span class="op">)</span></pre></div>
<pre><code>## [1] 800</code></pre>
<div class="sourceCode" id="cb202"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">verhaak800</span><span class="op">)</span></pre></div>
<pre><code>## [1] "ABHD11" "ABTB2"  "ACE2"   "ACP6"   "ACSBG1" "ACSL5"</code></pre>
<div class="sourceCode" id="cb204"><pre class="downlit">
<span class="co"># Supplementary Table S7 from Verhaak et al, JCI, 2013</span>
<span class="va">verhaak100.file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">data.dir</span>, <span class="st">"Verhaak_100genes.txt"</span><span class="op">)</span>
<span class="va">verhaak100</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.delim</a></span><span class="op">(</span><span class="va">verhaak100.file</span>, as.is<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
<span class="va">verhaak100</span> <span class="op">&lt;-</span> <span class="va">verhaak100</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">101</span>,<span class="fl">1</span><span class="op">]</span></pre></div>
<p>Merge:</p>
<div class="sourceCode" id="cb205"><pre class="downlit">
<span class="va">verhaak800</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">verhaak100</span>, <span class="va">verhaak800</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></pre></div>
<p>Build extended training set based on extended verhaak signature:</p>
<div class="sourceCode" id="cb206"><pre class="downlit">
<span class="va">selectGenes</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">eset</span><span class="op">)</span>
<span class="op">{</span>
    <span class="va">ind</span> <span class="op">&lt;-</span> <span class="fu">fData</span><span class="op">(</span><span class="va">eset</span><span class="op">)</span><span class="op">$</span><span class="va">gene</span> <span class="op">%in%</span> <span class="va">verhaak800</span>
    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">eset</span><span class="op">[</span><span class="va">ind</span>,<span class="op">]</span><span class="op">)</span> 
<span class="op">}</span>
<span class="va">eset.file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">data.dir</span>, <span class="st">"esets.rescaled.classified.filtered.RData"</span><span class="op">)</span>
<span class="va">esets</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="va">eset.file</span><span class="op">)</span><span class="op">)</span>
<span class="va">esets.merged</span> <span class="op">&lt;-</span> <span class="fu">consensusOV</span><span class="fu">:::</span><span class="fu"><a href="https://rdrr.io/pkg/consensusOV/man/dataset.merging.html">dataset.merging</a></span><span class="op">(</span><span class="va">esets</span>, method <span class="op">=</span> <span class="st">"intersect"</span>, standardization <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></pre></div>
<pre><code>## Warning in `[&lt;-.factor`(`*tmp*`, ri, value = c(62L, 151L, 106L, 111L, 122L, :
## invalid factor level, NA generated</code></pre>
<div class="sourceCode" id="cb208"><pre class="downlit">
<span class="co"># sanity check</span>
<span class="va">fnames</span> <span class="op">&lt;-</span> <span class="fu">featureNames</span><span class="op">(</span><span class="fu">consensusOV</span><span class="fu">:::</span><span class="va">consensus.training.dataset.full</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span>
<span class="va">snames</span> <span class="op">&lt;-</span> <span class="fu">sampleNames</span><span class="op">(</span><span class="fu">consensusOV</span><span class="fu">:::</span><span class="va">consensus.training.dataset.full</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/tidyeval.html">exprs</a></span><span class="op">(</span><span class="va">esets.merged</span><span class="op">)</span><span class="op">[</span><span class="va">fnames</span>, <span class="va">snames</span><span class="op">]</span></pre></div>
<pre><code>##              E.MTAB.386_DFCI.1 E.MTAB.386_DFCI.2 E.MTAB.386_DFCI.3
## geneid.10278        -1.2563391       -0.46432113         1.2824999
## geneid.10395        -0.5284934       -0.06292062        -0.1491063
##              E.MTAB.386_DFCI.4 E.MTAB.386_DFCI.6
## geneid.10278        -0.0242163         0.5624844
## geneid.10395        -1.1021949         0.9263993</code></pre>
<div class="sourceCode" id="cb210"><pre class="downlit">
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/tidyeval.html">exprs</a></span><span class="op">(</span><span class="fu">consensusOV</span><span class="fu">:::</span><span class="va">consensus.training.dataset.full</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">3</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></pre></div>
<pre><code>##              E.MTAB.386_DFCI.1 E.MTAB.386_DFCI.2 E.MTAB.386_DFCI.3
## geneid.10278        -1.2563391       -0.46432113         1.2824999
## geneid.10395        -0.5284934       -0.06292062        -0.1491063
##              E.MTAB.386_DFCI.4 E.MTAB.386_DFCI.6
## geneid.10278        -0.0242163         0.5624844
## geneid.10395        -1.1021949         0.9263993</code></pre>
<div class="sourceCode" id="cb212"><pre class="downlit">
<span class="va">training.ext</span> <span class="op">&lt;-</span> <span class="va">esets.merged</span></pre></div>
<p>Single cell data restricted to verhaak800 signature:</p>
<div class="sourceCode" id="cb213"><pre class="downlit">
<span class="va">sc.file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">data.dir</span>, <span class="st">"scRNAseq_verhaak800.txt"</span><span class="op">)</span>
<span class="va">sc.expr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.delim</a></span><span class="op">(</span><span class="va">sc.file</span>, row.names<span class="op">=</span><span class="fl">1L</span><span class="op">)</span><span class="op">)</span>
<span class="va">sc.expr</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></pre></div>
<pre><code>##       Bulk_2 X1_C01 X1_C02 X1_C03 X1_C08
## 10062   2.37      0   0.00   0.00    0.0
## 10085   5.51      0 354.31   0.00    0.0
## 1009   60.05      0   0.26   0.00    0.0
## 10137  15.54      0   0.00   0.00    1.3
## 1019   45.57      0   0.00  16.67    0.0</code></pre>
<div class="sourceCode" id="cb215"><pre class="downlit">
<span class="co"># exclude NA</span>
<span class="va">ind</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">sc.expr</span>, <span class="fl">1</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/any.html">any</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">sc.expr</span> <span class="op">&lt;-</span> <span class="va">sc.expr</span><span class="op">[</span><span class="op">!</span><span class="va">ind</span>,<span class="op">]</span>
<span class="co"># exclude all zero </span>
<span class="va">ind</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">sc.expr</span>, <span class="fl">1</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/all.html">all</a></span><span class="op">(</span><span class="va">x</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span>
<span class="va">sc.expr</span> <span class="op">&lt;-</span> <span class="va">sc.expr</span><span class="op">[</span><span class="op">!</span><span class="va">ind</span>,<span class="op">]</span></pre></div>
<div class="sourceCode" id="cb216"><pre class="downlit">
<span class="co"># takes a while</span>
<span class="co"># consensus.subtypes &lt;- get.consensus.subtypes(sc.expr, rownames(sc.expr), .training.dataset=training.ext)</span>
<span class="va">res.file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">data.dir</span>, <span class="st">"consensus_subtypes_verhaak800.rds"</span><span class="op">)</span>
<span class="va">consensus.subtypes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="va">res.file</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">consensus.subtypes</span><span class="op">$</span><span class="va">consensusOV.subtypes</span><span class="op">)</span></pre></div>
<pre><code>## 
## IMR_consensus DIF_consensus PRO_consensus MES_consensus 
##            57             2             0             8</code></pre>
<div class="sourceCode" id="cb218"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">consensus.subtypes</span><span class="op">$</span><span class="va">rf.probs</span><span class="op">)</span></pre></div>
<pre><code>##        DIF_consensus IMR_consensus MES_consensus PRO_consensus
## Bulk_2         0.126         0.638         0.186         0.050
## X1_C01         0.232         0.654         0.054         0.060
## X1_C02         0.160         0.382         0.326         0.132
## X1_C03         0.338         0.508         0.068         0.086
## X1_C08         0.286         0.616         0.050         0.048
## X1_C15         0.256         0.360         0.256         0.128</code></pre>
<div class="sourceCode" id="cb220"><pre class="downlit">
<span class="co"># Margins</span>
<span class="va">my.predictions.margins</span> <span class="op">&lt;-</span> <span class="fu">subtypeHeterogeneity</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/consensusOV/man/get.consensus.subtypes.html">margin</a></span><span class="op">(</span><span class="va">consensus.subtypes</span><span class="op">$</span><span class="va">rf.probs</span><span class="op">)</span>
<span class="co"># Bulk</span>
<span class="va">my.predictions.margins</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></pre></div>
<pre><code>## Bulk_2 
##  0.452</code></pre>
<div class="sourceCode" id="cb222"><pre class="downlit">
<span class="co"># Cells</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">my.predictions.margins</span><span class="op">[</span><span class="va">sind</span><span class="op">]</span><span class="op">)</span></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##  0.0020  0.1270  0.2050  0.2061  0.2860  0.4420</code></pre>
<div class="sourceCode" id="cb224"><pre class="downlit">
<span class="va">sc.subtypes</span> <span class="op">&lt;-</span> <span class="va">consensus.subtypes</span>
<span class="va">sc.subtypes</span><span class="op">$</span><span class="va">consensusOV.subtypes</span> <span class="op">&lt;-</span> <span class="va">sc.subtypes</span><span class="op">$</span><span class="va">consensusOV.subtypes</span><span class="op">[</span><span class="va">sind</span><span class="op">]</span>
<span class="va">sc.subtypes</span><span class="op">$</span><span class="va">rf.probs</span> <span class="op">&lt;-</span> <span class="va">sc.subtypes</span><span class="op">$</span><span class="va">rf.probs</span><span class="op">[</span><span class="va">sind</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>,<span class="fl">4</span>,<span class="fl">3</span><span class="op">)</span><span class="op">]</span>
<span class="fu">scHeatmap</span><span class="op">(</span><span class="va">sc.expr</span><span class="op">[</span>,<span class="va">sind</span><span class="op">]</span>, <span class="va">sc.subtypes</span><span class="op">)</span></pre></div>
<p><img src="subtypeHeterogeneity_files/figure-html/consSubtypesExt-1.png" width="100%"></p>
<div class="sourceCode" id="cb225"><pre class="downlit">
<span class="va">expr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">sc.expr</span> <span class="op">+</span> <span class="fl">1</span>, base<span class="op">=</span><span class="fl">2</span><span class="op">)</span>
<span class="va">ind</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span><span class="op">(</span><span class="va">expr</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">3</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">sc.expr</span><span class="op">[</span><span class="va">ind</span>,<span class="op">]</span><span class="op">)</span></pre></div>
<pre><code>## [1] 355  67</code></pre>
<div class="sourceCode" id="cb227"><pre class="downlit">
<span class="co"># consensus.subtypes2 &lt;- get.consensus.subtypes(sc.expr[ind,], rownames(sc.expr)[ind], .training.dataset=esets.merged)</span>
<span class="va">res.file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">data.dir</span>, <span class="st">"consensus_subtypes_verhaak800_logTPMgr3.rds"</span><span class="op">)</span>
<span class="va">consensus.subtypes2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="va">res.file</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">consensus.subtypes2</span><span class="op">$</span><span class="va">consensusOV.subtypes</span><span class="op">)</span></pre></div>
<pre><code>## 
## IMR_consensus DIF_consensus PRO_consensus MES_consensus 
##            52             4             0            11</code></pre>
<div class="sourceCode" id="cb229"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">consensus.subtypes2</span><span class="op">$</span><span class="va">rf.probs</span><span class="op">)</span></pre></div>
<pre><code>##        DIF_consensus IMR_consensus MES_consensus PRO_consensus
## Bulk_2         0.122         0.630         0.194         0.054
## X1_C01         0.254         0.626         0.074         0.046
## X1_C02         0.148         0.366         0.380         0.106
## X1_C03         0.372         0.446         0.092         0.090
## X1_C08         0.340         0.522         0.074         0.064
## X1_C15         0.258         0.360         0.228         0.154</code></pre>
<div class="sourceCode" id="cb231"><pre class="downlit">
<span class="co"># Margins</span>
<span class="va">my.predictions.margins</span> <span class="op">&lt;-</span> <span class="fu">subtypeHeterogeneity</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/consensusOV/man/get.consensus.subtypes.html">margin</a></span><span class="op">(</span><span class="va">consensus.subtypes2</span><span class="op">$</span><span class="va">rf.probs</span><span class="op">)</span>
<span class="co"># Bulk</span>
<span class="va">my.predictions.margins</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></pre></div>
<pre><code>## Bulk_2 
##  0.436</code></pre>
<div class="sourceCode" id="cb233"><pre class="downlit">
<span class="co"># Cells</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">my.predictions.margins</span><span class="op">[</span><span class="va">sind</span><span class="op">]</span><span class="op">)</span></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##  0.0060  0.0975  0.1550  0.1784  0.2575  0.3820</code></pre>
</div>
<div id="downsampling" class="section level2">
<h2 class="hasAnchor">
<a href="#downsampling" class="anchor"></a>Downsampling</h2>
<p>Full scRNA-seq dataset based on gene symbols:</p>
<div class="sourceCode" id="cb235"><pre class="downlit">
<span class="va">sc.file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">data.dir</span>, <span class="st">"scRNAseq_symbols.rds"</span><span class="op">)</span>
<span class="va">sc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="va">sc.file</span><span class="op">)</span>
<span class="va">sc</span></pre></div>
<pre><code>## class: SummarizedExperiment 
## dim: 17652 93 
## metadata(1): annotation
## assays(1): ''
## rownames(17652): A1BG A1CF ... ZZEF1 ZZZ3
## rowData names(0):
## colnames(93): Bulk_2 X1_C01 ... X2_C89 X2_C95
## colData names(0):</code></pre>
<p>TCGA bulk RNA-seq data:</p>
<div class="sourceCode" id="cb237"><pre class="downlit">
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">curatedTCGAData</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/message.html">suppressMessages</a></span><span class="op">(</span><span class="va">tcga</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/curatedTCGAData/man/curatedTCGAData.html">curatedTCGAData</a></span><span class="op">(</span><span class="st">"OV"</span>, <span class="st">"RNASeq2GeneNorm"</span>, <span class="cn">FALSE</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
<span class="va">tcga</span></pre></div>
<pre><code>## class: SummarizedExperiment 
## dim: 20501 307 
## metadata(0):
## assays(1): ''
## rownames(20501): A1BG A1CF ... psiTPTE22 tAKR
## rowData names(0):
## colnames(307): TCGA-04-1348-01A-01R-1565-13
##   TCGA-04-1357-01A-01R-1565-13 ... TCGA-VG-A8LO-01A-11R-A406-31
##   TCGA-WR-A838-01A-12R-A406-31
## colData names(0):</code></pre>
<p>Restrict to intersecting genes:</p>
<div class="sourceCode" id="cb239"><pre class="downlit">
<span class="va">tcga</span> <span class="op">&lt;-</span> <span class="va">tcga</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">sc</span><span class="op">)</span>,<span class="op">]</span></pre></div>
<p>Check library sizes:</p>
<div class="sourceCode" id="cb240"><pre class="downlit">
<span class="op">(</span><span class="va">sc.ls</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colSums</a></span><span class="op">(</span><span class="fu">assay</span><span class="op">(</span><span class="va">sc</span><span class="op">)</span><span class="op">[</span>,<span class="va">sind</span><span class="op">]</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##   13517  655358  751744  670003  778344  831553</code></pre>
<div class="sourceCode" id="cb242"><pre class="downlit">
<span class="op">(</span><span class="va">tcga.ls</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colSums</a></span><span class="op">(</span><span class="fu">assay</span><span class="op">(</span><span class="va">tcga</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></pre></div>
<pre><code>##     Min.  1st Qu.   Median     Mean  3rd Qu.     Max. 
## 15419902 17620434 18369353 18503730 19208051 24798574</code></pre>
<div class="sourceCode" id="cb244"><pre class="downlit">
<span class="op">(</span><span class="va">ls.prob</span> <span class="op">&lt;-</span> <span class="va">sc.ls</span><span class="op">[</span><span class="st">"Median"</span><span class="op">]</span> <span class="op">/</span> <span class="va">tcga.ls</span><span class="op">[</span><span class="st">"Median"</span><span class="op">]</span><span class="op">)</span> </pre></div>
<pre><code>##    Median 
## 0.0409238</code></pre>
<p>Downsampling:</p>
<div class="sourceCode" id="cb246"><pre class="downlit">
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">DropletUtils</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">EnrichmentBrowser</span><span class="op">)</span>
<span class="va">tcga.down</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/DropletUtils/man/downsampleMatrix.html">downsampleMatrix</a></span><span class="op">(</span><span class="fu">assay</span><span class="op">(</span><span class="va">tcga</span><span class="op">)</span>, prop<span class="op">=</span><span class="va">ls.prob</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colSums</a></span><span class="op">(</span><span class="va">tcga.down</span><span class="op">)</span><span class="op">)</span></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##  630723  720783  751429  756927  785743 1014545</code></pre>
<p>Consensus subtyping and margin score distribution:</p>
<div class="sourceCode" id="cb248"><pre class="downlit">
<span class="va">tcga.down</span> <span class="op">&lt;-</span> <span class="fu">SummarizedExperiment</span><span class="op">(</span>assays<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">tcga.down</span><span class="op">)</span><span class="op">)</span>
<span class="va">tcga.down</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/EnrichmentBrowser/man/idMap.html">idMap</a></span><span class="op">(</span><span class="va">tcga.down</span>, org<span class="op">=</span><span class="st">"hsa"</span>, from<span class="op">=</span><span class="st">"SYMBOL"</span>, to<span class="op">=</span><span class="st">"ENTREZID"</span><span class="op">)</span></pre></div>
<pre><code>## Encountered 4 from.IDs with &gt;1 corresponding to.ID</code></pre>
<pre><code>## (the first to.ID was chosen for each of them)</code></pre>
<pre><code>## Excluded 237 from.IDs without a corresponding to.ID</code></pre>
<pre><code>## Mapped from.IDs have been added to the rowData column SYMBOL</code></pre>
<div class="sourceCode" id="cb253"><pre class="downlit">
<span class="co">#consensus.subtypes &lt;- get.consensus.subtypes(assay(tcga.down), names(tcga.down))</span>
<span class="va">st.file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">data.dir</span>, <span class="st">"consensus_subtypes_downsampled_tcgabulk_rseq.rds"</span><span class="op">)</span>
<span class="va">consensus.subtypes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="va">st.file</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="fu">subtypeHeterogeneity</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/consensusOV/man/get.consensus.subtypes.html">margin</a></span><span class="op">(</span><span class="va">consensus.subtypes</span><span class="op">$</span><span class="va">rf.probs</span><span class="op">)</span><span class="op">)</span></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##  0.0000  0.2490  0.5200  0.5076  0.7780  0.9960</code></pre>
</div>
</div>
<div id="tissue-of-origin" class="section level1">
<h1 class="hasAnchor">
<a href="#tissue-of-origin" class="anchor"></a>Tissue of origin</h1>
<p>Using the signature from Hao et al., Clin Cancer Res, 2017, to distinguish between tumors originating from fallopian tube (FT) or ovarian surface epithelium (OSE).</p>
<div class="sourceCode" id="cb255"><pre class="downlit">
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">curatedTCGAData</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://www.pmgenomics.ca/bhklab/software/consensusOV">consensusOV</a></span><span class="op">)</span></pre></div>
<p>Get the TCGA OV microarray data:</p>
<div class="sourceCode" id="cb256"><pre class="downlit">
<span class="va">ov.ctd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/curatedTCGAData/man/curatedTCGAData.html">curatedTCGAData</a></span><span class="op">(</span>diseaseCode<span class="op">=</span><span class="st">"OV"</span>, assays<span class="op">=</span><span class="st">"mRNAArray_huex*"</span>, dry.run<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>
<span class="va">se</span> <span class="op">&lt;-</span> <span class="va">ov.ctd</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>
<span class="fu">assays</span><span class="op">(</span><span class="va">se</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="fu">assay</span><span class="op">(</span><span class="va">se</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">res.file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">data.dir</span>, <span class="st">"consensus_subtypes_TCGA_marray_huex.rds"</span><span class="op">)</span>
<span class="va">se</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/EnrichmentBrowser/man/idMap.html">idMap</a></span><span class="op">(</span><span class="va">se</span>, org<span class="op">=</span><span class="st">"hsa"</span>, from<span class="op">=</span><span class="st">"SYMBOL"</span>, to<span class="op">=</span><span class="st">"ENTREZID"</span><span class="op">)</span></pre></div>
<p>Assign consensus subtypes:</p>
<div class="sourceCode" id="cb257"><pre class="downlit">
<span class="va">cst</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/consensusOV/man/get.consensus.subtypes.html">get.consensus.subtypes</a></span><span class="op">(</span><span class="fu">assay</span><span class="op">(</span><span class="va">se</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">se</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span><span class="op">(</span><span class="va">cst</span>, file<span class="op">=</span><span class="va">res.file</span><span class="op">)</span></pre></div>
<div class="sourceCode" id="cb258"><pre class="downlit">
<span class="va">res.file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">data.dir</span>, <span class="st">"consensus_subtypes_TCGA_marray_huex.rds"</span><span class="op">)</span>
<span class="va">cst</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="va">res.file</span><span class="op">)</span>
<span class="va">sts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html">as.vector</a></span><span class="op">(</span><span class="va">cst</span><span class="op">$</span><span class="va">consensusOV.subtypes</span><span class="op">)</span>
<span class="va">sts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">sub</a></span><span class="op">(</span><span class="st">"_consensus$"</span>, <span class="st">""</span>, <span class="va">sts</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">sts</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/substr.html">substring</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">se</span><span class="op">)</span>, <span class="fl">1</span>, <span class="fl">15</span><span class="op">)</span>
<span class="va">margins</span> <span class="op">&lt;-</span> <span class="fu">subtypeHeterogeneity</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/consensusOV/man/get.consensus.subtypes.html">margin</a></span><span class="op">(</span><span class="va">cst</span><span class="op">$</span><span class="va">rf.probs</span><span class="op">)</span></pre></div>
<p>Compute tissue-of-origin scores:</p>
<div class="sourceCode" id="cb259"><pre class="downlit">
<span class="va">tsc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/consensusOV/man/get.hao.subtypes.html">get.hao.subtypes</a></span><span class="op">(</span><span class="fu">assay</span><span class="op">(</span><span class="va">se</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="fu">assay</span><span class="op">(</span><span class="va">se</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></pre></div>
<pre><code>## Warning in get.hao.subtypes(assay(se), rownames(assay(se))): 7 of 35 FT genes
## not present</code></pre>
<pre><code>## Warning in get.hao.subtypes(assay(se), rownames(assay(se))): 5 of 77 OSE genes
## not present</code></pre>
<p>Group by subtype:</p>
<div class="sourceCode" id="cb262"><pre class="downlit">
<span class="va">sub.split</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/split.html">split</a></span><span class="op">(</span><span class="va">tsc</span><span class="op">$</span><span class="va">tissues</span>, <span class="va">sts</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">sub.split</span>, <span class="va">table</span><span class="op">)</span></pre></div>
<pre><code>##     DIF IMR MES PRO
## FT  157 133   9  98
## OSE  10  35 121  12</code></pre>
<p>Dispay score distribution per subtype:</p>
<div class="sourceCode" id="cb264"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>pch<span class="op">=</span><span class="fl">20</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>cex.axis<span class="op">=</span><span class="fl">1.1</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>cex<span class="op">=</span><span class="fl">1.1</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>cex.lab<span class="op">=</span><span class="fl">1.1</span><span class="op">)</span>
<span class="va">vlist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/split.html">split</a></span><span class="op">(</span><span class="va">tsc</span><span class="op">$</span><span class="va">scores</span>, <span class="va">sts</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/boxplot.html">boxplot</a></span><span class="op">(</span><span class="va">vlist</span>, notch<span class="op">=</span><span class="cn">TRUE</span>, var.width<span class="op">=</span><span class="cn">TRUE</span>, ylab<span class="op">=</span><span class="st">"tissue score"</span>, col<span class="op">=</span><span class="va">stcols</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">vlist</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>h<span class="op">=</span><span class="fl">0</span>, col<span class="op">=</span><span class="st">"grey"</span>, lty<span class="op">=</span><span class="fl">2</span><span class="op">)</span></pre></div>
<p><img src="subtypeHeterogeneity_files/figure-html/unnamed-chunk-11-1.png" width="100%"></p>
<p>Prepare data for visualization:</p>
<div class="sourceCode" id="cb265"><pre class="downlit">
<span class="va">sc.file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">data.dir</span>, <span class="st">"scRNAseq_consensusOV_genes.txt"</span><span class="op">)</span>
<span class="va">sc.expr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.delim</a></span><span class="op">(</span><span class="va">sc.file</span>, row.names<span class="op">=</span><span class="fl">1L</span><span class="op">)</span><span class="op">)</span>
<span class="va">ind</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sets.html">intersect</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">sc.expr</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">se</span><span class="op">)</span><span class="op">)</span>
<span class="va">se.restr</span> <span class="op">&lt;-</span> <span class="va">se</span><span class="op">[</span><span class="va">ind</span>, <span class="op">]</span></pre></div>
<p>Heatmap:</p>
<div class="sourceCode" id="cb266"><pre class="downlit">
<span class="va">margin.ramp</span> <span class="op">&lt;-</span> <span class="fu">circlize</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/circlize/man/colorRamp2.html">colorRamp2</a></span><span class="op">(</span>
                    <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">margins</span>, <span class="fl">0.01</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">margins</span>, 
                    <span class="fl">0.99</span><span class="op">)</span>, length <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"blue"</span>, <span class="st">"#EEEEEE"</span>, <span class="st">"red"</span><span class="op">)</span><span class="op">)</span>

<span class="va">tscore.ramp</span> <span class="op">&lt;-</span> <span class="fu">circlize</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/circlize/man/colorRamp2.html">colorRamp2</a></span><span class="op">(</span>
                    <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">tsc</span><span class="op">$</span><span class="va">scores</span>, <span class="fl">0.01</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">tsc</span><span class="op">$</span><span class="va">scores</span>, 
                    <span class="fl">0.99</span><span class="op">)</span>, length <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"blue"</span>, <span class="st">"#EEEEEE"</span>, <span class="st">"red"</span><span class="op">)</span><span class="op">)</span>

<span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>Subtype <span class="op">=</span> <span class="va">sts</span>, Margin <span class="op">=</span> <span class="va">margins</span>, 
                    Origin <span class="op">=</span> <span class="va">tsc</span><span class="op">$</span><span class="va">tissues</span>, Score <span class="op">=</span> <span class="va">tsc</span><span class="op">$</span><span class="va">scores</span><span class="op">)</span>

<span class="va">scol</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>Subtype <span class="op">=</span> <span class="va">stcols</span>, Margin <span class="op">=</span> <span class="va">margin.ramp</span>, 
                Origin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>OSE <span class="op">=</span> <span class="va">cb.red</span>, FT <span class="op">=</span> <span class="va">cb.blue</span><span class="op">)</span>, Score <span class="op">=</span> <span class="va">tscore.ramp</span><span class="op">)</span>

<span class="va">ha</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/HeatmapAnnotation.html">HeatmapAnnotation</a></span><span class="op">(</span>df <span class="op">=</span> <span class="va">df</span>, col <span class="op">=</span> <span class="va">scol</span>, gap <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2</span>, <span class="fl">0</span><span class="op">)</span>, <span class="st">"mm"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/Heatmap.html">Heatmap</a></span><span class="op">(</span><span class="fu">assay</span><span class="op">(</span><span class="va">se.restr</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowMeans</a></span><span class="op">(</span><span class="fu">assay</span><span class="op">(</span><span class="va">se.restr</span><span class="op">)</span><span class="op">)</span> , 
            top_annotation <span class="op">=</span> <span class="va">ha</span>, name<span class="op">=</span><span class="st">"Expr"</span>, 
            show_row_names<span class="op">=</span><span class="cn">FALSE</span>, show_column_names<span class="op">=</span><span class="cn">FALSE</span>,
            column_title<span class="op">=</span><span class="st">"Tumors"</span>, row_title<span class="op">=</span><span class="st">"Genes"</span><span class="op">)</span></pre></div>
<p><img src="subtypeHeterogeneity_files/figure-html/unnamed-chunk-13-1.png" width="100%"></p>
</div>
<div id="tumor-stage" class="section level1">
<h1 class="hasAnchor">
<a href="#tumor-stage" class="anchor"></a>Tumor stage</h1>
<div id="tcga" class="section level2">
<h2 class="hasAnchor">
<a href="#tcga" class="anchor"></a>TCGA</h2>
<div class="sourceCode" id="cb267"><pre class="downlit">
<span class="va">sts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html">as.vector</a></span><span class="op">(</span><span class="va">cst</span><span class="op">$</span><span class="va">consensusOV.subtypes</span><span class="op">)</span>
<span class="va">sts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">sub</a></span><span class="op">(</span><span class="st">"_consensus$"</span>, <span class="st">""</span>, <span class="va">sts</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">sts</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/substr.html">substring</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">ov.ctd</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>, <span class="fl">1</span>, <span class="fl">12</span><span class="op">)</span>
<span class="va">sts</span> <span class="op">&lt;-</span> <span class="va">sts</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="fu">colData</span><span class="op">(</span><span class="va">ov.ctd</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>
<span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">sts</span>, <span class="fu">colData</span><span class="op">(</span><span class="va">ov.ctd</span><span class="op">)</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"patient.stage_event.clinical_stage"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>
<span class="op">(</span><span class="va">tab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">dat</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, <span class="va">dat</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></pre></div>
<pre><code>##      
##       stage ia stage ib stage ic stage iia stage iib stage iic stage iiia
##   DIF        2        2        6         0         0         6          3
##   IMR        0        1        2         2         4         9          3
##   MES        0        0        0         0         0         0          0
##   PRO        1        0        2         1         0         4          2
##      
##       stage iiib stage iiic stage iv
##   DIF          4        113       27
##   IMR         12        106       22
##   MES          1        101       26
##   PRO          7         82       10</code></pre>
<p>Overall proportions:</p>
<div class="sourceCode" id="cb269"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">dat</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">dat</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></pre></div>
<pre><code>## 
##       DIF       IMR       MES       PRO 
## 0.2902655 0.2867257 0.2283186 0.1946903</code></pre>
<div class="sourceCode" id="cb271"><pre class="downlit">
<span class="va">tab</span><span class="op">[</span>,<span class="st">"stage iiic"</span><span class="op">]</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">tab</span><span class="op">[</span>,<span class="st">"stage iiic"</span><span class="op">]</span><span class="op">)</span></pre></div>
<pre><code>##       DIF       IMR       MES       PRO 
## 0.2810945 0.2636816 0.2512438 0.2039801</code></pre>
<p>Stage I tumors:</p>
<div class="sourceCode" id="cb273"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span><span class="op">(</span><span class="va">tab</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></pre></div>
<pre><code>## [1] 16</code></pre>
<div class="sourceCode" id="cb275"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span><span class="op">(</span><span class="va">tab</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span><span class="op">(</span><span class="va">tab</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></pre></div>
<pre><code>##    DIF    IMR    MES    PRO 
## 0.6250 0.1875 0.0000 0.1875</code></pre>
<div class="sourceCode" id="cb277"><pre class="downlit">
<span class="va">rfprobs</span> <span class="op">&lt;-</span> <span class="va">cst</span><span class="op">$</span><span class="va">rf.probs</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">rfprobs</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/substr.html">substring</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">ov.ctd</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>, <span class="fl">1</span>, <span class="fl">12</span><span class="op">)</span>
<span class="va">rfprobs</span> <span class="op">&lt;-</span> <span class="va">rfprobs</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="fu">colData</span><span class="op">(</span><span class="va">ov.ctd</span><span class="op">)</span><span class="op">)</span>,<span class="op">]</span>
<span class="va">rfprobs</span><span class="op">[</span><span class="va">dat</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"stage ia"</span>, <span class="st">"stage ib"</span>, <span class="st">"stage ic"</span><span class="op">)</span>,<span class="op">]</span></pre></div>
<pre><code>##              IMR_consensus DIF_consensus PRO_consensus MES_consensus
## TCGA-04-1335         0.032         0.878         0.040         0.050
## TCGA-04-1360         0.220         0.196         0.364         0.220
## TCGA-04-1516         0.424         0.550         0.002         0.024
## TCGA-09-1675         0.054         0.784         0.094         0.068
## TCGA-09-2043         0.276         0.680         0.026         0.018
## TCGA-09-2055         0.166         0.640         0.142         0.052
## TCGA-57-1992         0.108         0.176         0.522         0.194
## TCGA-59-2349         0.246         0.616         0.072         0.066
## TCGA-61-1722         0.962         0.012         0.012         0.014
## TCGA-61-1727         0.990         0.008         0.000         0.002
## TCGA-61-1730         0.138         0.264         0.552         0.046
## TCGA-61-1734         0.280         0.680         0.018         0.022
## TCGA-61-1903         0.414         0.560         0.014         0.012
## TCGA-61-2018         0.352         0.572         0.022         0.054
## TCGA-61-2087         0.474         0.468         0.022         0.036
## TCGA-61-2096         0.234         0.536         0.144         0.086</code></pre>
<p>Odds ratio of being stage I and DIF:</p>
<div class="sourceCode" id="cb279"><pre class="downlit">
<span class="va">de</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">tab</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span>
<span class="va">dn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">tab</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">4</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span>
<span class="va">he</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">tab</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">7</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span><span class="op">)</span>
<span class="va">hn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">tab</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">4</span>,<span class="fl">7</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/stats/fisher.test.html">fisher.test</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">de</span>, <span class="va">he</span>, <span class="va">dn</span>, <span class="va">hn</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">2</span> <span class="op">)</span><span class="op">)</span></pre></div>
<pre><code>## 
##  Fisher's Exact Test for Count Data
## 
## data:  matrix(c(de, he, dn, hn), nrow = 2)
## p-value = 0.00883
## alternative hypothesis: true odds ratio is not equal to 1
## 95 percent confidence interval:
##   1.355997 14.342871
## sample estimates:
## odds ratio 
##   4.204473</code></pre>
<p>Odds ratio of being stage I-II and DIF/IMR:</p>
<div class="sourceCode" id="cb281"><pre class="downlit">
<span class="va">de</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">tab</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span><span class="op">)</span>
<span class="va">dn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">tab</span><span class="op">[</span><span class="fl">3</span><span class="op">:</span><span class="fl">4</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span><span class="op">)</span>
<span class="va">he</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">tab</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>,<span class="fl">7</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span><span class="op">)</span>
<span class="va">hn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">tab</span><span class="op">[</span><span class="fl">3</span><span class="op">:</span><span class="fl">4</span>,<span class="fl">7</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/stats/fisher.test.html">fisher.test</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">de</span>, <span class="va">he</span>, <span class="va">dn</span>, <span class="va">hn</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">2</span> <span class="op">)</span><span class="op">)</span></pre></div>
<pre><code>## 
##  Fisher's Exact Test for Count Data
## 
## data:  matrix(c(de, he, dn, hn), nrow = 2)
## p-value = 0.001725
## alternative hypothesis: true odds ratio is not equal to 1
## 95 percent confidence interval:
##  1.485114 8.542715
## sample estimates:
## odds ratio 
##   3.349577</code></pre>
</div>
<div id="early-stage-ovarian-carcinoma-study-gse101108" class="section level2">
<h2 class="hasAnchor">
<a href="#early-stage-ovarian-carcinoma-study-gse101108" class="anchor"></a>Early-stage ovarian carcinoma study (GSE101108)</h2>
<p>Obtain the supplementary file from GEO</p>
<div class="sourceCode" id="cb283"><pre class="downlit">
<span class="va">raw.dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.delim</a></span><span class="op">(</span><span class="st">"GSE101108_OV106-391_counts.txt"</span>, row.names <span class="op">=</span> <span class="fl">1L</span><span class="op">)</span>
<span class="va">raw.dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">raw.dat</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/mode.html">mode</a></span><span class="op">(</span><span class="va">raw.dat</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"numeric"</span>
<span class="va">raw.dat</span> <span class="op">&lt;-</span> <span class="fu">edgeR</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/edgeR/man/cpm.html">cpm</a></span><span class="op">(</span><span class="va">raw.dat</span>, log<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
<span class="va">raw.se</span> <span class="op">&lt;-</span> <span class="fu">SummarizedExperiment</span><span class="op">(</span>assays <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>raw <span class="op">=</span> <span class="va">raw.dat</span><span class="op">)</span><span class="op">)</span>
<span class="va">raw.se</span> <span class="op">&lt;-</span> <span class="fu">EnrichmentBrowser</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/EnrichmentBrowser/man/idMap.html">idMap</a></span><span class="op">(</span><span class="va">raw.se</span>, org<span class="op">=</span><span class="st">"hsa"</span>, from<span class="op">=</span><span class="st">"ENSEMBL"</span>, to<span class="op">=</span><span class="st">"ENTREZID"</span><span class="op">)</span>
<span class="va">cst</span> <span class="op">&lt;-</span> <span class="fu">consensusOV</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/consensusOV/man/get.consensus.subtypes.html">get.consensus.subtypes</a></span><span class="op">(</span><span class="fu">assay</span><span class="op">(</span><span class="va">raw.se</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">raw.se</span><span class="op">)</span><span class="op">)</span></pre></div>
<p>Obtain pre-computed consensus subtype annotation and histotype annotation</p>
<div class="sourceCode" id="cb284"><pre class="downlit">
<span class="va">res.file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">data.dir</span>, <span class="st">"GSE101108_consensus_subtypes.rds"</span><span class="op">)</span>
<span class="va">cst</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="va">res.file</span><span class="op">)</span>
<span class="va">map.file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">data.dir</span>, <span class="st">"GSE101108_metadata_histotype.txt"</span><span class="op">)</span>
<span class="va">map</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.delim</a></span><span class="op">(</span><span class="va">map.file</span>, as.is <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">map</span><span class="op">)</span></pre></div>
<pre><code>##   Sample.name       title                         source.name organism
## 1       OV106 Tumor_OV106 Primary invasive ovarian carcinomas    Human
## 2       OV131 Tumor_OV131 Primary invasive ovarian carcinomas    Human
## 3       OV135 Tumor_OV135 Primary invasive ovarian carcinomas    Human
## 4       OV151 Tumor_OV151 Primary invasive ovarian carcinomas    Human
## 5       OV152 Tumor_OV152 Primary invasive ovarian carcinomas    Human
## 6       OV155 Tumor_OV155 Primary invasive ovarian carcinomas    Human
##   characteristics..FIGO.stage characteristics..age characteristics..histotype
## 1                          II                   39                         MC
## 2                          I                    58                         EC
## 3                          I                    64                        CCC
## 4                          I                    67                         EC
## 5                          II                   61                         EC
## 6                          II                   64                         EC
##    molecule                              description  processed.data.file
## 1 Total RNA Paired-end strand-specific RNA libraries OV106-391_counts.txt
## 2 Total RNA Paired-end strand-specific RNA libraries OV106-391_counts.txt
## 3 Total RNA Paired-end strand-specific RNA libraries OV106-391_counts.txt
## 4 Total RNA Paired-end strand-specific RNA libraries OV106-391_counts.txt
## 5 Total RNA Paired-end strand-specific RNA libraries OV106-391_counts.txt
## 6 Total RNA Paired-end strand-specific RNA libraries OV106-391_counts.txt
##                                      raw.file
## 1 2_150617_AC6VVCANXX_P1767_106_1_val_1.fq.gz
## 2 2_150617_AC6VVCANXX_P1767_131_1_val_1.fq.gz
## 3 1_150617_AC6VVCANXX_P1767_135_1_val_1.fq.gz
## 4 1_150617_AC6VVCANXX_P1767_151_1_val_1.fq.gz
## 5 1_150617_AC6VVCANXX_P1767_152_1_val_1.fq.gz
## 6 1_150617_AC6VVCANXX_P1767_155_1_val_1.fq.gz
##                                    raw.file.1
## 1 2_150617_AC6VVCANXX_P1767_106_2_val_2.fq.gz
## 2 2_150617_AC6VVCANXX_P1767_131_2_val_2.fq.gz
## 3 1_150617_AC6VVCANXX_P1767_135_2_val_2.fq.gz
## 4 1_150617_AC6VVCANXX_P1767_151_2_val_2.fq.gz
## 5 1_150617_AC6VVCANXX_P1767_152_2_val_2.fq.gz
## 6 1_150617_AC6VVCANXX_P1767_155_2_val_2.fq.gz</code></pre>
<div class="sourceCode" id="cb286"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/all.html">all</a></span><span class="op">(</span><span class="va">map</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">cst</span><span class="op">$</span><span class="va">rf.probs</span><span class="op">)</span><span class="op">)</span></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb288"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">map</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">sub</a></span><span class="op">(</span><span class="st">"^characteristics.."</span>, <span class="st">""</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">map</span><span class="op">)</span><span class="op">)</span>
<span class="va">map</span><span class="op">[</span>,<span class="st">"histotype"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">" "</span>, <span class="st">""</span>, <span class="va">map</span><span class="op">[</span>,<span class="st">"histotype"</span><span class="op">]</span><span class="op">)</span>
<span class="va">map</span><span class="op">[</span>,<span class="st">"FIGO.stage"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">" "</span>, <span class="st">""</span>, <span class="va">map</span><span class="op">[</span>,<span class="st">"FIGO.stage"</span><span class="op">]</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">map</span><span class="op">[</span>,<span class="st">"histotype"</span><span class="op">]</span><span class="op">)</span></pre></div>
<pre><code>## 
##  CCC   EC HGSC LgSC   MC 
##   17   17   50    1   11</code></pre>
<div class="sourceCode" id="cb290"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">map</span><span class="op">[</span>,<span class="st">"FIGO.stage"</span><span class="op">]</span><span class="op">)</span></pre></div>
<pre><code>## 
##  I II 
## 64 32</code></pre>
<div class="sourceCode" id="cb292"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">map</span><span class="op">[</span>,<span class="st">"FIGO.stage"</span><span class="op">]</span>, <span class="va">map</span><span class="op">[</span>,<span class="st">"histotype"</span><span class="op">]</span><span class="op">)</span></pre></div>
<pre><code>##     
##      CCC EC HGSC LgSC MC
##   I   14 12   29    0  9
##   II   3  5   21    1  2</code></pre>
<div class="sourceCode" id="cb294"><pre class="downlit">
<span class="va">hgsc.ind</span> <span class="op">&lt;-</span> <span class="va">map</span><span class="op">[</span>,<span class="st">"histotype"</span><span class="op">]</span> <span class="op">==</span> <span class="st">"HGSC"</span>
<span class="va">stageI.ind</span> <span class="op">&lt;-</span> <span class="va">map</span><span class="op">[</span>,<span class="st">"FIGO.stage"</span><span class="op">]</span> <span class="op">==</span> <span class="st">"I"</span>
<span class="va">stageII.ind</span> <span class="op">&lt;-</span> <span class="va">map</span><span class="op">[</span>,<span class="st">"FIGO.stage"</span><span class="op">]</span> <span class="op">==</span> <span class="st">"II"</span>
<span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">cst</span><span class="op">$</span><span class="va">consensusOV.subtypes</span><span class="op">[</span><span class="va">hgsc.ind</span><span class="op">]</span><span class="op">)</span></pre></div>
<pre><code>## 
## IMR_consensus DIF_consensus PRO_consensus MES_consensus 
##            20            14            11             5</code></pre>
<div class="sourceCode" id="cb296"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">cst</span><span class="op">$</span><span class="va">consensusOV.subtypes</span><span class="op">[</span><span class="va">hgsc.ind</span> <span class="op">&amp;</span> <span class="va">stageI.ind</span><span class="op">]</span><span class="op">)</span></pre></div>
<pre><code>## 
## IMR_consensus DIF_consensus PRO_consensus MES_consensus 
##             8            11             7             3</code></pre>
<div class="sourceCode" id="cb298"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">cst</span><span class="op">$</span><span class="va">consensusOV.subtypes</span><span class="op">[</span><span class="va">hgsc.ind</span> <span class="op">&amp;</span> <span class="va">stageII.ind</span><span class="op">]</span><span class="op">)</span></pre></div>
<pre><code>## 
## IMR_consensus DIF_consensus PRO_consensus MES_consensus 
##            12             3             4             2</code></pre>
<div class="sourceCode" id="cb300"><pre class="downlit">
<span class="va">cst</span><span class="op">$</span><span class="va">rf.probs</span><span class="op">[</span><span class="va">hgsc.ind</span> <span class="op">&amp;</span> <span class="va">stageI.ind</span>,<span class="op">]</span></pre></div>
<pre><code>##       IMR_consensus DIF_consensus PRO_consensus MES_consensus
## OV172         0.966         0.016         0.010         0.008
## OV201         0.036         0.802         0.114         0.048
## OV205         0.546         0.128         0.154         0.172
## OV303         0.414         0.346         0.122         0.118
## OV305         0.030         0.080         0.846         0.044
## OV311         0.252         0.226         0.418         0.104
## OV314         0.128         0.746         0.070         0.056
## OV315         0.346         0.438         0.124         0.092
## OV318         0.380         0.436         0.122         0.062
## OV321         0.012         0.026         0.942         0.020
## OV325         0.672         0.148         0.100         0.080
## OV326         0.080         0.810         0.050         0.060
## OV329         0.052         0.362         0.532         0.054
## OV342         0.668         0.280         0.018         0.034
## OV344         0.490         0.468         0.020         0.022
## OV346         0.064         0.186         0.198         0.552
## OV348         0.866         0.072         0.018         0.044
## OV352         0.026         0.100         0.846         0.028
## OV353         0.118         0.412         0.280         0.190
## OV359         0.062         0.846         0.048         0.044
## OV360         0.158         0.266         0.330         0.246
## OV362         0.106         0.028         0.026         0.840
## OV363         0.262         0.654         0.022         0.062
## OV366         0.826         0.094         0.040         0.040
## OV370         0.148         0.012         0.020         0.820
## OV376         0.080         0.384         0.168         0.368
## OV377         0.066         0.768         0.036         0.130
## OV383         0.346         0.418         0.174         0.062
## OV390         0.002         0.006         0.974         0.018</code></pre>
</div>
<div id="metagxovarian-data-collection" class="section level2">
<h2 class="hasAnchor">
<a href="#metagxovarian-data-collection" class="anchor"></a>MetaGxOvarian data collection</h2>
<div class="sourceCode" id="cb302"><pre class="downlit">
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">MetaGxOvarian</span><span class="op">)</span>
<span class="va">esets</span> <span class="op">&lt;-</span> <span class="fu">MetaGxOvarian</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MetaGxOvarian/man/loadOvarianEsets.html">loadOvarianEsets</a></span><span class="op">(</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></pre></div>
<p>Identifying early-stage HGS ovarian tumors:</p>
<div class="sourceCode" id="cb303"><pre class="downlit">
<span class="va">stageI.hgs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">esets</span>, <span class="kw">function</span><span class="op">(</span><span class="va">eset</span><span class="op">)</span> <span class="va">eset</span><span class="op">$</span><span class="va">histological_type</span> <span class="op">==</span> <span class="st">"ser"</span> <span class="op">&amp;</span> 
                                          <span class="va">eset</span><span class="op">$</span><span class="va">tumorstage</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">&amp;</span> 
                                          <span class="va">eset</span><span class="op">$</span><span class="va">summarygrade</span> <span class="op">==</span> <span class="st">"high"</span><span class="op">)</span>
<span class="va">nr.stageI</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">vapply</a></span><span class="op">(</span><span class="va">stageI.hgs</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">x</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/integer.html">integer</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">nr.stageI</span><span class="op">)</span></pre></div>
<pre><code>## [1] 52</code></pre>
<div class="sourceCode" id="cb305"><pre class="downlit">
<span class="va">early.hgs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">esets</span>, <span class="kw">function</span><span class="op">(</span><span class="va">eset</span><span class="op">)</span> <span class="va">eset</span><span class="op">$</span><span class="va">histological_type</span> <span class="op">==</span> <span class="st">"ser"</span> <span class="op">&amp;</span> 
                                          <span class="va">eset</span><span class="op">$</span><span class="va">summarystage</span> <span class="op">==</span> <span class="st">"early"</span> <span class="op">&amp;</span> 
                                          <span class="va">eset</span><span class="op">$</span><span class="va">summarygrade</span> <span class="op">==</span> <span class="st">"high"</span><span class="op">)</span>
<span class="va">nr.early</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">vapply</a></span><span class="op">(</span><span class="va">early.hgs</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">x</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/integer.html">integer</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">nr.early</span><span class="op">)</span></pre></div>
<pre><code>## [1] 95</code></pre>
<div class="sourceCode" id="cb307"><pre class="downlit">
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span><span class="op">(</span><span class="va">esets</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="fu">fData</span><span class="op">(</span><span class="va">esets</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"PROBEID"</span>, <span class="st">"ENTREZID"</span><span class="op">)</span>
<span class="va">esets</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">esets</span>, <span class="fu">EnrichmentBrowser</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/EnrichmentBrowser/man/probe2gene.html">probe2gene</a></span><span class="op">)</span>
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span><span class="op">(</span><span class="va">esets</span><span class="op">)</span><span class="op">)</span> <span class="fu">assay</span><span class="op">(</span><span class="va">esets</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu">EnrichmentBrowser</span><span class="fu">:::</span><span class="fu">.naTreat</span><span class="op">(</span><span class="fu">assay</span><span class="op">(</span><span class="va">esets</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
<span class="va">cst</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">)</span>
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span><span class="op">(</span><span class="va">esets</span><span class="op">)</span><span class="op">)</span>
<span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/r/base/message.html">message</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">esets</span><span class="op">)</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span> 
    <span class="va">cst</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/consensusOV/man/get.consensus.subtypes.html">get.consensus.subtypes</a></span><span class="op">(</span><span class="fu">assay</span><span class="op">(</span><span class="va">esets</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,
                                       <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">esets</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span><span class="op">(</span><span class="op">)</span></pre></div>
<div class="sourceCode" id="cb308"><pre class="downlit">
<span class="va">res.file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">data.dir</span>, <span class="st">"MetaGxOvarian_consensus_subtypes.rds"</span><span class="op">)</span>
<span class="va">cst</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="va">res.file</span><span class="op">)</span>
<span class="va">tab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">vapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span>,<span class="fl">8</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">esets</span><span class="op">)</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">cst</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">consensusOV.subtypes</span><span class="op">[</span><span class="va">stageI.hgs</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/integer.html">integer</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span><span class="op">)</span>    
<span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colSums</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">tab</span><span class="op">)</span><span class="op">)</span></pre></div>
<pre><code>## IMR_consensus DIF_consensus PRO_consensus MES_consensus 
##            19            24             6             3</code></pre>
</div>
</div>
<div id="session-info" class="section level1">
<h1 class="hasAnchor">
<a href="#session-info" class="anchor"></a>Session info</h1>
<div class="sourceCode" id="cb310"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></pre></div>
<pre><code>## R version 4.0.0 (2020-04-24)
## Platform: x86_64-pc-linux-gnu (64-bit)
## Running under: Ubuntu 18.04.5 LTS
## 
## Matrix products: default
## BLAS/LAPACK: /usr/lib/x86_64-linux-gnu/libopenblasp-r0.2.20.so
## 
## locale:
##  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C              
##  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8    
##  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=C             
##  [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                 
##  [9] LC_ADDRESS=C               LC_TELEPHONE=C            
## [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       
## 
## attached base packages:
##  [1] grid      parallel  stats4    stats     graphics  grDevices utils    
##  [8] datasets  methods   base     
## 
## other attached packages:
##  [1] MetaGxOvarian_1.8.0         ExperimentHub_1.14.2       
##  [3] AnnotationHub_2.20.2        BiocFileCache_1.12.1       
##  [5] dbplyr_1.4.4                impute_1.62.0              
##  [7] lattice_0.20-41             org.Hs.eg.db_3.11.4        
##  [9] AnnotationDbi_1.50.3        SingleR_1.2.4              
## [11] DropletUtils_1.8.0          curatedTCGAData_1.10.1     
## [13] MultiAssayExperiment_1.14.0 ggplot2_3.3.2              
## [15] ComplexHeatmap_2.4.3        EnrichmentBrowser_2.18.2   
## [17] graph_1.66.0                RaggedExperiment_1.12.0    
## [19] consensusOV_1.10.0          subtypeHeterogeneity_1.0.4 
## [21] SingleCellExperiment_1.10.1 SummarizedExperiment_1.18.2
## [23] DelayedArray_0.14.1         matrixStats_0.57.0         
## [25] Biobase_2.48.0              GenomicRanges_1.40.0       
## [27] GenomeInfoDb_1.24.2         IRanges_2.22.2             
## [29] S4Vectors_0.26.1            BiocGenerics_0.34.0        
## [31] knitr_1.30                 
## 
## loaded via a namespace (and not attached):
##   [1] R.utils_2.10.1                tidyselect_1.1.0             
##   [3] RSQLite_2.2.1                 BiocParallel_1.22.0          
##   [5] munsell_0.5.0                 codetools_0.2-16             
##   [7] ragg_0.4.0                    withr_2.3.0                  
##   [9] colorspace_1.4-1              labeling_0.3                 
##  [11] KEGGgraph_1.48.0              GenomeInfoDbData_1.2.3       
##  [13] pheatmap_1.0.12               bit64_4.0.5                  
##  [15] farver_2.0.3                  rhdf5_2.32.4                 
##  [17] rprojroot_1.3-2               vctrs_0.3.4                  
##  [19] generics_0.0.2                xfun_0.18                    
##  [21] randomForest_4.6-14           R6_2.4.1                     
##  [23] clue_0.3-57                   rsvd_1.0.3                   
##  [25] RJSONIO_1.3-1.4               locfit_1.5-9.4               
##  [27] AnnotationFilter_1.12.0       bitops_1.0-6                 
##  [29] assertthat_0.2.1              promises_1.1.1               
##  [31] scales_1.1.1                  gtable_0.3.0                 
##  [33] ensembldb_2.12.1              rlang_0.4.8                  
##  [35] systemfonts_0.3.2             GlobalOptions_0.1.2          
##  [37] splines_4.0.0                 rtracklayer_1.48.0           
##  [39] lazyeval_0.2.2                BiocManager_1.30.10          
##  [41] yaml_2.2.1                    reshape2_1.4.4               
##  [43] GenomicFeatures_1.40.1        backports_1.1.10             
##  [45] httpuv_1.5.4                  tools_4.0.0                  
##  [47] TCGAutils_1.8.1               ellipsis_0.3.1               
##  [49] RColorBrewer_1.1-2            Rcpp_1.0.5                   
##  [51] plyr_1.8.6                    progress_1.2.2               
##  [53] zlibbioc_1.34.0               purrr_0.3.4                  
##  [55] RCurl_1.98-1.2                prettyunits_1.1.1            
##  [57] openssl_1.4.3                 GetoptLong_1.0.3             
##  [59] viridis_0.5.1                 cluster_2.1.0                
##  [61] fs_1.5.0                      magrittr_1.5                 
##  [63] data.table_1.13.0             circlize_0.4.10              
##  [65] ProtGenerics_1.20.0           hms_0.5.3                    
##  [67] mime_0.9                      evaluate_0.14                
##  [69] GSVA_1.36.3                   xtable_1.8-4                 
##  [71] XML_3.99-0.5                  gridExtra_2.3                
##  [73] shape_1.4.5                   compiler_4.0.0               
##  [75] biomaRt_2.44.1                tibble_3.0.3                 
##  [77] crayon_1.3.4                  R.oo_1.24.0                  
##  [79] htmltools_0.5.0               later_1.1.0.1                
##  [81] DBI_1.1.0                     rappdirs_0.3.1               
##  [83] EnsDb.Hsapiens.v75_2.99.0     Matrix_1.2-18                
##  [85] readr_1.4.0                   gdata_2.18.0                 
##  [87] R.methodsS3_1.8.1             pkgconfig_2.0.3              
##  [89] pkgdown_1.6.1                 GenomicAlignments_1.24.0     
##  [91] RCircos_1.2.1                 xml2_1.3.2                   
##  [93] annotate_1.66.0               dqrng_0.2.1                  
##  [95] XVector_0.28.0                rvest_0.3.6                  
##  [97] stringr_1.4.0                 digest_0.6.25                
##  [99] Biostrings_2.56.0             rmarkdown_2.4                
## [101] fastmatch_1.1-0               edgeR_3.30.3                 
## [103] DelayedMatrixStats_1.10.1     GSEABase_1.50.1              
## [105] curl_4.3                      gtools_3.8.2                 
## [107] shiny_1.5.0                   Rsamtools_2.4.0              
## [109] rjson_0.2.20                  lifecycle_0.2.0              
## [111] GenomicDataCommons_1.12.0     jsonlite_1.7.1               
## [113] Rhdf5lib_1.10.1               BiocNeighbors_1.6.0          
## [115] desc_1.2.0                    viridisLite_0.3.0            
## [117] askpass_1.1                   limma_3.44.3                 
## [119] pillar_1.4.6                  fastmap_1.0.1                
## [121] httr_1.4.2                    survival_3.2-7               
## [123] interactiveDisplayBase_1.26.3 glue_1.4.2                   
## [125] png_0.1-7                     shinythemes_1.1.2            
## [127] BiocVersion_3.11.1            bit_4.0.4                    
## [129] stringi_1.5.3                 HDF5Array_1.16.1             
## [131] blob_1.2.1                    textshaping_0.1.2            
## [133] BiocSingular_1.4.0            memoise_1.1.0                
## [135] RTCGAToolbox_2.18.0           dplyr_1.0.2                  
## [137] irlba_2.3.3</code></pre>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Ludwig Geistlinger.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
