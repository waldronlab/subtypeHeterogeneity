<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title> â€¢ subtypeHeterogeneity</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="">
<meta property="og:description" content="subtypeHeterogeneity">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">subtypeHeterogeneity</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.4</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/subtypeHeterogeneity.html">Absolute SCNA analysis</a>
</li>
<li>
  <a href="../articles/singlecell.html">Single cell analysis</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/waldronlab/subtypeHeterogeneity">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="singlecell_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip></h1>
            
      
      
      <div class="hidden name"><code>singlecell.Rmd</code></div>

    </div>

    
    
<div id="single-cell-rna-seq-analysis-10x-tumors" class="section level1">
<h1 class="hasAnchor">
<a href="#single-cell-rna-seq-analysis-10x-tumors" class="anchor"></a>Single cell RNA-seq analysis (10x tumors)</h1>
</div>
<div id="setup" class="section level1">
<h1 class="hasAnchor">
<a href="#setup" class="anchor"></a>Setup</h1>
<p>Dependencies:</p>
<div class="sourceCode" id="cb1"><pre class="downlit">
<span class="co"># OVC</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://waldronlab.github.io/subtypeHeterogeneity">subtypeHeterogeneity</a></span><span class="op">)</span> 
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://www.pmgenomics.ca/bhklab/software/consensusOV">consensusOV</a></span><span class="op">)</span>

<span class="co"># Single cell</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://bioconductor.org/packages/scater/">scater</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">scran</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">DropletUtils</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/LTLA/SingleR">SingleR</a></span><span class="op">)</span>

<span class="co"># Annotation</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">EnsDb.Hsapiens.v86</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">org.Hs.eg.db</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">EnrichmentBrowser</span><span class="op">)</span>

<span class="co"># Plotting</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jokergoo/ComplexHeatmap">ComplexHeatmap</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rpkgs.datanovia.com/ggpubr/">ggpubr</a></span><span class="op">)</span></pre></div>
<p>Constants:</p>
<div class="sourceCode" id="cb2"><pre class="downlit">
<span class="va">SUBTYPES</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"DIF"</span>, <span class="st">"IMR"</span>, <span class="st">"MES"</span>, <span class="st">"PRO"</span><span class="op">)</span>
<span class="va">CELL.TYPES</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"EPI"</span>, <span class="st">"LYMPH"</span>, <span class="st">"MYE"</span>, <span class="st">"STROM"</span>, <span class="st">"ENDO"</span><span class="op">)</span>
<span class="va">data.dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, package <span class="op">=</span> <span class="st">"subtypeHeterogeneity"</span><span class="op">)</span></pre></div>
<p>Colors</p>
<div class="sourceCode" id="cb3"><pre class="downlit">
<span class="va">cb.pink</span> <span class="op">&lt;-</span> <span class="st">"#CC79A7"</span>
<span class="va">cb.red</span> <span class="op">&lt;-</span> <span class="st">"#D55E00"</span>
<span class="va">cb.blue</span> <span class="op">&lt;-</span> <span class="st">"#0072B2"</span>
<span class="va">cb.yellow</span> <span class="op">&lt;-</span> <span class="st">"#F0E442"</span>
<span class="va">cb.green</span> <span class="op">&lt;-</span> <span class="st">"#009E73"</span>
<span class="va">cb.lightblue</span> <span class="op">&lt;-</span> <span class="st">"#56B4E9"</span>
<span class="va">cb.orange</span> <span class="op">&lt;-</span> <span class="st">"#E69F00"</span>

<span class="va">stcols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">cb.lightblue</span>, <span class="va">cb.green</span>, <span class="va">cb.orange</span>, <span class="va">cb.pink</span><span class="op">)</span> 
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">stcols</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">SUBTYPES</span></pre></div>
<p>Parallel computation:</p>
<div class="sourceCode" id="cb4"><pre class="downlit">
<span class="va">bp</span> <span class="op">&lt;-</span> <span class="fu">BiocParallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/BiocParallel/man/register.html">registered</a></span><span class="op">(</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></pre></div>
<p><strong>Note</strong>: The sections <em>Preprocessing</em>, <em>Dimensionsality reduction</em>, and <em>Clustering</em> describe the processing of the CellRanger output files at the example of Tumor T90. Tumors T59, T76, T77, and T89 were processed analogously. Execution of the code in these sections requires download of the CellRanger output files deposited in GEO (accession number: <a href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE154600">GSE154600</a>).</p>
<p>Section <em>Annotation</em>, Subsection <em>Visualization of results (all tumors)</em>, and subsequent sections describe how Figures 4 and 5 of the main manuscript were created. The code is based on the fully processed and annotated <code>SingleCellExperiment</code>s (resulting from processing steps described in Section 2 - Section 5.3).</p>
</div>
<div id="preprocessing" class="section level1">
<h1 class="hasAnchor">
<a href="#preprocessing" class="anchor"></a>Preprocessing</h1>
<p>Read 10X output (required files: <code>matrix.mtx</code>, <code>barcodes.tsv</code>, <code>genes.tsv</code>)</p>
<div class="sourceCode" id="cb5"><pre class="downlit">
<span class="va">sce</span> <span class="op">&lt;-</span> <span class="fu">DropletUtils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DropletUtils/man/read10xCounts.html">read10xCounts</a></span><span class="op">(</span><span class="st">"tumor90"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">sce</span><span class="op">)</span></pre></div>
<p>Annotating the rows:</p>
<div class="sourceCode" id="cb6"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">sce</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu">scater</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/scater/man/uniquifyFeatureNames.html">uniquifyFeatureNames</a></span><span class="op">(</span><span class="fu">rowData</span><span class="op">(</span><span class="va">sce</span><span class="op">)</span><span class="op">$</span><span class="va">ID</span>,
                                              <span class="fu">rowData</span><span class="op">(</span><span class="va">sce</span><span class="op">)</span><span class="op">$</span><span class="va">Symbol</span><span class="op">)</span>
<span class="va">location</span> <span class="op">&lt;-</span> <span class="fu">AnnotationDbi</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/AnnotationDbi/man/AnnotationDb-class.html">mapIds</a></span><span class="op">(</span><span class="va">EnsDb.Hsapiens.v86</span>, keys <span class="op">=</span> <span class="fu">rowData</span><span class="op">(</span><span class="va">sce</span><span class="op">)</span><span class="op">$</span><span class="va">ID</span>, 
                                  column <span class="op">=</span> <span class="st">"SEQNAME"</span>, keytype <span class="op">=</span> <span class="st">"GENEID"</span><span class="op">)</span></pre></div>
<p>Testing for deviations from ambient expression:</p>
<div class="sourceCode" id="cb7"><pre class="downlit">
<span class="va">bcrank</span> <span class="op">&lt;-</span> <span class="fu">DropletUtils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DropletUtils/man/barcodeRanks.html">barcodeRanks</a></span><span class="op">(</span><span class="fu">counts</span><span class="op">(</span><span class="va">sce</span><span class="op">)</span><span class="op">)</span>
<span class="va">uniq</span> <span class="op">&lt;-</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/duplicated.html">duplicated</a></span><span class="op">(</span><span class="va">bcrank</span><span class="op">$</span><span class="va">rank</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">bcrank</span><span class="op">$</span><span class="va">rank</span><span class="op">[</span><span class="va">uniq</span><span class="op">]</span>, <span class="va">bcrank</span><span class="op">$</span><span class="va">total</span><span class="op">[</span><span class="va">uniq</span><span class="op">]</span>, log<span class="op">=</span><span class="st">"xy"</span>,
    xlab<span class="op">=</span><span class="st">"Rank"</span>, ylab<span class="op">=</span><span class="st">"Total UMI count"</span>, cex.lab<span class="op">=</span><span class="fl">1.2</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>h<span class="op">=</span><span class="va">bcrank</span><span class="op">$</span><span class="va">inflection</span>, col<span class="op">=</span><span class="st">"darkgreen"</span>, lty<span class="op">=</span><span class="fl">2</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>h<span class="op">=</span><span class="va">bcrank</span><span class="op">$</span><span class="va">knee</span>, col<span class="op">=</span><span class="st">"dodgerblue"</span>, lty<span class="op">=</span><span class="fl">2</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op">(</span><span class="st">"bottomleft"</span>, legend<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Inflection"</span>, <span class="st">"Knee"</span><span class="op">)</span>,
    col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"darkgreen"</span>, <span class="st">"dodgerblue"</span><span class="op">)</span>, lty<span class="op">=</span><span class="fl">2</span>, cex<span class="op">=</span><span class="fl">1.2</span><span class="op">)</span></pre></div>
<p>Quality control on the cells:</p>
<div class="sourceCode" id="cb8"><pre class="downlit">
<span class="va">df</span> <span class="op">&lt;-</span> <span class="fu">scater</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/scater/man/perCellQCMetrics.html">perCellQCMetrics</a></span><span class="op">(</span><span class="va">sce</span>, 
                       subsets <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>Mito <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">location</span> <span class="op">==</span> <span class="st">"MT"</span><span class="op">)</span><span class="op">)</span>,
                       BPPARAM <span class="op">=</span> <span class="va">bp</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">sum</span><span class="op">/</span><span class="fl">1e3</span>, xlab<span class="op">=</span><span class="st">"Library sizes (thousands)"</span>, main<span class="op">=</span><span class="st">""</span>,
    breaks<span class="op">=</span><span class="fl">20</span>, col<span class="op">=</span><span class="st">"grey80"</span>, ylab<span class="op">=</span><span class="st">"Number of cells"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">detected</span>, xlab<span class="op">=</span><span class="st">"Number of expressed genes"</span>, main<span class="op">=</span><span class="st">""</span>,
    breaks<span class="op">=</span><span class="fl">20</span>, col<span class="op">=</span><span class="st">"grey80"</span>, ylab<span class="op">=</span><span class="st">"Number of cells"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">subsets_Mito_percent</span>, xlab<span class="op">=</span><span class="st">"Mitochondrial proportion (%)"</span>,
    ylab<span class="op">=</span><span class="st">"Number of cells"</span>, breaks<span class="op">=</span><span class="fl">20</span>, main<span class="op">=</span><span class="st">""</span>, col<span class="op">=</span><span class="st">"grey80"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span>

<span class="va">high.mito</span> <span class="op">&lt;-</span> <span class="fu">scater</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/scater/man/isOutlier.html">isOutlier</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">subsets_Mito_percent</span>, nmads <span class="op">=</span> <span class="fl">3</span>, type <span class="op">=</span> <span class="st">"higher"</span><span class="op">)</span>
<span class="va">libsize.drop</span> <span class="op">&lt;-</span> <span class="fu">scater</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/scater/man/isOutlier.html">isOutlier</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">sum</span>, nmads <span class="op">=</span> <span class="fl">1</span>, type <span class="op">=</span> <span class="st">"lower"</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">feature.drop</span> <span class="op">&lt;-</span> <span class="fu">scater</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/scater/man/isOutlier.html">isOutlier</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">detected</span>, nmads <span class="op">=</span> <span class="fl">1</span>, type <span class="op">=</span> <span class="st">"lower"</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">sce</span> <span class="op">&lt;-</span> <span class="va">sce</span><span class="op">[</span>,<span class="op">!</span><span class="op">(</span><span class="va">high.mito</span> <span class="op">|</span> <span class="va">libsize.drop</span> <span class="op">|</span> <span class="va">feature.drop</span><span class="op">)</span><span class="op">]</span>

<span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>ByHighMito <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">high.mito</span><span class="op">)</span>,
           ByLibSize <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">libsize.drop</span><span class="op">)</span>,
           ByFeature <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">feature.drop</span><span class="op">)</span>,
           Remaining <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">sce</span><span class="op">)</span><span class="op">)</span>

<span class="va">df</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">sce</span><span class="op">)</span></pre></div>
<p>Examining gene expression:</p>
<div class="sourceCode" id="cb9"><pre class="downlit">
<span class="va">ave</span> <span class="op">&lt;-</span> <span class="fu">scater</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/scater/man/calculateAverage.html">calculateAverage</a></span><span class="op">(</span><span class="va">sce</span>, BPPARAM <span class="op">=</span> <span class="va">bp</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log10</a></span><span class="op">(</span><span class="va">ave</span><span class="op">)</span>, breaks <span class="op">=</span> <span class="fl">100</span>, main <span class="op">=</span> <span class="st">""</span>, col <span class="op">=</span> <span class="st">"grey"</span>,
    xlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="va">Log</span><span class="op">[</span><span class="fl">10</span><span class="op">]</span><span class="op">~</span><span class="st">"average count"</span><span class="op">)</span><span class="op">)</span></pre></div>
<p>Remove genes that have too low average counts</p>
<div class="sourceCode" id="cb10"><pre class="downlit">
<span class="fu">rowData</span><span class="op">(</span><span class="va">sce</span><span class="op">)</span><span class="op">$</span><span class="va">AveCount</span> <span class="op">&lt;-</span> <span class="va">ave</span>
<span class="va">to.keep</span> <span class="op">&lt;-</span> <span class="va">ave</span> <span class="op">&gt;</span> <span class="fl">0.001</span>
<span class="va">sce</span> <span class="op">&lt;-</span> <span class="va">sce</span><span class="op">[</span><span class="va">to.keep</span>,<span class="op">]</span>

<span class="co"># Number excluded genes</span>
<span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="op">!</span><span class="va">to.keep</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">sce</span><span class="op">)</span></pre></div>
<p>Library-size normalization:</p>
<div class="sourceCode" id="cb11"><pre class="downlit">
<span class="va">clusters</span> <span class="op">&lt;-</span> <span class="fu">scran</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/scran/man/quickCluster.html">quickCluster</a></span><span class="op">(</span><span class="va">sce</span>, method <span class="op">=</span> <span class="st">"igraph"</span>, 
                                min.mean <span class="op">=</span> <span class="fl">0.1</span>, BPPARAM <span class="op">=</span> <span class="va">bp</span><span class="op">)</span>
<span class="va">sce</span> <span class="op">&lt;-</span> <span class="fu">scran</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/scran/man/computeSumFactors.html">computeSumFactors</a></span><span class="op">(</span><span class="va">sce</span>, min.mean <span class="op">=</span> <span class="fl">0.1</span>,
                                cluster <span class="op">=</span> <span class="va">clusters</span>, BPPARAM <span class="op">=</span> <span class="va">bp</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu">scater</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/scater/man/librarySizeFactors.html">librarySizeFactors</a></span><span class="op">(</span><span class="va">sce</span><span class="op">)</span>, <span class="fu">sizeFactors</span><span class="op">(</span><span class="va">sce</span><span class="op">)</span>, pch <span class="op">=</span> <span class="fl">16</span>,
    xlab <span class="op">=</span> <span class="st">"Library size factors"</span>, ylab <span class="op">=</span> <span class="st">"Deconvolution factors"</span>, log <span class="op">=</span> <span class="st">"xy"</span><span class="op">)</span>
<span class="va">sce</span> <span class="op">&lt;-</span> <span class="fu">scater</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/scater/man/logNormCounts.html">logNormCounts</a></span><span class="op">(</span><span class="va">sce</span><span class="op">)</span>
<span class="va">sce</span></pre></div>
</div>
<div id="dimensionality-reduction" class="section level1">
<h1 class="hasAnchor">
<a href="#dimensionality-reduction" class="anchor"></a>Dimensionality reduction</h1>
<p>Modelling the mean-variance trend:</p>
<div class="sourceCode" id="cb12"><pre class="downlit">
<span class="va">dec.pbmc</span> <span class="op">&lt;-</span> <span class="fu">scran</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/scran/man/modelGeneVarByPoisson.html">modelGeneVarByPoisson</a></span><span class="op">(</span><span class="va">sce</span>, BPPARAM <span class="op">=</span> <span class="va">bp</span><span class="op">)</span>
<span class="va">top.pbmc</span> <span class="op">&lt;-</span> <span class="fu">scran</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/scran/man/getTopHVGs.html">getTopHVGs</a></span><span class="op">(</span><span class="va">dec.pbmc</span>, prop <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">dec.pbmc</span><span class="op">$</span><span class="va">mean</span>, <span class="va">dec.pbmc</span><span class="op">$</span><span class="va">total</span>, pch<span class="op">=</span><span class="fl">16</span>, cex<span class="op">=</span><span class="fl">0.5</span>,
    xlab<span class="op">=</span><span class="st">"Mean of log-expression"</span>, ylab<span class="op">=</span><span class="st">"Variance of log-expression"</span><span class="op">)</span>
<span class="va">curfit</span> <span class="op">&lt;-</span> <span class="fu">metadata</span><span class="op">(</span><span class="va">dec.pbmc</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/curve.html">curve</a></span><span class="op">(</span><span class="va">curfit</span><span class="op">$</span><span class="fu">trend</span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">'dodgerblue'</span>, add <span class="op">=</span> <span class="cn">TRUE</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></pre></div>
<p>Denoise log-expression data by removing principal components corresponding to technical noise (might take a while):</p>
<div class="sourceCode" id="cb13"><pre class="downlit">
<span class="va">sce</span> <span class="op">&lt;-</span> <span class="fu">scran</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/scran/man/denoisePCA.html">denoisePCA</a></span><span class="op">(</span><span class="va">sce</span>, subset.row <span class="op">=</span> <span class="va">top.pbmc</span>,
                         technical <span class="op">=</span> <span class="va">dec.pbmc</span>, BPPARAM <span class="op">=</span> <span class="va">bp</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="fu">reducedDim</span><span class="op">(</span><span class="va">sce</span>, <span class="st">"PCA"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/attr.html">attr</a></span><span class="op">(</span><span class="fu">reducedDim</span><span class="op">(</span><span class="va">sce</span><span class="op">)</span>, <span class="st">"percentVar"</span><span class="op">)</span>, xlab <span class="op">=</span> <span class="st">"PC"</span>,
     ylab <span class="op">=</span> <span class="st">"Proportion of variance explained"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>v <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="fu">reducedDim</span><span class="op">(</span><span class="va">sce</span>, <span class="st">"PCA"</span><span class="op">)</span><span class="op">)</span>, lty <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></pre></div>
<p>tSNE:</p>
<div class="sourceCode" id="cb14"><pre class="downlit">
<span class="va">sce</span> <span class="op">&lt;-</span> <span class="fu">scater</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/scater/man/runTSNE.html">runTSNE</a></span><span class="op">(</span><span class="va">sce</span>, dimred <span class="op">=</span> <span class="st">"PCA"</span>, perplexity <span class="op">=</span> <span class="fl">30</span>, BPPARAM <span class="op">=</span> <span class="va">bp</span><span class="op">)</span>
<span class="va">sce</span><span class="op">$</span><span class="va">sizeFactor</span> <span class="op">&lt;-</span> <span class="fu">sizeFactors</span><span class="op">(</span><span class="va">sce</span><span class="op">)</span>
<span class="fu">scater</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/scater/man/plot_reddim.html">plotTSNE</a></span><span class="op">(</span><span class="va">sce</span>, colour_by <span class="op">=</span> <span class="st">"sizeFactor"</span><span class="op">)</span></pre></div>
</div>
<div id="clustering" class="section level1">
<h1 class="hasAnchor">
<a href="#clustering" class="anchor"></a>Clustering</h1>
<p>Clustering with graph-based methods:</p>
<div class="sourceCode" id="cb15"><pre class="downlit">
<span class="va">snn.gr</span> <span class="op">&lt;-</span> <span class="fu">scran</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/scran/man/buildSNNGraph.html">buildSNNGraph</a></span><span class="op">(</span><span class="va">sce</span>, use.dimred <span class="op">=</span> <span class="st">"PCA"</span>, BPPARAM <span class="op">=</span> <span class="va">bp</span>, k <span class="op">=</span> <span class="fl">25</span><span class="op">)</span>
<span class="va">clusters</span> <span class="op">&lt;-</span> <span class="fu">igraph</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/igraph/man/cluster_walktrap.html">cluster_walktrap</a></span><span class="op">(</span><span class="va">snn.gr</span><span class="op">)</span>
<span class="va">sce</span><span class="op">$</span><span class="va">Cluster</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">clusters</span><span class="op">$</span><span class="va">membership</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">sce</span><span class="op">$</span><span class="va">Cluster</span><span class="op">)</span></pre></div>
<div class="sourceCode" id="cb16"><pre class="downlit">
<span class="va">cluster.mod</span> <span class="op">&lt;-</span> <span class="fu">scran</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/scran/man/clusterModularity.html">clusterModularity</a></span><span class="op">(</span><span class="va">snn.gr</span>, <span class="va">sce</span><span class="op">$</span><span class="va">Cluster</span>,
                                        get.weights <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">log.ratio</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log2</a></span><span class="op">(</span><span class="va">cluster.mod</span><span class="op">$</span><span class="va">observed</span> <span class="op">/</span> <span class="va">cluster.mod</span><span class="op">$</span><span class="va">expected</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span>

<span class="fu">ComplexHeatmap</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/Heatmap.html">Heatmap</a></span><span class="op">(</span><span class="va">log.ratio</span>,
                        cluster_rows <span class="op">=</span> <span class="cn">FALSE</span>, cluster_columns <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="fu">scater</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/scater/man/plot_reddim.html">plotTSNE</a></span><span class="op">(</span><span class="va">sce</span>, colour_by <span class="op">=</span> <span class="st">"Cluster"</span><span class="op">)</span></pre></div>
</div>
<div id="annotation-cell-type-and-consensus-subtype" class="section level1">
<h1 class="hasAnchor">
<a href="#annotation-cell-type-and-consensus-subtype" class="anchor"></a>Annotation (cell type and consensus subtype)</h1>
<div id="singler-cell-type-annotation" class="section level2">
<h2 class="hasAnchor">
<a href="#singler-cell-type-annotation" class="anchor"></a>SingleR cell type annotation</h2>
<p>Transfer cell type annotation from reference profiles in the Human Primary Cell Atlas and ENCODE:</p>
<div class="sourceCode" id="cb17"><pre class="downlit">
<span class="va">hpc</span> <span class="op">&lt;-</span> <span class="fu">transferCellType</span><span class="op">(</span><span class="va">sce</span>, <span class="st">"hpca"</span><span class="op">)</span>
<span class="va">encode</span> <span class="op">&lt;-</span> <span class="fu">transferCellType</span><span class="op">(</span><span class="va">sce</span>, <span class="st">"encode"</span><span class="op">)</span>

<span class="va">sce</span><span class="op">$</span><span class="va">hpca.celltype</span> <span class="op">&lt;-</span> <span class="va">hpc</span><span class="op">$</span><span class="va">labels</span> 
<span class="va">sce</span><span class="op">$</span><span class="va">encode.celltype</span> <span class="op">&lt;-</span> <span class="va">encode</span><span class="op">$</span><span class="va">labels</span>

<span class="va">maxScore</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">res</span><span class="op">)</span>
    <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">vapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="va">res</span><span class="op">$</span><span class="va">scores</span><span class="op">[</span><span class="va">i</span>, <span class="va">res</span><span class="op">[</span><span class="va">i</span>,<span class="st">"labels"</span><span class="op">]</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">numeric</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>

<span class="va">sce</span><span class="op">$</span><span class="va">hpca.celltype.score</span> <span class="op">&lt;-</span> <span class="fu">maxScore</span><span class="op">(</span><span class="va">hpc</span><span class="op">)</span>
<span class="va">sce</span><span class="op">$</span><span class="va">encode.celltype.score</span> <span class="op">&lt;-</span> <span class="fu">maxScore</span><span class="op">(</span><span class="va">hpc</span><span class="op">)</span></pre></div>
<p>Display main cell types present:</p>
<div class="sourceCode" id="cb18"><pre class="downlit">
<span class="fu">plotMainCellTypes</span><span class="op">(</span><span class="va">sce</span>, <span class="st">"hpca.celltype"</span><span class="op">)</span>
<span class="fu">plotMainCellTypes</span><span class="op">(</span><span class="va">sce</span>, <span class="st">"encode.celltype"</span><span class="op">)</span></pre></div>
<p>Display ambiguity of cell type assignments:</p>
<div class="sourceCode" id="cb19"><pre class="downlit">
<span class="fu">SingleR</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/SingleR/man/plotScoreHeatmap.html">plotScoreHeatmap</a></span><span class="op">(</span><span class="va">hpc</span><span class="op">)</span>
<span class="fu">SingleR</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/SingleR/man/plotScoreHeatmap.html">plotScoreHeatmap</a></span><span class="op">(</span><span class="va">encode</span><span class="op">)</span></pre></div>
</div>
<div id="marker-genes" class="section level2">
<h2 class="hasAnchor">
<a href="#marker-genes" class="anchor"></a>Marker genes</h2>
<p>Adopted from Shih et al., PLoS One (2018):</p>
<div class="sourceCode" id="cb20"><pre class="downlit">
<span class="va">epithelial</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"EPCAM"</span>, <span class="st">"KRT8"</span>, <span class="st">"KRT18"</span>, <span class="st">"KRT19"</span><span class="op">)</span>
<span class="va">lymphocyte</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"PTPRC"</span>, <span class="st">"CD3E"</span>, <span class="st">"CD19"</span>, <span class="st">"MS4A1"</span><span class="op">)</span>
<span class="va">endothelial</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"PECAM1"</span>, <span class="st">"CD34"</span><span class="op">)</span>
<span class="va">fibroblast</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ACTA2"</span>, <span class="st">"DCN"</span>, <span class="st">"ACTB"</span><span class="op">)</span>
<span class="va">stromal</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"THY1"</span>, <span class="st">"ENG"</span>, <span class="st">"VIM"</span>, <span class="st">"CD44"</span><span class="op">)</span>

<span class="va">origin</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"PAX8"</span>, <span class="st">"CALB2"</span>, <span class="st">"COL11A1"</span><span class="op">)</span>
<span class="fu">scater</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/scater/man/plot_reddim.html">plotTSNE</a></span><span class="op">(</span><span class="va">sce</span>, colour_by <span class="op">=</span> <span class="va">epithelial</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></pre></div>
</div>
<div id="consensusov-subtype-annotation" class="section level2">
<h2 class="hasAnchor">
<a href="#consensusov-subtype-annotation" class="anchor"></a>consensusOV subtype annotation</h2>
<div class="sourceCode" id="cb21"><pre class="downlit">
<span class="va">sce.entrez</span> <span class="op">&lt;-</span> <span class="fu">EnrichmentBrowser</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/EnrichmentBrowser/man/idMap.html">idMap</a></span><span class="op">(</span><span class="va">sce</span>, org <span class="op">=</span> <span class="st">"hsa"</span>, 
                                       from <span class="op">=</span> <span class="st">"SYMBOL"</span>, to <span class="op">=</span> <span class="st">"ENTREZID"</span><span class="op">)</span>
<span class="va">am</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="fu">assay</span><span class="op">(</span><span class="va">sce.entrez</span>, <span class="st">"logcounts"</span><span class="op">)</span><span class="op">)</span>
<span class="va">cst</span> <span class="op">&lt;-</span> <span class="fu">consensusOV</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/consensusOV/man/get.consensus.subtypes.html">get.consensus.subtypes</a></span><span class="op">(</span><span class="va">am</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">sce.entrez</span><span class="op">)</span><span class="op">)</span>

<span class="va">sts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">sub</a></span><span class="op">(</span><span class="st">"_consensus$"</span>, <span class="st">""</span>, <span class="fu"><a href="https://rdrr.io/r/base/vector.html">as.vector</a></span><span class="op">(</span><span class="va">cst</span><span class="op">$</span><span class="va">consensusOV.subtypes</span><span class="op">)</span><span class="op">)</span>
<span class="va">sce</span><span class="op">$</span><span class="va">subtype</span> <span class="op">&lt;-</span> <span class="va">sts</span>
<span class="va">sce</span><span class="op">$</span><span class="va">margin</span> <span class="op">&lt;-</span> <span class="fu">consensusOV</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/consensusOV/man/get.consensus.subtypes.html">margin</a></span><span class="op">(</span><span class="va">cst</span><span class="op">$</span><span class="va">rf.probs</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">sce</span><span class="op">$</span><span class="va">margin</span><span class="op">)</span>
<span class="fu">scater</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/scater/man/plot_reddim.html">plotTSNE</a></span><span class="op">(</span><span class="va">sce</span>, colour_by <span class="op">=</span> <span class="st">"subtype"</span><span class="op">)</span>
<span class="fu">scater</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/scater/man/plot_reddim.html">plotTSNE</a></span><span class="op">(</span><span class="va">sce</span>, colour_by <span class="op">=</span> <span class="st">"margin"</span><span class="op">)</span></pre></div>
</div>
<div id="visualization-of-results-all-tumors" class="section level2">
<h2 class="hasAnchor">
<a href="#visualization-of-results-all-tumors" class="anchor"></a>Visualization of results (all tumors)</h2>
<p>Read the pre-processed 10X data for all tumors as <code>list</code> of <code>SingleCellExperiment</code>s.</p>
<div class="sourceCode" id="cb22"><pre class="downlit">
<span class="va">tumors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">59</span>, <span class="fl">76</span>, <span class="fl">77</span>, <span class="fl">89</span>, <span class="fl">90</span><span class="op">)</span> 
<span class="va">tags</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"cu0pxp0sepsvhos"</span>, <span class="st">"taff3g6nlmf5yk4"</span>, <span class="st">"2otdxfunxnlr6ql"</span>,
          <span class="st">"sojupsrjxnvnf6d"</span>, <span class="st">"ydokzcxgkugo678"</span><span class="op">)</span>
<span class="va">durl</span> <span class="op">&lt;-</span> <span class="st">"https://dl.dropboxusercontent.com/s/tag/sampleXX_sce.rds"</span></pre></div>
<div class="sourceCode" id="cb23"><pre class="downlit">
<span class="va">readSCE</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span>
<span class="op">{</span> 
    <span class="va">dl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">sub</a></span><span class="op">(</span><span class="st">"XX"</span>, <span class="va">tumors</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="va">durl</span><span class="op">)</span>
    <span class="va">dl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">sub</a></span><span class="op">(</span><span class="st">"tag"</span>, <span class="va">tags</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="va">dl</span><span class="op">)</span>
    <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/connections.html">file</a></span><span class="op">(</span><span class="va">dl</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span></pre></div>
<div class="sourceCode" id="cb24"><pre class="downlit">
<span class="va">sces</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="va">readSCE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">sces</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"T"</span>, <span class="va">tumors</span><span class="op">)</span>
<span class="va">sces</span></pre></div>
<pre><code>## $T59
## class: SingleCellExperiment 
## dim: 18079 13040 
## metadata(1): log.exprs.offset
## assays(2): counts logcounts
## rownames(18079): AL669831.5 LINC00115 ... AC004556.1 AC240274.1
## rowData names(12): ID Symbol ... log10_total_counts AveCount
## colnames: NULL
## colData names(52): Sample Barcode ... PRO_consensus MES_consensus
## reducedDimNames(2): PCA TSNE
## altExpNames(0):
## 
## $T76
## class: SingleCellExperiment 
## dim: 17416 13747 
## metadata(1): log.exprs.offset
## assays(2): counts logcounts
## rownames(17416): AL669831.5 FAM87B ... AC233755.1 AC240274.1
## rowData names(12): ID Symbol ... log10_total_counts AveCount
## colnames: NULL
## colData names(52): Sample Barcode ... PRO_consensus MES_consensus
## reducedDimNames(2): PCA TSNE
## altExpNames(0):
## 
## $T77
## class: SingleCellExperiment 
## dim: 18543 6903 
## metadata(1): log.exprs.offset
## assays(2): counts logcounts
## rownames(18543): MIR1302-2HG AL669831.5 ... AC233755.1 AC240274.1
## rowData names(12): ID Symbol ... log10_total_counts AveCount
## colnames: NULL
## colData names(59): Sample Barcode ... PRO_consensus MES_consensus
## reducedDimNames(2): PCA TSNE
## altExpNames(0):
## 
## $T89
## class: SingleCellExperiment 
## dim: 17429 4933 
## metadata(1): log.exprs.offset
## assays(2): counts logcounts
## rownames(17429): AL669831.5 LINC00115 ... AC233755.1 AC240274.1
## rowData names(12): ID Symbol ... log10_total_counts AveCount
## colnames: NULL
## colData names(52): Sample Barcode ... PRO_consensus MES_consensus
## reducedDimNames(2): PCA TSNE
## altExpNames(0):
## 
## $T90
## class: SingleCellExperiment 
## dim: 18011 3630 
## metadata(1): Samples
## assays(2): counts logcounts
## rownames(18011): AL627309.1 AL669831.5 ... AC233755.1 AC240274.1
## rowData names(4): ID Symbol NA AveCount
## colnames: NULL
## colData names(15): Sample Barcode ... PRO_consensus MES_consensus
## reducedDimNames(2): PCA TSNE
## altExpNames(0):</code></pre>
<p>Summarize cell type annotation:</p>
<div class="sourceCode" id="cb26"><pre class="downlit">
<span class="va">sces</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">sces</span>, <span class="va">annoCellType</span><span class="op">)</span></pre></div>
<div class="sourceCode" id="cb27"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/lapply.html">vapply</a></span><span class="op">(</span><span class="va">sces</span>, <span class="kw">function</span><span class="op">(</span><span class="va">sce</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">sce</span><span class="op">$</span><span class="va">celltype</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/integer.html">integer</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span></pre></div>
<pre><code>##        T59  T76  T77  T89  T90
## ENDO   186  449   84  127   57
## EPI   3505  212 2889  294  893
## LYMPH 3132 4055 2569 2774 2130
## MYE   4476 2127 1038 1317  329
## STROM 1728 6904  284  418  219</code></pre>
<div class="sourceCode" id="cb29"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/lapply.html">vapply</a></span><span class="op">(</span><span class="va">sces</span>, <span class="kw">function</span><span class="op">(</span><span class="va">sce</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">sce</span><span class="op">$</span><span class="va">subtype</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/integer.html">integer</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span><span class="op">)</span></pre></div>
<pre><code>##      T59  T76  T77  T89  T90
## DIF 9180 9674 5608 4200 3150
## IMR 1745 1323  460  341  223
## MES 1444 2586  167  239  157
## PRO  671  164  668  153  100</code></pre>
<p>Display cell type and subtype annotation for one tumor at a time:</p>
<div class="sourceCode" id="cb31"><pre class="downlit">
<span class="va">p2a</span> <span class="op">&lt;-</span> <span class="fu">plotType</span><span class="op">(</span><span class="va">sces</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
<span class="va">p2b</span> <span class="op">&lt;-</span> <span class="fu">plotType</span><span class="op">(</span><span class="va">sces</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, type <span class="op">=</span> <span class="st">"subtype"</span><span class="op">)</span>
<span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggarrange.html">ggarrange</a></span><span class="op">(</span><span class="va">p2b</span> <span class="op">+</span> <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">theme</span><span class="op">(</span>plot.margin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/consensusOV/man/get.consensus.subtypes.html">margin</a></span><span class="op">(</span>r <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>, 
                <span class="va">p2a</span> <span class="op">+</span> <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">theme</span><span class="op">(</span>axis.text.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>, 
                                         axis.ticks.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>, 
                                         axis.title.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,
                                         plot.margin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/consensusOV/man/get.consensus.subtypes.html">margin</a></span><span class="op">(</span>l <span class="op">=</span> <span class="fl">1</span>, r<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>, 
                legend <span class="op">=</span> <span class="st">"top"</span>, align <span class="op">=</span> <span class="st">"h"</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span><span class="op">)</span><span class="op">)</span>
<span class="va">p2</span></pre></div>
<p><img src="singlecell_files/figure-html/unnamed-chunk-26-1.png" width="100%"></p>
<p>Facet cell type and subtype visualization for all tumors:</p>
<div class="sourceCode" id="cb32"><pre class="downlit">
<span class="va">stp</span> <span class="op">&lt;-</span> <span class="fu">facetTumors</span><span class="op">(</span><span class="va">sces</span>, col <span class="op">=</span> <span class="st">"subtype"</span>, pal <span class="op">=</span> <span class="va">stcols</span><span class="op">)</span>
<span class="va">pal</span> <span class="op">&lt;-</span> <span class="fu">ggpubr</span><span class="fu">::</span><span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/get_palette.html">get_palette</a></span><span class="op">(</span><span class="st">"npg"</span>, <span class="fl">5</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">pal</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">CELL.TYPES</span>
<span class="va">ctp</span> <span class="op">&lt;-</span> <span class="fu">facetTumors</span><span class="op">(</span><span class="va">sces</span>, col <span class="op">=</span> <span class="st">"celltype"</span>, pal <span class="op">=</span> <span class="va">pal</span><span class="op">)</span> 
<span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu">ggpubr</span><span class="fu">::</span><span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggarrange.html">ggarrange</a></span><span class="op">(</span><span class="va">stp</span> <span class="op">+</span> <span class="fu">theme</span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,
                                    axis.title.x <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>, 
                        <span class="va">ctp</span>, nrow <span class="op">=</span> <span class="fl">2</span>, align <span class="op">=</span> <span class="st">"v"</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span><span class="op">)</span>,
                        heights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1.2</span><span class="op">)</span><span class="op">)</span></pre></div>
<p>Barplot percentage of subtype / cell type for all 10X tumors:</p>
<div class="sourceCode" id="cb33"><pre class="downlit">
<span class="va">cttab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">vapply</a></span><span class="op">(</span><span class="va">sces</span>, <span class="va">getPerc</span>, <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">numeric</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span>, perc<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>
<span class="va">total</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colSums</a></span><span class="op">(</span><span class="va">cttab</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/stats/prop.test.html">prop.test</a></span><span class="op">(</span><span class="va">cttab</span><span class="op">[</span><span class="st">"EPI"</span>,<span class="op">]</span>, <span class="va">total</span><span class="op">)</span></pre></div>
<pre><code>## 
##  5-sample test for equality of proportions without continuity
##  correction
## 
## data:  cttab["EPI", ] out of total
## X-squared = 6377.8, df = 4, p-value &lt; 2.2e-16
## alternative hypothesis: two.sided
## sample estimates:
##     prop 1     prop 2     prop 3     prop 4     prop 5 
## 0.26905657 0.01542155 0.42089161 0.05963489 0.24614112</code></pre>
<div class="sourceCode" id="cb35"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/stats/prop.test.html">prop.test</a></span><span class="op">(</span><span class="va">cttab</span><span class="op">[</span><span class="st">"STROM"</span>,<span class="op">]</span>, <span class="va">total</span><span class="op">)</span></pre></div>
<pre><code>## 
##  5-sample test for equality of proportions without continuity
##  correction
## 
## data:  cttab["STROM", ] out of total
## X-squared = 9102.3, df = 4, p-value &lt; 2.2e-16
## alternative hypothesis: two.sided
## sample estimates:
##     prop 1     prop 2     prop 3     prop 4     prop 5 
## 0.13264758 0.50221867 0.04137529 0.08478702 0.06036384</code></pre>
<div class="sourceCode" id="cb37"><pre class="downlit">
<span class="va">stbp</span> <span class="op">&lt;-</span> <span class="fu">bpType</span><span class="op">(</span><span class="va">sces</span>, <span class="st">"subtype"</span>, pal <span class="op">=</span> <span class="va">stcols</span><span class="op">)</span>
<span class="va">ctbp</span> <span class="op">&lt;-</span> <span class="fu">bpType</span><span class="op">(</span><span class="va">sces</span>, <span class="st">"celltype"</span>, pal <span class="op">=</span> <span class="va">pal</span><span class="op">)</span></pre></div>
<p>Cell type vs subtype matrix:</p>
<div class="sourceCode" id="cb38"><pre class="downlit">
<span class="va">mat</span> <span class="op">&lt;-</span> <span class="fu">getCelltypeSubtypeMatrix</span><span class="op">(</span><span class="va">sces</span><span class="op">)</span>
<span class="va">ctstbp</span> <span class="op">&lt;-</span> <span class="fu">bpCrossType</span><span class="op">(</span><span class="va">mat</span>, <span class="va">pal</span><span class="op">)</span>
<span class="va">ctstbp</span></pre></div>
<p><img src="singlecell_files/figure-html/unnamed-chunk-30-1.png" width="100%"></p>
<p>Or as matrix plot:</p>
<div class="sourceCode" id="cb39"><pre class="downlit">
<span class="va">mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">mat</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">mat</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span><span class="op">)</span>
<span class="va">mat</span> <span class="op">&lt;-</span> <span class="va">mat</span><span class="op">[</span>,<span class="va">CELL.TYPES</span><span class="op">]</span>
<span class="fu">matrixPlot</span><span class="op">(</span><span class="va">mat</span>, cnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"SUBTYPE"</span>, <span class="st">"CELL.TYPE"</span><span class="op">)</span>, high.color <span class="op">=</span> <span class="st">"darkgreen"</span><span class="op">)</span></pre></div>
<p><img src="singlecell_files/figure-html/unnamed-chunk-31-1.png" width="100%"></p>
<div class="sourceCode" id="cb40"><pre class="downlit">
<span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggarrange.html">ggarrange</a></span><span class="op">(</span><span class="va">stbp</span>,
                <span class="va">ctbp</span> <span class="op">+</span> <span class="fu">theme</span><span class="op">(</span>axis.text.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,
                             axis.title.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>,
                             <span class="co"># axis.ticks.x = element_blank(),</span>
                             <span class="co"># axis.line.x = element_blank()), </span>
                <span class="va">ctstbp</span> <span class="op">+</span> <span class="fu">theme</span><span class="op">(</span>axis.text.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,
                             axis.title.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>,
                nrow <span class="op">=</span> <span class="fl">1</span>, hjust <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span><span class="op">)</span>,
                widths <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1.3</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>,
                legend <span class="op">=</span> <span class="st">"none"</span>, align <span class="op">=</span> <span class="st">"h"</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"C"</span>, <span class="st">"D"</span>, <span class="st">"E"</span><span class="op">)</span><span class="op">)</span>
<span class="va">p1</span></pre></div>
<p><img src="singlecell_files/figure-html/unnamed-chunk-32-1.png" width="100%"></p>
<p>Margin scores:</p>
<div class="sourceCode" id="cb41"><pre class="downlit">
<span class="va">spl.margin</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">sce</span>, <span class="va">col</span> <span class="op">=</span> <span class="st">"celltype"</span><span class="op">)</span>
    <span class="fu">reshape2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html">melt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/split.html">split</a></span><span class="op">(</span><span class="va">sce</span><span class="op">$</span><span class="va">margin</span>, <span class="va">sce</span><span class="op">[[</span><span class="va">col</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
<span class="va">psces</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">sces</span>, <span class="va">spl.margin</span><span class="op">)</span>
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">tumors</span><span class="op">)</span> <span class="va">psces</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/match.html">match</a></span><span class="op">(</span><span class="va">i</span>, <span class="va">tumors</span><span class="op">)</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">tumor</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"T"</span>, <span class="va">i</span><span class="op">)</span>
<span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">psces</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"MARGIN"</span>, <span class="st">"CELL.TYPE"</span>, <span class="st">"TUMOR"</span><span class="op">)</span>
<span class="va">df</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">df</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, levels <span class="op">=</span> <span class="va">CELL.TYPES</span><span class="op">)</span></pre></div>
<p>Boxplot of margin scores:</p>
<div class="sourceCode" id="cb42"><pre class="downlit">
<span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggboxplot.html">ggboxplot</a></span><span class="op">(</span><span class="va">df</span>, x <span class="op">=</span> <span class="st">"CELL.TYPE"</span>, y <span class="op">=</span> <span class="st">"MARGIN"</span>, width <span class="op">=</span> <span class="fl">0.8</span>, notch <span class="op">=</span> <span class="cn">TRUE</span>,
            fill <span class="op">=</span> <span class="st">"CELL.TYPE"</span>, palette <span class="op">=</span> <span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/get_palette.html">get_palette</a></span><span class="op">(</span><span class="st">"lancet"</span>, <span class="fl">5</span><span class="op">)</span>,
            facet.by <span class="op">=</span> <span class="st">"TUMOR"</span>, nrow <span class="op">=</span> <span class="fl">1</span>,  
            x.text.angle <span class="op">=</span> <span class="fl">45</span>, legend<span class="op">=</span><span class="st">"none"</span>, ggtheme <span class="op">=</span> <span class="fu">theme_bw</span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span><span class="op">)</span> </pre></div>
<p><img src="singlecell_files/figure-html/unnamed-chunk-34-1.png" width="100%"></p>
<p>Only epithelial cells:</p>
<div class="sourceCode" id="cb43"><pre class="downlit">
<span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">df</span>, <span class="va">CELL.TYPE</span> <span class="op">==</span> <span class="st">"EPI"</span><span class="op">)</span>
<span class="va">bp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggboxplot.html">ggboxplot</a></span><span class="op">(</span><span class="va">df</span>, x <span class="op">=</span> <span class="st">"TUMOR"</span>, y <span class="op">=</span> <span class="st">"MARGIN"</span>, width <span class="op">=</span> <span class="fl">0.8</span>, notch <span class="op">=</span> <span class="cn">TRUE</span>,
                fill <span class="op">=</span> <span class="st">"lightgrey"</span>, <span class="co">#cb.red,</span>
                legend<span class="op">=</span><span class="st">"none"</span>, ggtheme <span class="op">=</span> <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span>, ylab <span class="op">=</span> <span class="st">"MARGIN (EPI)"</span>,
                font.x <span class="op">=</span> <span class="fl">11</span>, font.y <span class="op">=</span> <span class="fl">11</span>, font.tickslab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="st">"plain"</span>, <span class="st">"black"</span><span class="op">)</span><span class="op">)</span>
                <span class="co"># ylim = c(0,1),x.text.angle = 45, </span>
<span class="va">df.points</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>x<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.376</span>, <span class="fl">0.766</span>, <span class="fl">0.182</span>, <span class="fl">0.646</span>, <span class="fl">0.214</span><span class="op">)</span><span class="op">)</span>
<span class="va">bp</span> <span class="op">&lt;-</span> <span class="va">bp</span> <span class="op">+</span> <span class="fu">geom_point</span><span class="op">(</span>data <span class="op">=</span> <span class="va">df.points</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span>, shape <span class="op">=</span> <span class="fl">8</span>, size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span>
           <span class="fu">geom_text</span><span class="op">(</span>data <span class="op">=</span> <span class="va">df.points</span><span class="op">[</span><span class="fl">2</span>,<span class="op">]</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span>,
                     label <span class="op">=</span> <span class="st">"Bulk"</span>, hjust <span class="op">=</span> <span class="fl">0</span>, nudge_x <span class="op">=</span> <span class="fl">0.1</span>, size <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>
<span class="va">bp</span></pre></div>
<p><img src="singlecell_files/figure-html/unnamed-chunk-35-1.png" width="100%"></p>
</div>
<div id="bulk-rna-seq" class="section level2">
<h2 class="hasAnchor">
<a href="#bulk-rna-seq" class="anchor"></a>Bulk RNA-seq</h2>
<div class="sourceCode" id="cb44"><pre class="downlit">
<span class="va">durl</span> <span class="op">&lt;-</span> <span class="st">"https://dl.dropboxusercontent.com/s/lit4wok327u1mps"</span>
<span class="va">dfile</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">durl</span>, <span class="st">"Bulk_RNAseq_March2020.txt"</span><span class="op">)</span>
<span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.delim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/connections.html">file</a></span><span class="op">(</span><span class="va">dfile</span><span class="op">)</span>, as.is<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
<span class="va">cpm.ind</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">dat</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">==</span> <span class="st">""</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span>
<span class="va">cpm.dat</span> <span class="op">&lt;-</span> <span class="va">dat</span><span class="op">[</span><span class="va">cpm.ind</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">8</span><span class="op">]</span>
<span class="va">raw.dat</span> <span class="op">&lt;-</span> <span class="va">dat</span><span class="op">[</span>,<span class="fl">9</span><span class="op">:</span><span class="fl">16</span><span class="op">]</span>
<span class="va">cpm.sym</span> <span class="op">&lt;-</span> <span class="va">cpm.dat</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>
<span class="va">raw.sym</span> <span class="op">&lt;-</span> <span class="va">raw.dat</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span></pre></div>
<p>Use pre-computed library size-normalized expression values for subtype assignment:</p>
<div class="sourceCode" id="cb45"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">cpm.dat</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">cpm.dat</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span> 
<span class="va">cpm.dat</span> <span class="op">&lt;-</span> <span class="va">cpm.dat</span><span class="op">[</span>,<span class="fl">3</span><span class="op">:</span><span class="fl">8</span><span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">cpm.dat</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"T"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">59</span>, <span class="fl">77</span>, <span class="fl">76</span>, <span class="fl">89</span>, <span class="fl">90</span>, <span class="fl">91</span><span class="op">)</span><span class="op">)</span> 
<span class="va">cpm.dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">cpm.dat</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/mode.html">mode</a></span><span class="op">(</span><span class="va">cpm.dat</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"numeric"</span>
<span class="va">cpm.se</span> <span class="op">&lt;-</span> <span class="fu">SummarizedExperiment</span><span class="op">(</span>assays <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>cpm <span class="op">=</span> <span class="va">cpm.dat</span><span class="op">)</span><span class="op">)</span>
<span class="va">cpm.se</span> <span class="op">&lt;-</span> <span class="fu">EnrichmentBrowser</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/EnrichmentBrowser/man/idMap.html">idMap</a></span><span class="op">(</span><span class="va">cpm.se</span>, org<span class="op">=</span><span class="st">"hsa"</span>, from<span class="op">=</span><span class="st">"ENSEMBL"</span>, to<span class="op">=</span><span class="st">"ENTREZID"</span><span class="op">)</span>
<span class="va">cpm.file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">data.dir</span>, <span class="st">"bulk_cpm_subtypes.rds"</span><span class="op">)</span></pre></div>
<div class="sourceCode" id="cb46"><pre class="downlit">
<span class="va">cst</span> <span class="op">&lt;-</span> <span class="fu">consensusOV</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/consensusOV/man/get.consensus.subtypes.html">get.consensus.subtypes</a></span><span class="op">(</span><span class="fu">assay</span><span class="op">(</span><span class="va">cpm.se</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">cpm.se</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span><span class="op">(</span><span class="va">cst</span>, file <span class="op">=</span> <span class="va">cpm.file</span><span class="op">)</span></pre></div>
<div class="sourceCode" id="cb47"><pre class="downlit">
<span class="va">cst</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="va">cpm.file</span><span class="op">)</span>
<span class="va">cst</span></pre></div>
<pre><code>## $consensusOV.subtypes
## [1] IMR_consensus PRO_consensus MES_consensus IMR_consensus PRO_consensus
## [6] DIF_consensus
## Levels: IMR_consensus DIF_consensus PRO_consensus MES_consensus
## 
## $rf.probs
##     IMR_consensus DIF_consensus PRO_consensus MES_consensus
## T59         0.792         0.040         0.014         0.154
## T77         0.284         0.256         0.336         0.124
## T76         0.016         0.008         0.038         0.938
## T89         0.866         0.046         0.008         0.080
## T90         0.092         0.094         0.452         0.362
## T91         0.030         0.962         0.004         0.004
## attr(,"class")
## [1] "matrix" "votes"</code></pre>
<p>Sanity check: start from raw read counts</p>
<div class="sourceCode" id="cb49"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">raw.dat</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">raw.dat</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>
<span class="va">raw.dat</span> <span class="op">&lt;-</span> <span class="va">raw.dat</span><span class="op">[</span>,<span class="fl">3</span><span class="op">:</span><span class="fl">8</span><span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">raw.dat</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"T"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">59</span>, <span class="fl">77</span>, <span class="fl">76</span>, <span class="fl">89</span>, <span class="fl">90</span>, <span class="fl">91</span><span class="op">)</span><span class="op">)</span>
<span class="va">raw.dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">raw.dat</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/mode.html">mode</a></span><span class="op">(</span><span class="va">raw.dat</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"numeric"</span>
<span class="va">raw.dat</span> <span class="op">&lt;-</span> <span class="fu">edgeR</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/edgeR/man/cpm.html">cpm</a></span><span class="op">(</span><span class="va">raw.dat</span>, log<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
<span class="va">raw.se</span> <span class="op">&lt;-</span> <span class="fu">SummarizedExperiment</span><span class="op">(</span>assays <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>raw <span class="op">=</span> <span class="va">raw.dat</span><span class="op">)</span><span class="op">)</span>
<span class="va">raw.se</span> <span class="op">&lt;-</span> <span class="fu">EnrichmentBrowser</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/EnrichmentBrowser/man/idMap.html">idMap</a></span><span class="op">(</span><span class="va">raw.se</span>, org<span class="op">=</span><span class="st">"hsa"</span>, from<span class="op">=</span><span class="st">"ENSEMBL"</span>, to<span class="op">=</span><span class="st">"ENTREZID"</span><span class="op">)</span>
<span class="va">raw.file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">data.dir</span>, <span class="st">"bulk_raw_subtypes.rds"</span><span class="op">)</span></pre></div>
<div class="sourceCode" id="cb50"><pre class="downlit">
<span class="va">cst2</span> <span class="op">&lt;-</span> <span class="fu">consensusOV</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/consensusOV/man/get.consensus.subtypes.html">get.consensus.subtypes</a></span><span class="op">(</span><span class="fu">assay</span><span class="op">(</span><span class="va">raw.se</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">raw.se</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span><span class="op">(</span><span class="va">cst2</span>, file <span class="op">=</span> <span class="va">raw.file</span><span class="op">)</span></pre></div>
<p>Pretty much the same as when starting from already normalized expression values:</p>
<div class="sourceCode" id="cb51"><pre class="downlit">
<span class="va">cst2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="va">raw.file</span><span class="op">)</span>
<span class="va">cst2</span></pre></div>
<pre><code>## $consensusOV.subtypes
## [1] IMR_consensus PRO_consensus MES_consensus IMR_consensus PRO_consensus
## [6] DIF_consensus
## Levels: IMR_consensus DIF_consensus PRO_consensus MES_consensus
## 
## $rf.probs
##     IMR_consensus DIF_consensus PRO_consensus MES_consensus
## T59         0.746         0.060         0.024         0.170
## T77         0.272         0.266         0.392         0.070
## T76         0.002         0.002         0.014         0.982
## T89         0.888         0.042         0.014         0.056
## T90         0.066         0.116         0.516         0.302
## T91         0.018         0.952         0.024         0.006
## attr(,"class")
## [1] "matrix" "votes"</code></pre>
<p>Contrast bulk and single-cell margins:</p>
<div class="sourceCode" id="cb53"><pre class="downlit">
<span class="va">mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">cst</span><span class="op">$</span><span class="va">rf.probs</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">mat</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">sub</a></span><span class="op">(</span><span class="st">"_consensus"</span>, <span class="st">""</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">mat</span><span class="op">)</span><span class="op">)</span>
<span class="va">mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">mat</span>, digits <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>
<span class="va">mat</span> <span class="op">&lt;-</span> <span class="va">mat</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">4</span>,<span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span>,<span class="fl">2</span>,<span class="fl">4</span><span class="op">)</span><span class="op">]</span></pre></div>
<div class="sourceCode" id="cb54"><pre class="downlit">
<span class="va">mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.15</span>, <span class="fl">0.02</span>, <span class="fl">0.5</span>, <span class="fl">0.13</span>, <span class="fl">0.12</span><span class="op">)</span>,
             <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.59</span>, <span class="fl">0.03</span>, <span class="fl">0.14</span>, <span class="fl">0.77</span>, <span class="fl">0.07</span><span class="op">)</span>,
             <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.22</span>, <span class="fl">0.85</span>, <span class="fl">0.03</span>, <span class="fl">0.08</span>, <span class="fl">0.3</span><span class="op">)</span>,
             <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.04</span>, <span class="fl">0.09</span>, <span class="fl">0.32</span>, <span class="fl">0.02</span>, <span class="fl">0.52</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">mat</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"T"</span>, <span class="va">tumors</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">mat</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">SUBTYPES</span>
<span class="va">mat</span> <span class="op">&lt;-</span> <span class="va">mat</span><span class="op">[</span><span class="fl">4</span><span class="op">:</span><span class="fl">1</span>,<span class="op">]</span>
<span class="va">mp</span> <span class="op">&lt;-</span> <span class="fu">matrixPlot</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">mat</span><span class="op">)</span>, cnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"TUMORS"</span>, <span class="st">"CLASS.PROB"</span><span class="op">)</span>,
                    bw.thresh <span class="op">=</span> <span class="fl">0.5</span>, gthresh <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span>
<span class="va">mp</span> <span class="op">&lt;-</span> <span class="va">mp</span> <span class="op">+</span> <span class="fu">theme</span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,
                 axis.title.x <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,
                 axis.ticks.x <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,
                 axis.line.x <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,
                 plot.margin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/consensusOV/man/get.consensus.subtypes.html">margin</a></span><span class="op">(</span>b <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span>
<span class="va">mp</span> <span class="op">&lt;-</span> <span class="va">mp</span> <span class="op">+</span> <span class="fu">ylab</span><span class="op">(</span><span class="st">"BULK"</span><span class="op">)</span>
<span class="va">p0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggarrange.html">ggarrange</a></span><span class="op">(</span><span class="va">mp</span>, <span class="va">bp</span>, vjust <span class="op">=</span> <span class="fl">0.5</span>, hjust <span class="op">=</span> <span class="fl">0.5</span>,
                nrow <span class="op">=</span> <span class="fl">2</span>, align <span class="op">=</span> <span class="st">"v"</span>, heights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"F"</span>, <span class="st">""</span><span class="op">)</span><span class="op">)</span>
<span class="va">p0</span></pre></div>
<p><img src="singlecell_files/figure-html/unnamed-chunk-44-1.png" width="100%"></p>
<div class="sourceCode" id="cb55"><pre class="downlit">
<span class="va">p3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggarrange.html">ggarrange</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p0</span>, nrow <span class="op">=</span> <span class="fl">1</span>, widths <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggarrange.html">ggarrange</a></span><span class="op">(</span><span class="va">p2</span>, <span class="va">p3</span>, heights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></pre></div>
<p><img src="singlecell_files/figure-html/unnamed-chunk-44-2.png" width="100%"></p>
</div>
</div>
<div id="infercnv" class="section level1">
<h1 class="hasAnchor">
<a href="#infercnv" class="anchor"></a>InferCNV</h1>
<ul>
<li>tumor 59: 3,500 epithelial cells vs.Â 9,500 reference (non-epithelial) cells</li>
<li>tumor 76: 210 epithelial cells vs.Â 13,500 reference (non-epithelial) cells</li>
<li>tumor 77: 2,900 epithelial cells vs.Â 4,000 reference (non-epithelial) cells</li>
<li>tumor 89: 300 epithelial cells vs.Â 4,600 reference (non-epithelial) cells</li>
<li>tumor 90: 900 epithelial cells vs.Â 2,700 reference (non-epithelial) cells</li>
</ul>
<div id="prepare-input-files-and-execute-infercnv" class="section level2">
<h2 class="hasAnchor">
<a href="#prepare-input-files-and-execute-infercnv" class="anchor"></a>Prepare input files and execute InferCNV</h2>
<p>Prepare input files from a <code>SingleCellExperiment</code></p>
<div class="sourceCode" id="cb56"><pre class="downlit">
<span class="va">obj</span> <span class="op">&lt;-</span> <span class="fu">generateInferCNVInput</span><span class="op">(</span><span class="va">sces</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="st">"tumor59"</span><span class="op">)</span></pre></div>
<p>Run <code>inferCNV</code> for one tumor at a time (computational intensive, several hours). Best executed on a cluster (here with 20 cores).</p>
<div class="sourceCode" id="cb57"><pre class="downlit">
<span class="co"># cutoff = 1 works well for Smart-seq2, </span>
<span class="co"># cutoff = 0.1 works well for 10x Genomics</span>
<span class="va">res</span> <span class="op">&lt;-</span> <span class="fu">infercnv</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/infercnv/man/run.html">run</a></span><span class="op">(</span><span class="va">obj</span>,
                     cutoff <span class="op">=</span> <span class="fl">0.1</span>, 
                     out_dir <span class="op">=</span> <span class="st">"tumor59"</span>,
                     num_threads <span class="op">=</span> <span class="fl">20</span>,
                     denoise <span class="op">=</span> <span class="cn">TRUE</span>,
                     HMM <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></pre></div>
</div>
<div id="cross-tumor-heatmap" class="section level2">
<h2 class="hasAnchor">
<a href="#cross-tumor-heatmap" class="anchor"></a>Cross-tumor heatmap</h2>
<div class="sourceCode" id="cb58"><pre class="downlit">
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span><span class="op">(</span><span class="va">sces</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">sces</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">sces</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">Barcode</span></pre></div>
<p>Read observation matrix (expression profiles of cancer epithelial cells)</p>
<div class="sourceCode" id="cb59"><pre class="downlit">
<span class="va">tags</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"p7r313prargcp3g"</span>, <span class="st">"6yunw77zfe4nzgw"</span>, <span class="st">"qaop7h1sh2bxm5g"</span>,
          <span class="st">"x469lcpm3rp5dxo"</span>, <span class="st">"m56zm2zywjcongz"</span><span class="op">)</span>
<span class="va">durl</span> <span class="op">&lt;-</span> <span class="st">"https://dl.dropboxusercontent.com/s/tag/TXX_infercnv.observations.rds"</span></pre></div>
<div class="sourceCode" id="cb60"><pre class="downlit">
<span class="va">readObsMat</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span>
<span class="op">{</span> 
    <span class="va">dl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">sub</a></span><span class="op">(</span><span class="st">"XX"</span>, <span class="va">tumors</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="va">durl</span><span class="op">)</span>
    <span class="va">dl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">sub</a></span><span class="op">(</span><span class="st">"tag"</span>, <span class="va">tags</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="va">dl</span><span class="op">)</span>
    <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/connections.html">file</a></span><span class="op">(</span><span class="va">dl</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span></pre></div>
<div class="sourceCode" id="cb61"><pre class="downlit">
<span class="va">obs.mats</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="va">readObsMat</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">obs.mats</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"T"</span>, <span class="va">tumors</span><span class="op">)</span></pre></div>
<p>Subset and annotate cells:</p>
<div class="sourceCode" id="cb62"><pre class="downlit">
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span><span class="op">(</span><span class="va">tumors</span><span class="op">)</span><span class="op">)</span> 
    <span class="va">obs.mats</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">subsetObservations</span><span class="op">(</span><span class="va">obs.mats</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>, <span class="va">sces</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
<span class="va">ra</span> <span class="op">&lt;-</span> <span class="fu">getCellAnnotation</span><span class="op">(</span><span class="va">sces</span>, <span class="va">obs.mats</span><span class="op">)</span></pre></div>
<p>Create union of genes featured in the inferCNV output of each tumor, extend individual observations as needed, and create a combined observation matrix storing the information across all tumors:</p>
<div class="sourceCode" id="cb63"><pre class="downlit">
<span class="va">un</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/funprog.html">Reduce</a></span><span class="op">(</span><span class="va">union</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">obs.mats</span>, <span class="va">rownames</span><span class="op">)</span><span class="op">)</span>
<span class="va">obs.mats</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">obs.mats</span>, <span class="va">extendObservations</span>, un <span class="op">=</span> <span class="va">un</span><span class="op">)</span> 
<span class="va">obs.mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="va">cbind</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">obs.mats</span>, <span class="kw">function</span><span class="op">(</span><span class="va">o</span><span class="op">)</span> <span class="va">o</span><span class="op">[</span><span class="va">un</span>,<span class="op">]</span><span class="op">)</span><span class="op">)</span></pre></div>
<p>Obtain genomic coordinates for the genes in the combined observation matrix:</p>
<div class="sourceCode" id="cb64"><pre class="downlit">
<span class="va">egenes</span> <span class="op">&lt;-</span> <span class="fu">symbols2ranges</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">obs.mat</span><span class="op">)</span><span class="op">)</span>
<span class="va">obs.mat</span> <span class="op">&lt;-</span> <span class="va">obs.mat</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">egenes</span><span class="op">)</span>,<span class="op">]</span>
<span class="va">chr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="fu">seqnames</span><span class="op">(</span><span class="va">egenes</span><span class="op">)</span><span class="op">)</span></pre></div>
<p>Highlight specific recurrent regions with known driver genes from the TCGA OVC paper:</p>
<div class="sourceCode" id="cb65"><pre class="downlit">
<span class="va">clabs</span> <span class="op">&lt;-</span> <span class="fu">getRecurrentDriverGenes</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">obs.mat</span><span class="op">)</span><span class="op">)</span></pre></div>
<p>Plot the heatmap:</p>
<div class="sourceCode" id="cb66"><pre class="downlit">
<span class="va">im</span> <span class="op">&lt;-</span> <span class="fu">ComplexHeatmap</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/Heatmap.html">Heatmap</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">obs.mat</span><span class="op">)</span>,
    <span class="co">#top_annotation = ta,</span>
    right_annotation <span class="op">=</span> <span class="va">ra</span>,
    name <span class="op">=</span> <span class="st">"Expression"</span>,
    col <span class="op">=</span> <span class="fu">circlize</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/circlize/man/colorRamp2.html">colorRamp2</a></span><span class="op">(</span><span class="co">#c(0.895, 1.105), c("white", "black")),</span>
                                <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.895</span>, <span class="fl">1</span>, <span class="fl">1.105</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"blue"</span>, <span class="st">"white"</span>, <span class="st">"red"</span><span class="op">)</span><span class="op">)</span>,
    row_title_rot <span class="op">=</span> <span class="fl">0</span>, column_title_rot <span class="op">=</span> <span class="fl">90</span>,
    show_row_names <span class="op">=</span> <span class="cn">FALSE</span>, show_column_names <span class="op">=</span> <span class="cn">TRUE</span>,
    cluster_rows <span class="op">=</span> <span class="cn">FALSE</span>, cluster_columns <span class="op">=</span> <span class="cn">FALSE</span>,
    row_split <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"T"</span>, <span class="va">tumors</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">obs.mats</span>, <span class="va">ncol</span><span class="op">)</span><span class="op">)</span>,
    column_spl <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">chr</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">chr</span><span class="op">)</span><span class="op">)</span>,
    column_gap <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">0</span>, <span class="st">"mm"</span><span class="op">)</span>,
    column_title_gp <span class="op">=</span> <span class="fu">gpar</span><span class="op">(</span>fontsize <span class="op">=</span> <span class="fl">6</span><span class="op">)</span>,
    column_labels <span class="op">=</span> <span class="va">clabs</span>,
    column_names_gp <span class="op">=</span> <span class="fu">gpar</span><span class="op">(</span>fontsize <span class="op">=</span> <span class="fl">6</span><span class="op">)</span>,
    border <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">im</span> <span class="op">&lt;-</span> <span class="fu">grid.grabExpr</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/draw-dispatch.html">draw</a></span><span class="op">(</span><span class="va">im</span><span class="op">)</span><span class="op">)</span>
<span class="va">im</span></pre></div>
</div>
</div>
<div id="cell-cycle" class="section level1">
<h1 class="hasAnchor">
<a href="#cell-cycle" class="anchor"></a>Cell Cycle</h1>
<div id="cyclins" class="section level2">
<h2 class="hasAnchor">
<a href="#cyclins" class="anchor"></a>Cyclins</h2>
<div id="tumor-59" class="section level3">
<h3 class="hasAnchor">
<a href="#tumor-59" class="anchor"></a>Tumor 59</h3>
<div class="sourceCode" id="cb67"><pre class="downlit">
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span><span class="op">(</span><span class="va">sces</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">sces</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="cn">NULL</span>
<span class="va">sce59</span> <span class="op">&lt;-</span> <span class="fu">subsetByCellType</span><span class="op">(</span><span class="va">sces</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, cell.type <span class="op">=</span> <span class="st">"EPI"</span>, subtype <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"DIF"</span>, <span class="st">"PRO"</span><span class="op">)</span><span class="op">)</span>
<span class="va">sce59</span></pre></div>
<pre><code>## class: SingleCellExperiment 
## dim: 18079 3451 
## metadata(1): log.exprs.offset
## assays(2): counts logcounts
## rownames(18079): AL669831.5 LINC00115 ... AC004556.1 AC240274.1
## rowData names(12): ID Symbol ... log10_total_counts AveCount
## colnames: NULL
## colData names(53): Sample Barcode ... MES_consensus sizeFactor
## reducedDimNames(2): PCA TSNE
## altExpNames(0):</code></pre>
<div class="sourceCode" id="cb69"><pre class="downlit">
<span class="va">cyclin.genes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">grep</a></span><span class="op">(</span><span class="st">"^CCN[ABDE][0-9]$"</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">sce59</span><span class="op">)</span>, value <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">cyclin.genes</span></pre></div>
<pre><code>## [1] "CCNA2" "CCNB1" "CCND3" "CCNE2" "CCND1" "CCND2" "CCNA1" "CCNB2" "CCNE1"</code></pre>
<div class="sourceCode" id="cb71"><pre class="downlit">
<span class="fu">markerHeatmap</span><span class="op">(</span><span class="va">sce59</span>, <span class="va">cyclin.genes</span><span class="op">)</span></pre></div>
<p><img src="singlecell_files/figure-html/unnamed-chunk-57-1.png" width="100%"></p>
<div class="sourceCode" id="cb72"><pre class="downlit">
<span class="fu">bpCyclins</span><span class="op">(</span><span class="va">sce59</span><span class="op">)</span></pre></div>
<pre><code>## Total EPI-DIF:3016</code></pre>
<pre><code>## Total EPI-PRO:435</code></pre>
<p><img src="singlecell_files/figure-html/unnamed-chunk-57-2.png" width="100%"></p>
</div>
<div id="tumor-77" class="section level3">
<h3 class="hasAnchor">
<a href="#tumor-77" class="anchor"></a>Tumor 77</h3>
<div class="sourceCode" id="cb75"><pre class="downlit">
<span class="va">sce77</span> <span class="op">&lt;-</span> <span class="fu">subsetByCellType</span><span class="op">(</span><span class="va">sces</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span>, cell.type <span class="op">=</span> <span class="st">"EPI"</span>, subtype <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"DIF"</span>, <span class="st">"PRO"</span><span class="op">)</span><span class="op">)</span>
<span class="fu">bpCyclins</span><span class="op">(</span><span class="va">sce77</span><span class="op">)</span></pre></div>
<pre><code>## Total EPI-DIF:2212</code></pre>
<pre><code>## Total EPI-PRO:612</code></pre>
<p><img src="singlecell_files/figure-html/unnamed-chunk-58-1.png" width="100%"></p>
</div>
<div id="tumor-90" class="section level3">
<h3 class="hasAnchor">
<a href="#tumor-90" class="anchor"></a>Tumor 90</h3>
<div class="sourceCode" id="cb78"><pre class="downlit">
<span class="va">sce90</span> <span class="op">&lt;-</span> <span class="fu">subsetByCellType</span><span class="op">(</span><span class="va">sces</span><span class="op">[[</span><span class="fl">5</span><span class="op">]</span><span class="op">]</span>, cell.type <span class="op">=</span> <span class="st">"EPI"</span>, subtype <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"DIF"</span>, <span class="st">"PRO"</span><span class="op">)</span><span class="op">)</span>
<span class="fu">bpCyclins</span><span class="op">(</span><span class="va">sce90</span><span class="op">)</span></pre></div>
<pre><code>## Total EPI-DIF:804</code></pre>
<pre><code>## Total EPI-PRO:89</code></pre>
<p><img src="singlecell_files/figure-html/unnamed-chunk-59-1.png" width="100%"></p>
</div>
</div>
<div id="marker-genes-1" class="section level2">
<h2 class="hasAnchor">
<a href="#marker-genes-1" class="anchor"></a>Marker genes</h2>
<div id="tumor-59-1" class="section level3">
<h3 class="hasAnchor">
<a href="#tumor-59-1" class="anchor"></a>Tumor 59</h3>
<div class="sourceCode" id="cb81"><pre class="downlit">
<span class="va">markers59</span> <span class="op">&lt;-</span> <span class="fu">scran</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/scran/man/findMarkers.html">findMarkers</a></span><span class="op">(</span><span class="va">sce59</span>, groups <span class="op">=</span> <span class="va">sce59</span><span class="op">$</span><span class="va">subtype</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">markers59</span><span class="op">$</span><span class="va">DIF</span><span class="op">)</span></pre></div>
<pre><code>## DataFrame with 6 rows and 5 columns
##                Top      p.value          FDR summary.logFC logFC.PRO
##          &lt;integer&gt;    &lt;numeric&gt;    &lt;numeric&gt;     &lt;numeric&gt; &lt;numeric&gt;
## PDZK1IP1         1 7.67751e-280 1.38802e-275      1.041291  1.041291
## LCN2             2 6.04990e-183 5.46881e-179      1.442117  1.442117
## RARRES1          3 5.17451e-128 3.11833e-124      1.300031  1.300031
## NNMT             4  2.32691e-92  1.05171e-88      0.966470  0.966470
## SLPI             5  6.69700e-72  2.42150e-68      1.046235  1.046235
## CLU              6  2.45787e-63  7.40599e-60      0.573375  0.573375</code></pre>
<div class="sourceCode" id="cb83"><pre class="downlit">
<span class="va">markers59</span><span class="op">$</span><span class="va">DIF</span><span class="op">[</span><span class="st">"CCND1"</span>,<span class="op">]</span></pre></div>
<pre><code>## DataFrame with 1 row and 5 columns
##             Top     p.value         FDR summary.logFC logFC.PRO
##       &lt;integer&gt;   &lt;numeric&gt;   &lt;numeric&gt;     &lt;numeric&gt; &lt;numeric&gt;
## CCND1        69 1.30891e-17 3.42955e-15      -0.41159  -0.41159</code></pre>
<div class="sourceCode" id="cb85"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">markers59</span><span class="op">$</span><span class="va">DIF</span><span class="op">[</span><span class="va">markers59</span><span class="op">$</span><span class="va">DIF</span><span class="op">$</span><span class="va">logFC.PRO</span> <span class="op">&lt;</span> <span class="fl">0</span>,<span class="op">]</span><span class="op">)</span></pre></div>
<pre><code>## DataFrame with 6 rows and 5 columns
##                Top     p.value         FDR summary.logFC logFC.PRO
##          &lt;integer&gt;   &lt;numeric&gt;   &lt;numeric&gt;     &lt;numeric&gt; &lt;numeric&gt;
## STMN1           21 5.90139e-36 5.08053e-33     -0.483398 -0.483398
## MARCKSL1        31 8.51182e-29 4.96404e-26     -0.444471 -0.444471
## MFAP2           38 1.28209e-25 6.09970e-23     -0.375558 -0.375558
## BMP7            41 2.67124e-24 1.17789e-21     -0.305718 -0.305718
## ODC1            53 3.48573e-21 1.18903e-18     -0.388360 -0.388360
## SOX4            56 1.17824e-19 3.80381e-17     -0.457773 -0.457773</code></pre>
<div class="sourceCode" id="cb87"><pre class="downlit">
<span class="fu">markerHeatmap</span><span class="op">(</span><span class="va">sce59</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">markers59</span><span class="op">$</span><span class="va">DIF</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">25</span><span class="op">]</span><span class="op">)</span></pre></div>
<pre><code>## `use_raster` is automatically set to TRUE for a matrix with more than
## 2000 columns You can control `use_raster` arugment by explicitly
## setting TRUE/FALSE to it. Set `ht_opt$message = FALSE` to turn off this
## message.</code></pre>
<p><img src="singlecell_files/figure-html/unnamed-chunk-60-1.png" width="100%"></p>
<p>Contrast with bulk markers</p>
<div class="sourceCode" id="cb89"><pre class="downlit">
<span class="va">data.dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, package <span class="op">=</span> <span class="st">"subtypeHeterogeneity"</span><span class="op">)</span>
<span class="va">verhaak.file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">data.dir</span>, <span class="st">"Verhaak_supplementT8A.txt"</span><span class="op">)</span>
<span class="va">bulk.markers</span> <span class="op">&lt;-</span> <span class="fu">getExtendedVerhaakSignature</span><span class="op">(</span><span class="va">verhaak.file</span>, 
                                            nr.genes.per.subtype <span class="op">=</span> <span class="fl">200</span>,
                                            by.subtype <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">bmarkers59</span> <span class="op">&lt;-</span> <span class="fu">compileMarkers</span><span class="op">(</span><span class="va">markers59</span>, <span class="va">bulk.markers</span><span class="op">)</span>
<span class="va">bmarkers59</span></pre></div>
<pre><code>## DataFrame with 20 rows and 5 columns
##                Top      p.value          FDR summary.logFC  logFC.PRO
##          &lt;integer&gt;    &lt;numeric&gt;    &lt;numeric&gt;     &lt;numeric&gt;  &lt;numeric&gt;
## PDZK1IP1         1 7.67751e-280 1.38802e-275      1.041291   1.041291
## LCN2             2 6.04990e-183 5.46881e-179      1.442117   1.442117
## CLU              6  2.45787e-63  7.40599e-60      0.573375   0.573375
## SNCG            13  3.15316e-45  4.38508e-42      0.630183   0.630183
## MGLL            44  1.73681e-23  7.13633e-21      0.100031   0.100031
## ...            ...          ...          ...           ...        ...
## TUBB2B         105  1.85723e-14  3.19779e-12    -0.2332033 -0.2332033
## LHX1           137  1.45247e-12  1.91673e-10    -0.2236155 -0.2236155
## MEST           156  7.76116e-12  8.99449e-10    -0.2592555 -0.2592555
## CBX1           214  3.60370e-10  3.04446e-08    -0.1990522 -0.1990522
## KCNG1          239  1.06686e-09  8.07016e-08    -0.0713828 -0.0713828</code></pre>
<div class="sourceCode" id="cb91"><pre class="downlit">
<span class="fu">markerHeatmap</span><span class="op">(</span><span class="va">sce59</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">bmarkers59</span><span class="op">)</span>, row.split <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></pre></div>
<pre><code>## `use_raster` is automatically set to TRUE for a matrix with more than
## 2000 columns You can control `use_raster` arugment by explicitly
## setting TRUE/FALSE to it. Set `ht_opt$message = FALSE` to turn off this
## message.</code></pre>
<p><img src="singlecell_files/figure-html/unnamed-chunk-61-1.png" width="100%"></p>
</div>
<div id="tumor-77-1" class="section level3">
<h3 class="hasAnchor">
<a href="#tumor-77-1" class="anchor"></a>Tumor 77</h3>
<div class="sourceCode" id="cb93"><pre class="downlit">
<span class="va">markers77</span> <span class="op">&lt;-</span> <span class="fu">scran</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/scran/man/findMarkers.html">findMarkers</a></span><span class="op">(</span><span class="va">sce77</span>, groups <span class="op">=</span> <span class="va">sce77</span><span class="op">$</span><span class="va">subtype</span><span class="op">)</span>
<span class="fu">markerHeatmap</span><span class="op">(</span><span class="va">sce77</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">markers77</span><span class="op">$</span><span class="va">DIF</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">25</span><span class="op">]</span><span class="op">)</span></pre></div>
<pre><code>## `use_raster` is automatically set to TRUE for a matrix with more than
## 2000 columns You can control `use_raster` arugment by explicitly
## setting TRUE/FALSE to it. Set `ht_opt$message = FALSE` to turn off this
## message.</code></pre>
<p><img src="singlecell_files/figure-html/unnamed-chunk-62-1.png" width="100%"></p>
<div class="sourceCode" id="cb95"><pre class="downlit">
<span class="va">bmarkers77</span> <span class="op">&lt;-</span> <span class="fu">compileMarkers</span><span class="op">(</span><span class="va">markers77</span>, <span class="va">bulk.markers</span><span class="op">)</span>
<span class="fu">markerHeatmap</span><span class="op">(</span><span class="va">sce77</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">bmarkers77</span><span class="op">)</span>, row.split <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></pre></div>
<pre><code>## `use_raster` is automatically set to TRUE for a matrix with more than
## 2000 columns You can control `use_raster` arugment by explicitly
## setting TRUE/FALSE to it. Set `ht_opt$message = FALSE` to turn off this
## message.</code></pre>
<p><img src="singlecell_files/figure-html/unnamed-chunk-62-2.png" width="100%"></p>
</div>
<div id="tumor-90-1" class="section level3">
<h3 class="hasAnchor">
<a href="#tumor-90-1" class="anchor"></a>Tumor 90</h3>
<div class="sourceCode" id="cb97"><pre class="downlit">
<span class="va">markers90</span> <span class="op">&lt;-</span> <span class="fu">scran</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/scran/man/findMarkers.html">findMarkers</a></span><span class="op">(</span><span class="va">sce90</span>, groups <span class="op">=</span> <span class="va">sce90</span><span class="op">$</span><span class="va">subtype</span><span class="op">)</span>
<span class="fu">markerHeatmap</span><span class="op">(</span><span class="va">sce90</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">markers90</span><span class="op">$</span><span class="va">DIF</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">25</span><span class="op">]</span><span class="op">)</span></pre></div>
<p><img src="singlecell_files/figure-html/unnamed-chunk-63-1.png" width="100%"></p>
<div class="sourceCode" id="cb98"><pre class="downlit">
<span class="va">bmarkers90</span> <span class="op">&lt;-</span> <span class="fu">compileMarkers</span><span class="op">(</span><span class="va">markers90</span>, <span class="va">bulk.markers</span><span class="op">)</span>
<span class="fu">markerHeatmap</span><span class="op">(</span><span class="va">sce90</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">bmarkers90</span><span class="op">)</span>, row.split <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></pre></div>
<p><img src="singlecell_files/figure-html/unnamed-chunk-63-2.png" width="100%"></p>
</div>
<div id="combined" class="section level3">
<h3 class="hasAnchor">
<a href="#combined" class="anchor"></a>Combined</h3>
<div class="sourceCode" id="cb99"><pre class="downlit">
<span class="va">markers</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">markers59</span>, <span class="va">markers77</span>, <span class="va">markers90</span><span class="op">)</span>
<span class="va">dif.markers</span> <span class="op">&lt;-</span> <span class="fu">getCommonMarkers</span><span class="op">(</span><span class="va">markers</span>, n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>
<span class="va">pro.markers</span> <span class="op">&lt;-</span> <span class="fu">getCommonMarkers</span><span class="op">(</span><span class="va">markers</span>, subtype <span class="op">=</span> <span class="st">"PRO"</span>, n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>
<span class="va">markers</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">dif.markers</span>, <span class="va">pro.markers</span><span class="op">)</span></pre></div>
<p>capture the heatmap</p>
<div class="sourceCode" id="cb100"><pre class="downlit">
<span class="va">ml</span> <span class="op">&lt;-</span> <span class="fu">markerHeatmapList</span><span class="op">(</span><span class="va">sces</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span>,<span class="fl">5</span><span class="op">)</span><span class="op">]</span>, <span class="va">markers</span>, row.split <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></pre></div>
<pre><code>## `use_raster` is automatically set to TRUE for a matrix with more than
## 2000 columns You can control `use_raster` arugment by explicitly
## setting TRUE/FALSE to it. Set `ht_opt$message = FALSE` to turn off this
## message.</code></pre>
<div class="sourceCode" id="cb102"><pre class="downlit">
<span class="va">m</span> <span class="op">&lt;-</span> <span class="fu">grid.grabExpr</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/draw-dispatch.html">draw</a></span><span class="op">(</span><span class="va">ml</span><span class="op">)</span><span class="op">)</span></pre></div>
</div>
</div>
<div id="cyclone" class="section level2">
<h2 class="hasAnchor">
<a href="#cyclone" class="anchor"></a>Cyclone</h2>
<div id="tumor-59-2" class="section level3">
<h3 class="hasAnchor">
<a href="#tumor-59-2" class="anchor"></a>Tumor 59</h3>
<p>Run the cyclone classifier (pre-computed, computationally intensive)</p>
<div class="sourceCode" id="cb103"><pre class="downlit">
<span class="va">sce.ensembl</span> <span class="op">&lt;-</span> <span class="fu">EnrichmentBrowser</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/EnrichmentBrowser/man/idMap.html">idMap</a></span><span class="op">(</span><span class="va">sce</span>, org <span class="op">=</span> <span class="st">"hsa"</span>, 
                                        from <span class="op">=</span> <span class="st">"SYMBOL"</span>, to <span class="op">=</span> <span class="st">"ENSEMBL"</span><span class="op">)</span>
<span class="va">marker.file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"human_cycle_markers.rds"</span>, package<span class="op">=</span><span class="st">"scran"</span><span class="op">)</span>
<span class="va">hm.pairs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="va">marker.file</span><span class="op">)</span>
<span class="va">cy.assignments</span> <span class="op">&lt;-</span> <span class="fu">scran</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/scran/man/cyclone.html">cyclone</a></span><span class="op">(</span><span class="va">sce.ensembl</span>, <span class="va">hm.pairs</span><span class="op">)</span>
<span class="va">cy.file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">data.dir</span>, <span class="st">"T59_cyclone.rds"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span><span class="op">(</span><span class="va">cy.assignments</span>, file <span class="op">=</span> <span class="va">cy.file</span><span class="op">)</span></pre></div>
<p>Get the computed assignments and plot:</p>
<div class="sourceCode" id="cb104"><pre class="downlit">
<span class="va">cy.file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">data.dir</span>, <span class="st">"T59_cyclone.rds"</span><span class="op">)</span>
<span class="va">cy.assignments</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="va">cy.file</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">cy.assignments</span><span class="op">$</span><span class="va">score</span><span class="op">$</span><span class="va">G1</span>, <span class="va">cy.assignments</span><span class="op">$</span><span class="va">score</span><span class="op">$</span><span class="va">G2M</span>,
     xlab <span class="op">=</span> <span class="st">"G1 score"</span>, ylab <span class="op">=</span> <span class="st">"G2/M score"</span>, pch <span class="op">=</span> <span class="fl">16</span><span class="op">)</span></pre></div>
<p><img src="singlecell_files/figure-html/unnamed-chunk-67-1.png" width="100%"></p>
<div class="sourceCode" id="cb105"><pre class="downlit">
<span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">cy.assignments</span><span class="op">$</span><span class="va">score</span>, subtype <span class="op">=</span> <span class="va">sce59</span><span class="op">$</span><span class="va">subtype</span><span class="op">)</span>
<span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggscatter.html">ggscatter</a></span><span class="op">(</span><span class="va">df</span>, x <span class="op">=</span> <span class="st">"G1"</span>, y <span class="op">=</span> <span class="st">"G2M"</span>, color <span class="op">=</span> <span class="st">"subtype"</span>,
          palette <span class="op">=</span> <span class="va">stcols</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"DIF"</span>, <span class="st">"PRO"</span><span class="op">)</span><span class="op">]</span>, ggtheme <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></pre></div>
<p><img src="singlecell_files/figure-html/unnamed-chunk-67-2.png" width="100%"></p>
<div class="sourceCode" id="cb106"><pre class="downlit">
<span class="va">tab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">cy.assignments</span><span class="op">$</span><span class="va">phases</span>, <span class="va">sce59</span><span class="op">$</span><span class="va">subtype</span><span class="op">)</span>
<span class="va">tab</span></pre></div>
<pre><code>##      
##        DIF  PRO
##   G1  2810  415
##   G2M   96    7
##   S    110   13</code></pre>
<div class="sourceCode" id="cb108"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/stats/chisq.test.html">chisq.test</a></span><span class="op">(</span><span class="va">tab</span><span class="op">)</span></pre></div>
<pre><code>## 
##  Pearson's Chi-squared test
## 
## data:  tab
## X-squared = 3.8206, df = 2, p-value = 0.148</code></pre>
<p>Figure 5:</p>
<div class="sourceCode" id="cb110"><pre class="downlit">
<span class="va">bc</span> <span class="op">&lt;-</span> <span class="fu">bpCyclins</span><span class="op">(</span><span class="va">sces</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, top.only <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.window.html">ylim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">4.3</span><span class="op">)</span><span class="op">)</span></pre></div>
<pre><code>## Total EPI-DIF:3016</code></pre>
<pre><code>## Total EPI-PRO:435</code></pre>
<div class="sourceCode" id="cb113"><pre class="downlit">
<span class="va">bc</span> <span class="op">&lt;-</span> <span class="va">bc</span> <span class="op">+</span> <span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/geom_signif.html">geom_signif</a></span><span class="op">(</span>annotations <span class="op">=</span> <span class="st">"1.8e-07"</span>, 
                  y_position <span class="op">=</span> <span class="fl">4.25</span>, xmin <span class="op">=</span> <span class="fl">4.8</span>, xmax <span class="op">=</span> <span class="fl">5.2</span><span class="op">)</span> 
<span class="va">gs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggscatter.html">ggscatter</a></span><span class="op">(</span><span class="va">df</span>, x <span class="op">=</span> <span class="st">"G1"</span>, y <span class="op">=</span> <span class="st">"G2M"</span>, 
                color <span class="op">=</span> <span class="st">"subtype"</span>, palette <span class="op">=</span> <span class="va">stcols</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"DIF"</span>, <span class="st">"PRO"</span><span class="op">)</span><span class="op">]</span>, 
                ggtheme <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span>, legend <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span>
<span class="va">bc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggarrange.html">ggarrange</a></span><span class="op">(</span><span class="va">bc</span>, <span class="va">gs</span>, ncol <span class="op">=</span> <span class="fl">2</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"B"</span>, <span class="st">"C"</span><span class="op">)</span><span class="op">)</span>
<span class="va">bcd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggarrange.html">ggarrange</a></span><span class="op">(</span><span class="va">bc</span>, <span class="va">m</span>, nrow <span class="op">=</span> <span class="fl">2</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">""</span>, <span class="st">"D"</span><span class="op">)</span><span class="op">)</span>
<span class="va">bcd</span></pre></div>
<p><img src="singlecell_files/figure-html/unnamed-chunk-69-1.png" width="100%"></p>
<div class="sourceCode" id="cb114"><pre class="downlit">
<span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggarrange.html">ggarrange</a></span><span class="op">(</span><span class="va">im</span>, <span class="va">bcd</span>, ncol <span class="op">=</span> <span class="fl">2</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"A"</span>,<span class="st">""</span><span class="op">)</span><span class="op">)</span></pre></div>
</div>
<div id="tumor-77-2" class="section level3">
<h3 class="hasAnchor">
<a href="#tumor-77-2" class="anchor"></a>Tumor 77</h3>
<div class="sourceCode" id="cb115"><pre class="downlit">
<span class="va">cy.file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">sub</a></span><span class="op">(</span><span class="st">"59"</span>, <span class="st">"77"</span>, <span class="va">cy.file</span><span class="op">)</span>
<span class="va">cy.assignments</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="va">cy.file</span><span class="op">)</span>
<span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">cy.assignments</span><span class="op">$</span><span class="va">score</span>, subtype <span class="op">=</span> <span class="va">sce77</span><span class="op">$</span><span class="va">subtype</span><span class="op">)</span>
<span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggscatter.html">ggscatter</a></span><span class="op">(</span><span class="va">df</span>, x <span class="op">=</span> <span class="st">"G1"</span>, y <span class="op">=</span> <span class="st">"G2M"</span>, color <span class="op">=</span> <span class="st">"subtype"</span>,
          palette <span class="op">=</span> <span class="va">stcols</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"DIF"</span>, <span class="st">"PRO"</span><span class="op">)</span><span class="op">]</span>, ggtheme <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></pre></div>
<p><img src="singlecell_files/figure-html/unnamed-chunk-71-1.png" width="100%"></p>
<div class="sourceCode" id="cb116"><pre class="downlit">
<span class="va">tab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">cy.assignments</span><span class="op">$</span><span class="va">phases</span>, <span class="va">sce77</span><span class="op">$</span><span class="va">subtype</span><span class="op">)</span>
<span class="va">tab</span></pre></div>
<pre><code>##      
##        DIF  PRO
##   G1  2127  598
##   G2M   48    9
##   S     37    5</code></pre>
<div class="sourceCode" id="cb118"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/stats/chisq.test.html">chisq.test</a></span><span class="op">(</span><span class="va">tab</span><span class="op">)</span></pre></div>
<pre><code>## 
##  Pearson's Chi-squared test
## 
## data:  tab
## X-squared = 3.642, df = 2, p-value = 0.1619</code></pre>
</div>
<div id="tumor-90-2" class="section level3">
<h3 class="hasAnchor">
<a href="#tumor-90-2" class="anchor"></a>Tumor 90</h3>
<div class="sourceCode" id="cb120"><pre class="downlit">
<span class="va">cy.file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">sub</a></span><span class="op">(</span><span class="st">"77"</span>, <span class="st">"90"</span>, <span class="va">cy.file</span><span class="op">)</span>
<span class="va">cy.assignments</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="va">cy.file</span><span class="op">)</span>
<span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">cy.assignments</span><span class="op">$</span><span class="va">score</span>, subtype <span class="op">=</span> <span class="va">sce90</span><span class="op">$</span><span class="va">subtype</span><span class="op">)</span>
<span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggscatter.html">ggscatter</a></span><span class="op">(</span><span class="va">df</span>, x <span class="op">=</span> <span class="st">"G1"</span>, y <span class="op">=</span> <span class="st">"G2M"</span>, color <span class="op">=</span> <span class="st">"subtype"</span>,
          palette <span class="op">=</span> <span class="va">stcols</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"DIF"</span>, <span class="st">"PRO"</span><span class="op">)</span><span class="op">]</span>, ggtheme <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></pre></div>
<p><img src="singlecell_files/figure-html/unnamed-chunk-73-1.png" width="100%"></p>
<div class="sourceCode" id="cb121"><pre class="downlit">
<span class="va">tab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">cy.assignments</span><span class="op">$</span><span class="va">phases</span>, <span class="va">sce90</span><span class="op">$</span><span class="va">subtype</span><span class="op">)</span>
<span class="va">tab</span></pre></div>
<pre><code>##      
##       DIF PRO
##   G1  732  83
##   G2M  46   3
##   S    26   3</code></pre>
<div class="sourceCode" id="cb123"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/stats/fisher.test.html">fisher.test</a></span><span class="op">(</span><span class="va">tab</span><span class="op">)</span></pre></div>
<pre><code>## 
##  Fisher's Exact Test for Count Data
## 
## data:  tab
## p-value = 0.7446
## alternative hypothesis: two.sided</code></pre>
</div>
</div>
</div>
<div id="session-info" class="section level1">
<h1 class="hasAnchor">
<a href="#session-info" class="anchor"></a>Session Info</h1>
<div class="sourceCode" id="cb125"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></pre></div>
<pre><code>## R version 4.0.0 (2020-04-24)
## Platform: x86_64-pc-linux-gnu (64-bit)
## Running under: Ubuntu 18.04.5 LTS
## 
## Matrix products: default
## BLAS/LAPACK: /usr/lib/x86_64-linux-gnu/libopenblasp-r0.2.20.so
## 
## locale:
##  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C              
##  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8    
##  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=C             
##  [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                 
##  [9] LC_ADDRESS=C               LC_TELEPHONE=C            
## [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       
## 
## attached base packages:
##  [1] grid      parallel  stats4    stats     graphics  grDevices utils    
##  [8] datasets  methods   base     
## 
## other attached packages:
##  [1] ggpubr_0.4.0                ComplexHeatmap_2.4.3       
##  [3] EnrichmentBrowser_2.18.2    graph_1.66.0               
##  [5] org.Hs.eg.db_3.11.4         EnsDb.Hsapiens.v86_2.99.0  
##  [7] ensembldb_2.12.1            AnnotationFilter_1.12.0    
##  [9] GenomicFeatures_1.40.1      AnnotationDbi_1.50.3       
## [11] SingleR_1.2.4               DropletUtils_1.8.0         
## [13] scran_1.16.0                scater_1.16.2              
## [15] ggplot2_3.3.2               consensusOV_1.10.0         
## [17] subtypeHeterogeneity_1.0.4  SingleCellExperiment_1.10.1
## [19] SummarizedExperiment_1.18.2 DelayedArray_0.14.1        
## [21] matrixStats_0.57.0          Biobase_2.48.0             
## [23] GenomicRanges_1.40.0        GenomeInfoDb_1.24.2        
## [25] IRanges_2.22.2              S4Vectors_0.26.1           
## [27] BiocGenerics_0.34.0         knitr_1.30                 
## 
## loaded via a namespace (and not attached):
##   [1] R.utils_2.10.1                          
##   [2] tidyselect_1.1.0                        
##   [3] RSQLite_2.2.1                           
##   [4] BiocParallel_1.22.0                     
##   [5] munsell_0.5.0                           
##   [6] codetools_0.2-16                        
##   [7] ragg_0.4.0                              
##   [8] statmod_1.4.34                          
##   [9] withr_2.3.0                             
##  [10] colorspace_1.4-1                        
##  [11] TxDb.Hsapiens.UCSC.hg38.knownGene_3.10.0
##  [12] ggsignif_0.6.0                          
##  [13] labeling_0.3                            
##  [14] KEGGgraph_1.48.0                        
##  [15] GenomeInfoDbData_1.2.3                  
##  [16] farver_2.0.3                            
##  [17] bit64_4.0.5                             
##  [18] rhdf5_2.32.4                            
##  [19] rprojroot_1.3-2                         
##  [20] vctrs_0.3.4                             
##  [21] generics_0.0.2                          
##  [22] xfun_0.18                               
##  [23] BiocFileCache_1.12.1                    
##  [24] randomForest_4.6-14                     
##  [25] R6_2.4.1                                
##  [26] ggbeeswarm_0.6.0                        
##  [27] clue_0.3-57                             
##  [28] rsvd_1.0.3                              
##  [29] locfit_1.5-9.4                          
##  [30] bitops_1.0-6                            
##  [31] assertthat_0.2.1                        
##  [32] promises_1.1.1                          
##  [33] scales_1.1.1                            
##  [34] beeswarm_0.2.3                          
##  [35] gtable_0.3.0                            
##  [36] rlang_0.4.8                             
##  [37] systemfonts_0.3.2                       
##  [38] GlobalOptions_0.1.2                     
##  [39] rtracklayer_1.48.0                      
##  [40] rstatix_0.6.0                           
##  [41] lazyeval_0.2.2                          
##  [42] broom_0.7.1                             
##  [43] reshape2_1.4.4                          
##  [44] BiocManager_1.30.10                     
##  [45] yaml_2.2.1                              
##  [46] abind_1.4-5                             
##  [47] backports_1.1.10                        
##  [48] httpuv_1.5.4                            
##  [49] tools_4.0.0                             
##  [50] ellipsis_0.3.1                          
##  [51] RColorBrewer_1.1-2                      
##  [52] plyr_1.8.6                              
##  [53] Rcpp_1.0.5                              
##  [54] progress_1.2.2                          
##  [55] zlibbioc_1.34.0                         
##  [56] purrr_0.3.4                             
##  [57] RCurl_1.98-1.2                          
##  [58] prettyunits_1.1.1                       
##  [59] openssl_1.4.3                           
##  [60] GetoptLong_1.0.3                        
##  [61] viridis_0.5.1                           
##  [62] cowplot_1.1.0                           
##  [63] haven_2.3.1                             
##  [64] cluster_2.1.0                           
##  [65] fs_1.5.0                                
##  [66] magrittr_1.5                            
##  [67] data.table_1.13.0                       
##  [68] openxlsx_4.2.2                          
##  [69] circlize_0.4.10                         
##  [70] ProtGenerics_1.20.0                     
##  [71] hms_0.5.3                               
##  [72] mime_0.9                                
##  [73] evaluate_0.14                           
##  [74] GSVA_1.36.3                             
##  [75] xtable_1.8-4                            
##  [76] XML_3.99-0.5                            
##  [77] rio_0.5.16                              
##  [78] readxl_1.3.1                            
##  [79] gridExtra_2.3                           
##  [80] shape_1.4.5                             
##  [81] compiler_4.0.0                          
##  [82] biomaRt_2.44.1                          
##  [83] tibble_3.0.3                            
##  [84] crayon_1.3.4                            
##  [85] R.oo_1.24.0                             
##  [86] htmltools_0.5.0                         
##  [87] later_1.1.0.1                           
##  [88] tidyr_1.1.2                             
##  [89] DBI_1.1.0                               
##  [90] ExperimentHub_1.14.2                    
##  [91] dbplyr_1.4.4                            
##  [92] rappdirs_0.3.1                          
##  [93] Matrix_1.2-18                           
##  [94] car_3.0-10                              
##  [95] R.methodsS3_1.8.1                       
##  [96] igraph_1.2.6                            
##  [97] forcats_0.5.0                           
##  [98] pkgconfig_2.0.3                         
##  [99] pkgdown_1.6.1                           
## [100] GenomicAlignments_1.24.0                
## [101] foreign_0.8-80                          
## [102] annotate_1.66.0                         
## [103] vipor_0.4.5                             
## [104] dqrng_0.2.1                             
## [105] XVector_0.28.0                          
## [106] stringr_1.4.0                           
## [107] digest_0.6.25                           
## [108] Biostrings_2.56.0                       
## [109] rmarkdown_2.4                           
## [110] cellranger_1.1.0                        
## [111] edgeR_3.30.3                            
## [112] DelayedMatrixStats_1.10.1               
## [113] GSEABase_1.50.1                         
## [114] curl_4.3                                
## [115] shiny_1.5.0                             
## [116] Rsamtools_2.4.0                         
## [117] rjson_0.2.20                            
## [118] lifecycle_0.2.0                         
## [119] Rhdf5lib_1.10.1                         
## [120] carData_3.0-4                           
## [121] BiocNeighbors_1.6.0                     
## [122] desc_1.2.0                              
## [123] viridisLite_0.3.0                       
## [124] askpass_1.1                             
## [125] limma_3.44.3                            
## [126] pillar_1.4.6                            
## [127] ggsci_2.9                               
## [128] lattice_0.20-41                         
## [129] fastmap_1.0.1                           
## [130] httr_1.4.2                              
## [131] interactiveDisplayBase_1.26.3           
## [132] glue_1.4.2                              
## [133] zip_2.1.1                               
## [134] png_0.1-7                               
## [135] shinythemes_1.1.2                       
## [136] BiocVersion_3.11.1                      
## [137] bit_4.0.4                               
## [138] stringi_1.5.3                           
## [139] HDF5Array_1.16.1                        
## [140] blob_1.2.1                              
## [141] textshaping_0.1.2                       
## [142] BiocSingular_1.4.0                      
## [143] AnnotationHub_2.20.2                    
## [144] memoise_1.1.0                           
## [145] dplyr_1.0.2                             
## [146] irlba_2.3.3</code></pre>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Ludwig Geistlinger.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
